{
    "version": "https://jsonfeed.org/version/1",
    "title": "好暖好温暖的博客",
    "subtitle": "不想转码的EE人不是好的嵌入式工程师",
    "icon": "https://haoruanwn.github.io/assets/favicon.ico",
    "description": "记录学习与生活的点滴",
    "home_page_url": "https://haoruanwn.github.io",
    "items": [
        {
            "id": "https://haoruanwn.github.io/2025/09/07/%E7%8E%B0%E4%BB%A3C-%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/",
            "url": "https://haoruanwn.github.io/2025/09/07/%E7%8E%B0%E4%BB%A3C-%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/",
            "title": "现代C++强制类型转换",
            "date_published": "2025-09-06T16:13:19.000Z",
            "content_html": "<h1 id=\"现代c强制类型转换\"><a class=\"anchor\" href=\"#现代c强制类型转换\">#</a> 现代C++强制类型转换</h1>\n<p>在C++中，提供了四种特定的强制类型转换操作符，以提供更安全、更明确的类型转换，它们分别是 <code>static_cast</code>、<code>dynamic_cast</code>、<code>const_cast</code> 和 <code>reinterpret_cast</code>。</p>\n<h2 id=\"static_cast用于良性和相关的转换\"><a class=\"anchor\" href=\"#static_cast用于良性和相关的转换\">#</a> <code>static_cast</code>：用于“良性”和“相关”的转换</h2>\n<p><code>static_cast</code> 在编译期进行类型检查，如果转换在编译期被认为是无效的，则会引发错误。它适用于大部分良性的、有逻辑关联的类型转换。</p>\n<h4 id=\"核心特点\"><a class=\"anchor\" href=\"#核心特点\">#</a> 核心特点</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>转换时机</strong></td>\n<td style=\"text-align:left\">编译期 (Compile-time)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>安全性</strong></td>\n<td style=\"text-align:left\">部分安全。编译期会检查类型是否相关，但不进行运行时检查。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>开销</strong></td>\n<td style=\"text-align:left\">无运行时开销，与C风格转换相当。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"主要用途\"><a class=\"anchor\" href=\"#主要用途\">#</a> 主要用途</h4>\n<ol>\n<li>\n<p><strong>基本数据类型转换</strong><br />\n适用于数值类型之间的转换，如 <code>int</code> 到 <code>double</code>，或者 <code>enum</code> 到 <code>int</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> pi </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3.14159</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> truncated_pi </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pi</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 结果为 3</span></span></code></pre>\n</li>\n<li>\n<p><strong>有继承关系的类指针/引用转换</strong></p>\n<ul>\n<li><strong>向上转型 (Upcasting)</strong>：将派生类的指针或引用转换为基类，这是安全的，因为派生类包含了基类的所有成员。</li>\n<li><strong>向下转型 (Downcasting)</strong>：将基类的指针或引用转换为派生类。这是 <strong>不安全</strong> 的，因为它不进行运行时检查来确保基类指针确实指向一个派生类对象。如果转换错误，将导致未定义行为。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Base</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Derived</span><span style=\"color:#999999;--shiki-dark:#666666\"> :</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> public</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Base</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Derived d</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 向上转型：安全</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Base</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> b_ptr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Base</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 向下转型：不安全，程序员必须确保 b_ptr 确实指向一个 Derived 对象</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Derived</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> d_ptr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Derived</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ptr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n</li>\n<li>\n<p><strong>将<code>void*</code>指针转换为具体类型指针</strong><br />\n<code>static_cast</code> 可以将 <code>void*</code> 指针转回其原始或兼容的类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> p </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> malloc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> int_p </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">p</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">free</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">int_p</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"dynamic_cast用于安全的向下转型\"><a class=\"anchor\" href=\"#dynamic_cast用于安全的向下转型\">#</a> <code>dynamic_cast</code>：用于“安全”的向下转型</h2>\n<p><code>dynamic_cast</code> 专门用于处理涉及<strong>多态</strong>（polymorphism）的类层次结构中的类型转换。它在<strong>运行时</strong>进行类型检查，以确保转换的安全性。</p>\n<h4 id=\"核心特点-2\"><a class=\"anchor\" href=\"#核心特点-2\">#</a> 核心特点</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>转换时机</strong></td>\n<td style=\"text-align:left\">运行时 (Run-time)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>安全性</strong></td>\n<td style=\"text-align:left\">安全。通过运行时类型信息 (RTTI) 检查转换的有效性。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>开销</strong></td>\n<td style=\"text-align:left\">有运行时开销，比 <code>static_cast</code> 慢。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>前提条件</strong></td>\n<td style=\"text-align:left\">只能用于包含虚函数（virtual function）的类，即多态类。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"主要用途-2\"><a class=\"anchor\" href=\"#主要用途-2\">#</a> 主要用途</h4>\n<ul>\n<li>\n<p><strong>安全的向下转型</strong>：在类继承结构中，安全地将基类指针或引用转换为派生类指针或引用。</p>\n</li>\n<li>\n<p><strong>转换失败的处理</strong>：</p>\n<ul>\n<li>对于指针类型，如果转换失败，它会返回 <code>nullptr</code>。</li>\n<li>对于引用类型，如果转换失败，它会抛出 <code>std::bad_cast</code> 异常。</li>\n</ul>\n</li>\n</ul>\n<p>&lt;!-- end list --&gt;</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Base</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> public</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> virtual</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ~</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Base</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 必须有虚函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Derived</span><span style=\"color:#999999;--shiki-dark:#666666\"> :</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> public</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Base</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> public</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> derived_only_func</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Another</span><span style=\"color:#999999;--shiki-dark:#666666\"> :</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> public</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Base</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> process</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Base</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b_ptr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 尝试将基类指针安全地转换为派生类指针</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Derived</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> d_ptr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> dynamic_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Derived</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ptr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 转换成功，b_ptr 确实指向一个 Derived 或其子类的对象</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        d_ptr</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\">derived_only_func</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 转换失败，b_ptr 指向的不是 Derived 对象</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 在这里安全地处理其他情况</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"const_cast用于移除-const-或-volatile-属性\"><a class=\"anchor\" href=\"#const_cast用于移除-const-或-volatile-属性\">#</a> <code>const_cast</code>：用于移除 <code>const</code> 或 <code>volatile</code> 属性</h2>\n<p><code>const_cast</code> 是唯一能修改类型的 <code>const</code> 或 <code>volatile</code> 限定符的转换符。它的主要使用场景是与一些旧的、未正确使用 <code>const</code> 的API交互。</p>\n<h4 id=\"核心特点-3\"><a class=\"anchor\" href=\"#核心特点-3\">#</a> 核心特点</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>转换时机</strong></td>\n<td style=\"text-align:left\">编译期 (Compile-time)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>安全性</strong></td>\n<td style=\"text-align:left\">不安全。如果试图通过 <code>const_cast</code> 移除 <code>const</code> 后去修改一个本身被定义为 <code>const</code> 的对象，将导致未定义行为。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>开销</strong></td>\n<td style=\"text-align:left\">无运行时开销。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"主要用途-3\"><a class=\"anchor\" href=\"#主要用途-3\">#</a> 主要用途</h4>\n<ul>\n<li><strong>移除 <code>const</code></strong>：将 <code>const</code> 指针/引用转换为非 <code>const</code> 指针/引用。</li>\n<li><strong>添加 <code>const</code></strong>：将非 <code>const</code> 指针/引用转换为 <code>const</code> 指针/引用。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 一个老旧的C风格API，它不会修改数据，但参数不是 const</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> legacy_c_api</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">char*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> str</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // ...</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> call_legacy_api</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> char*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> my_str </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // my_str 是 const，不能直接传递给 legacy_c_api</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 我们确信 API 不会修改它，因此使用 const_cast</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    legacy_c_api</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">char*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">my_str</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>警告</strong>：只有当你知道被转换的对象最初不是 <code>const</code> 时，才能安全地通过 <code>const_cast</code> 后的指针修改它。</p>\n<h2 id=\"reinterpret_cast用于处理无关类型的转换\"><a class=\"anchor\" href=\"#reinterpret_cast用于处理无关类型的转换\">#</a> <code>reinterpret_cast</code>：用于处理“无关”类型的转换</h2>\n<p><code>reinterpret_cast</code> 是最危险的类型转换，它执行底层的、与实现相关的位模式重新解释。编译器不会进行任何类型检查，完全信任程序员的操作。</p>\n<h4 id=\"核心特点-4\"><a class=\"anchor\" href=\"#核心特点-4\">#</a> 核心特点</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>转换时机</strong></td>\n<td style=\"text-align:left\">编译期 (Compile-time)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>安全性</strong></td>\n<td style=\"text-align:left\">极度不安全。它仅仅是重新解释内存中的位，结果是平台相关的。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>开销</strong></td>\n<td style=\"text-align:left\">无运行时开销。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"主要用途-4\"><a class=\"anchor\" href=\"#主要用途-4\">#</a> 主要用途</h4>\n<p>只在非常底层的编程中才需要它，比如：</p>\n<ul>\n<li><strong>指针与整数之间的转换</strong>：如将指针地址存为一个整数。</li>\n<li><strong>不同类型的指针转换</strong>：在不相关的类型之间进行指针转换，例如将一个 <code>int*</code> 转换为 <code>MyClass*</code>。</li>\n<li><strong>与硬件交互</strong>：将一个特定的整数地址转换为设备寄存器的指针。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 场景：将一个对象地址存为整数，之后再转回来</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyClass</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass obj</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 将指针地址转换为整数类型 uintptr_t</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">uintptr_t</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> addr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> reinterpret_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">uintptr_t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">obj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ... 在某个时刻 ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 将整数地址转回原始指针类型</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> obj_ptr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> reinterpret_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">addr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 场景：字节流的重新解释</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">char</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> buffer</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">sizeof</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ... 从网络或文件读取字节到 buffer ...</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> p_obj_from_buffer </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> reinterpret_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyClass</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">buffer</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h2 id=\"四种转换总结\"><a class=\"anchor\" href=\"#四种转换总结\">#</a> 四种转换总结</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">转换类型</th>\n<th style=\"text-align:left\">转换时机</th>\n<th style=\"text-align:left\">安全性</th>\n<th style=\"text-align:left\">主要用途</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong><code>static_cast</code></strong></td>\n<td style=\"text-align:left\">编译期</td>\n<td style=\"text-align:left\">部分安全</td>\n<td style=\"text-align:left\">相关类型转换（数值、继承、void*）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>dynamic_cast</code></strong></td>\n<td style=\"text-align:left\">运行时</td>\n<td style=\"text-align:left\">安全</td>\n<td style=\"text-align:left\">多态类层次结构中的安全向下转型</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>const_cast</code></strong></td>\n<td style=\"text-align:left\">编译期</td>\n<td style=\"text-align:left\">不安全</td>\n<td style=\"text-align:left\">添加或移除 <code>const</code> / <code>volatile</code> 属性</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>reinterpret_cast</code></strong></td>\n<td style=\"text-align:left\">编译期</td>\n<td style=\"text-align:left\">极度不安全</td>\n<td style=\"text-align:left\">底层、无关类型的位模式重新解释</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "Programming",
                "C",
                "C++"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/09/07/%E5%AD%97%E8%8A%82%E5%BA%8F%E4%B8%8E%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/",
            "url": "https://haoruanwn.github.io/2025/09/07/%E5%AD%97%E8%8A%82%E5%BA%8F%E4%B8%8E%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/",
            "title": "字节序与内存对齐",
            "date_published": "2025-09-06T16:12:51.000Z",
            "content_html": "<h3 id=\"1-字节序-endianness-大小端模式\"><a class=\"anchor\" href=\"#1-字节序-endianness-大小端模式\">#</a> 1. 字节序 (Endianness / 大小端模式)</h3>\n<p><strong>核心概念</strong>：字节序定义了<strong>多字节数据类型</strong>（例如 <code>int</code>, <code>short</code>, <code>double</code> 等）在内存中是如何存储其字节的顺序。</p>\n<p>一个32位的整数 <code>0x01020304</code> 由4个字节组成：<code>0x01</code>, <code>0x02</code>, <code>0x03</code>, <code>0x04</code>。</p>\n<ul>\n<li><code>0x01</code> 是<strong>最高有效字节 (Most Significant Byte, MSB)</strong></li>\n<li><code>0x04</code> 是<strong>最低有效字节 (Least Significant Byte, LSB)</strong></li>\n</ul>\n<p>内存地址总是从低到高增长。根据将 MSB 还是 LSB 存放在低地址，产生了两种模式：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">模式</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">存储示例 (int 0x01020304)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>大端模式 (Big-Endian)</strong></td>\n<td style=\"text-align:left\"><strong>最高有效字节 (MSB)</strong> 存放在 <strong>最低的内存地址</strong>。符合人类阅读习惯。</td>\n<td style=\"text-align:left\"><code>01</code> <code>02</code> <code>03</code> <code>04</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>小端模式 (Little-Endian)</strong></td>\n<td style=\"text-align:left\"><strong>最低有效字节 (LSB)</strong> 存放在 <strong>最低的内存地址</strong>。符合计算机处理逻辑。</td>\n<td style=\"text-align:left\"><code>04</code> <code>03</code> <code>02</code> <code>01</code></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"a-大端模式-big-endian\"><a class=\"anchor\" href=\"#a-大端模式-big-endian\">#</a> a. 大端模式 (Big-Endian)</h4>\n<p>对于 <code>int num = 0x01020304;</code>，其在内存中的存储方式如下：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>内存地址 (低 ---> 高)</span></span>\n<span class=\"line\"><span>+--------+--------+--------+--------+</span></span>\n<span class=\"line\"><span>|  0x01  |  0x02  |  0x03  |  0x04  |</span></span>\n<span class=\"line\"><span>+--------+--------+--------+--------+</span></span>\n<span class=\"line\"><span> 0x1000   0x1001   0x1002   0x1003</span></span></code></pre>\n<ul>\n<li><strong>常见架构</strong>：PowerPC, SPARC, 网络字节序 (Network Byte Order)。</li>\n</ul>\n<h4 id=\"b-小端模式-little-endian\"><a class=\"anchor\" href=\"#b-小端模式-little-endian\">#</a> b. 小端模式 (Little-Endian)</h4>\n<p>对于 <code>int num = 0x01020304;</code>，其在内存中的存储方式如下：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>内存地址 (低 ---> 高)</span></span>\n<span class=\"line\"><span>+--------+--------+--------+--------+</span></span>\n<span class=\"line\"><span>|  0x04  |  0x03  |  0x02  |  0x01  |</span></span>\n<span class=\"line\"><span>+--------+--------+--------+--------+</span></span>\n<span class=\"line\"><span> 0x1000   0x1001   0x1002   0x1003</span></span></code></pre>\n<ul>\n<li><strong>常见架构</strong>：x86, x86-64, ARM (大部分模式下)。</li>\n</ul>\n<h4 id=\"c-如何判断当前系统的字节序\"><a class=\"anchor\" href=\"#c-如何判断当前系统的字节序\">#</a> c. 如何判断当前系统的字节序？</h4>\n<p>可以通过检查一个整数的第一个字节来判断。整数 <code>1</code> 在内存中表示为 <code>0x00000001</code>。</p>\n<ul>\n<li>在小端系统中，最低地址存放的是 <code>0x01</code>。</li>\n<li>在大端系统中，最低地址存放的是 <code>0x00</code>。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> check_endianness</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> num </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 将int指针强制转换为char指针，指向num的最低地址</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    char*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ptr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> reinterpret_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">char*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">num</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ptr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本系统是 小端模式 (Little-Endian)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本系统是 大端模式 (Big-Endian)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<hr />\n<h3 id=\"2-内存对齐-memory-alignment\"><a class=\"anchor\" href=\"#2-内存对齐-memory-alignment\">#</a> 2. 内存对齐 (Memory Alignment)</h3>\n<p><strong>核心概念</strong>：CPU访问内存不是逐字节进行的，而是以块（通常是2, 4, 8字节）为单位。为了让CPU高效地读取数据，编译器会自动将数据存放在特定地址，这个地址通常是其数据类型大小的整数倍。</p>\n<p><strong>为什么需要对齐？</strong></p>\n<ul>\n<li><strong>性能</strong>：对齐的数据可以被CPU在一个总线周期内读取。如果数据未对齐，CPU可能需要两次读取再拼接数据，降低性能。</li>\n<li><strong>硬件要求</strong>：某些硬件平台（尤其是RISC架构，如ARM）<strong>不允许</strong>访问未对齐的数据，强行访问会触发硬件异常。</li>\n</ul>\n<h4 id=\"a-对齐规则\"><a class=\"anchor\" href=\"#a-对齐规则\">#</a> a. 对齐规则</h4>\n<ol>\n<li><strong>成员对齐</strong>：结构体(<code>struct</code>)或类(<code>class</code>)的每个成员，其存放的起始地址相对于结构体起始地址的偏移量，必须是其自身大小（或指定对齐值）的整数倍。</li>\n<li><strong>整体对齐</strong>：结构体或类的总大小，必须是其<strong>最宽的成员</strong>（或指定对齐值）大小的整数倍。</li>\n</ol>\n<p><strong>示例分析</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyStruct</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    char</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1字节</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     // 4字节</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    short</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> c</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 2字节</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 预期大小: 1 + 4 + 2 = 7</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 实际大小: 12</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sizeof(MyStruct) = </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> sizeof</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyStruct</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>内存布局</strong>：</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250907001714517.png\" alt=\"Snipaste_2025-09-07_00-16-45\" /></p>\n<ul>\n<li><code>char a</code>: 位于偏移量 <code>0</code>。</li>\n<li><code>int b</code>: 大小为4，其偏移量必须是4的倍数。因此编译器在 <code>a</code> 后填充3字节，使 <code>b</code> 从偏移量 <code>4</code> 开始。</li>\n<li><code>short c</code>: 大小为2，<code>b</code> 结束后偏移量为 <code>8</code>，是2的倍数，可以直接存放。</li>\n<li><strong>整体对齐</strong>: 结构体最宽成员是 <code>int b</code> (4字节)，总大小必须是4的倍数。当前大小为 <code>1 (a) + 3 (pad) + 4 (b) + 2 (c) = 10</code> 字节。为满足4的倍数要求，末尾再填充2字节，最终大小为12字节。</li>\n</ul>\n<h4 id=\"b-如何控制对齐-pragma-packn\"><a class=\"anchor\" href=\"#b-如何控制对齐-pragma-packn\">#</a> b. 如何控制对齐 <code>#pragma pack(n)</code></h4>\n<p>可以使用预处理指令 <code>#pragma pack(n)</code> 来改变编译器的默认对齐系数。<code>n</code> 可以是 <code>1</code>, <code>2</code>, <code>4</code>, <code>8</code> 等。成员对齐时，将按照 <code>n</code> 和成员自身大小中 <strong>较小</strong> 的值进行对齐。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pragma</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pack</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 设置对齐系数为1，即无填充</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyStructPacked</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    char</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1字节</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     // 4字节</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    short</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> c</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 2字节</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pragma</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pack</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 恢复默认对齐</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// sizeof(MyStructPacked) 的结果将是 1 + 4 + 2 = 7</span></span></code></pre>\n<hr />\n<h3 id=\"3-常见导致问题的场景\"><a class=\"anchor\" href=\"#3-常见导致问题的场景\">#</a> 3. 常见导致问题的场景</h3>\n<h4 id=\"a-网络通信-字节序问题\"><a class=\"anchor\" href=\"#a-网络通信-字节序问题\">#</a> a. 网络通信 (字节序问题)</h4>\n<p>不同架构的计算机字节序可能不同。而<strong>网络协议规定字节序为大端模式 (Network Byte Order)</strong>。</p>\n<ul>\n<li>\n<p><strong>问题</strong>：小端机器 (x86) 发送 <code>0x01020304</code> (内存中为 <code>04 03 02 01</code>)，大端服务器接收后会误读为 <code>0x04030201</code>。</p>\n</li>\n<li>\n<p><strong>解决方案</strong>：发送前，统一将数据从主机字节序 (Host Order) 转换到网络字节序 (Big-Endian)；接收后反向转换。</p>\n<ul>\n<li><strong>常用函数</strong>：<code>htons()</code>, <code>htonl()</code>, <code>ntohs()</code>, <code>ntohl()</code>\n<ul>\n<li><code>h</code> 代表 host, <code>to</code> 代表 to, <code>n</code> 代表 network, <code>s</code> 代表 short, <code>l</code> 代表 long。</li>\n</ul>\n</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">arpa/inet.h</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 在Linux/macOS中</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// #include &#x3C;winsock2.h></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 在Windows中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">uint32_t</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> num </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">01020304</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">uint32_t</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> net_num </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> htonl</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">num</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 转换为主机序到网络序</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// send(socket, &#x26;net_num, sizeof(net_num), 0);</span></span></code></pre>\n</li>\n</ul>\n<h4 id=\"b-文件读写与数据持久化-字节序与对齐问题\"><a class=\"anchor\" href=\"#b-文件读写与数据持久化-字节序与对齐问题\">#</a> b. 文件读写与数据持久化 (字节序与对齐问题)</h4>\n<p>直接将结构体的二进制内存写入文件，会同时写入字节序和内存对齐产生的填充字节。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyStruct data</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// file.write(reinterpret_cast&#x3C;char*>(&#x26;data), sizeof(MyStruct));</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 错误做法</span></span></code></pre>\n<ul>\n<li><strong>问题</strong>:\n<ol>\n<li><strong>字节序</strong>：在小端机器上写的文件，用大端机器读会出错。</li>\n<li><strong>对齐</strong>：不同编译器或编译选项可能导致填充方式不同，造成跨平台/版本解析失败。</li>\n</ol>\n</li>\n<li><strong>解决方案</strong>：采用<strong>序列化 (Serialization)</strong>。逐个成员地进行读写，并为文件格式定义统一的字节序（通常推荐大端）。</li>\n</ul>\n<h4 id=\"c-嵌入式开发与硬件交互-字节序与对齐问题\"><a class=\"anchor\" href=\"#c-嵌入式开发与硬件交互-字节序与对齐问题\">#</a> c. 嵌入式开发与硬件交互 (字节序与对齐问题)</h4>\n<p>直接读写硬件寄存器时，必须严格遵守硬件手册的规定。</p>\n<ul>\n<li><strong>字节序</strong>：硬件寄存器通常是大端模式。小端CPU在写入时必须手动转换字节序。</li>\n<li><strong>对齐</strong>：访问硬件寄存器必须严格对齐。例如，对一个32位(4字节)寄存器，其访问地址必须是4的倍数，否则在很多嵌入式处理器上将导致硬件异常。</li>\n</ul>\n",
            "tags": [
                "Programming",
                "C",
                "C++"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/09/03/Programming/C++/Conan-CMake%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/",
            "url": "https://haoruanwn.github.io/2025/09/03/Programming/C++/Conan-CMake%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/",
            "title": "Conan+CMake基本编译流程",
            "date_published": "2025-09-03T14:53:54.000Z",
            "content_html": "<h1 id=\"conancmake基本编译流程\"><a class=\"anchor\" href=\"#conancmake基本编译流程\">#</a> Conan+CMake基本编译流程</h1>\n<h2 id=\"本地编译\"><a class=\"anchor\" href=\"#本地编译\">#</a> 本地编译</h2>\n<h3 id=\"1-conan-安装依赖\"><a class=\"anchor\" href=\"#1-conan-安装依赖\">#</a> 1. Conan 安装依赖</h3>\n<p>首先，使用 Conan 安装项目所需的第三方包。Conan 会根据构建类型（Debug/Release）将生成的文件放置在不同的目录中。</p>\n<ul>\n<li>\n<p>默认情况下，Conan 会创建 <code>build/Release/generators</code> 目录来存放生成文件。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">conan</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build=missing</span></span></code></pre>\n</li>\n<li>\n<p>可以明确指定构建类型，例如 <code>Debug</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">conan</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build=missing</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build_type=Debug</span></span></code></pre>\n</li>\n<li>\n<p><code>--output-folder</code> 参数可以指定输出目录，但通常不是必需的，因为 Conan 会根据配置自动管理路径。</p>\n</li>\n</ul>\n<h3 id=\"2-cmake-配置与编译\"><a class=\"anchor\" href=\"#2-cmake-配置与编译\">#</a> 2. CMake 配置与编译</h3>\n<p>Conan 在安装依赖后，会自动生成一个 CMake 预设文件 (<code>CMakeUserPresets.json</code>)，其中包含了配置和编译所需的全部信息。因此，推荐直接使用预设来简化操作。</p>\n<h4 id=\"使用-cmake-预设推荐\"><a class=\"anchor\" href=\"#使用-cmake-预设推荐\">#</a> 使用 CMake 预设（推荐）</h4>\n<ul>\n<li>\n<p><strong>配置 CMake</strong></p>\n<p>使用 <code>conan-debug</code> 或 <code>conan-release</code> 预设来配置项目。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 配置 Debug 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-debug</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 配置 Release 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-release</span></span></code></pre>\n</li>\n<li>\n<p><strong>编译</strong></p>\n<p>同样使用预设来执行编译。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译 Debug 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-debug</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译 Release 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-release</span></span></code></pre>\n</li>\n</ul>\n<h4 id=\"手动配置\"><a class=\"anchor\" href=\"#手动配置\">#</a> 手动配置</h4>\n<p>如果不使用预设，则需要手动指定工具链文件和构建类型。</p>\n<ul>\n<li>\n<p><strong>配置 CMake</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 配置 Release 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/Release</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -G</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Ninja</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">      -DCMAKE_TOOLCHAIN_FILE=build/Release/generators/conan_toolchain.cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">      -DCMAKE_BUILD_TYPE=Release</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 配置 Debug 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/Debug</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -G</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Ninja</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">      -DCMAKE_TOOLCHAIN_FILE=build/Debug/generators/conan_toolchain.cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">      -DCMAKE_BUILD_TYPE=Debug</span></span></code></pre>\n</li>\n<li>\n<p><strong>编译</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译 Release 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/Release</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译 Debug 版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/Debug</span></span></code></pre>\n</li>\n</ul>\n<h2 id=\"交叉编译\"><a class=\"anchor\" href=\"#交叉编译\">#</a> 交叉编译</h2>\n<h3 id=\"1-创建-profile-文件\"><a class=\"anchor\" href=\"#1-创建-profile-文件\">#</a> 1. 创建 Profile 文件</h3>\n<p>首先，需要为目标平台创建一个 Conan Profile 文件。例如，为 aarch64 架构创建一个 <code>profiles/aarch64_profile</code> 文件。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-toml\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">settings</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">os</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">L</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">inux</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">arch</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">a</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">rmv8</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">compiler</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">g</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">cc</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">compiler</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">version</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">15.2</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">compiler</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">libcxx</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">ibstdc++11</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">compiler</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cppstd</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">conf</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 告诉 Conan 加载我们自定义的 CMake 工具链文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用 tools.cmake.cmaketoolchain:user_toolchain 来指定</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 注意: $&#123;profile_dir&#125; 是 Conan 变量，但实践中建议使用绝对路径以确保正确识别</span></span>\n<span class=\"line\"><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">tools.cmake.cmaketoolchain:user_toolchain=</span><span style=\"color:#2993a3;--shiki-light-font-style:italic;--shiki-dark:#5eaab5;--shiki-dark-font-style:italic\">[</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">\"/path/to/your/project/cmake/aarch64-toolchain.cmake\"</span><span style=\"color:#2993a3;--shiki-light-font-style:italic;--shiki-dark:#5eaab5;--shiki-dark-font-style:italic\">]</span></span></code></pre>\n<p>在对应的 <code>.cmake</code> 工具链文件中，你需要设置交叉编译所需的编译器、系统根目录等环境变量。</p>\n<h3 id=\"2-执行编译流程\"><a class=\"anchor\" href=\"#2-执行编译流程\">#</a> 2. 执行编译流程</h3>\n<p>交叉编译的流程与本地编译非常相似，区别在于需要在 <code>conan install</code> 命令中通过 <code>-pr:h</code> 参数指定 Host 平台的 Profile 文件。</p>\n<ul>\n<li>\n<p><strong>Conan 安装依赖</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">conan</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build=missing</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build_type=Debug</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -pr:h</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> profiles/aarch64_profile</span></span></code></pre>\n</li>\n<li>\n<p><strong>配置 CMake</strong></p>\n<p>Conan 同样会生成适用于交叉编译的 CMake 预设。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-debug</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-release</span></span></code></pre>\n</li>\n<li>\n<p><strong>编译</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-debug</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --preset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> conan-release</span></span></code></pre>\n</li>\n</ul>\n",
            "tags": [
                "Programming",
                "CMake",
                "Conan"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/28/Programming/Rust/Rust%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/",
            "url": "https://haoruanwn.github.io/2025/08/28/Programming/Rust/Rust%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/",
            "title": "Rust的错误处理",
            "date_published": "2025-08-28T15:46:25.000Z",
            "content_html": "<h1 id=\"rust-错误处理机制\"><a class=\"anchor\" href=\"#rust-错误处理机制\">#</a> Rust 错误处理机制</h1>\n<h2 id=\"一-错误分类可恢复与不可恢复\"><a class=\"anchor\" href=\"#一-错误分类可恢复与不可恢复\">#</a> 一、 错误分类：可恢复与不可恢复</h2>\n<p>在 Rust 中，错误被分为两大类：不可恢复的错误和可恢复的错误。系统为这两种错误提供了不同的处理机制。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\"><code>panic!</code> (不可恢复错误)</th>\n<th style=\"text-align:left\"><code>Result&lt;T, E&gt;</code> (可恢复错误)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>核心用途</strong></td>\n<td style=\"text-align:left\">处理程序缺陷（Bug），表示程序进入了无法安全继续执行的状态。</td>\n<td style=\"text-align:left\">处理可预期的、能够被合理响应的运行时错误。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>典型场景</strong></td>\n<td style=\"text-align:left\">访问数组越界、断言失败等。</td>\n<td style=\"text-align:left\">文件未找到、网络连接中断、输入解析失败等。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>程序行为</strong></td>\n<td style=\"text-align:left\">立即终止当前线程，展开调用栈并清理数据。</td>\n<td style=\"text-align:left\">返回一个包含成功值或错误值的枚举，由调用者决定如何处理。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>触发方式</strong></td>\n<td style=\"text-align:left\">1. 显式调用 <code>panic!(&quot;message&quot;);</code> 2. 代码执行了致命错误操作。</td>\n<td style=\"text-align:left\">函数显式地返回 <code>Ok(value)</code> 或 <code>Err(error)</code>。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"二-resultt-e-枚举显式处理错误\"><a class=\"anchor\" href=\"#二-resultt-e-枚举显式处理错误\">#</a> 二、 <code>Result&lt;T, E&gt;</code> 枚举：显式处理错误</h2>\n<p><code>Result&lt;T, E&gt;</code> 是一个标准库定义的枚举，专门用于处理可恢复的错误。它有两个变体：</p>\n<ul>\n<li><code>Ok(T)</code>: 表示操作成功，并包含成功时返回的值，其类型为泛型 <code>T</code>。</li>\n<li><code>Err(E)</code>: 表示操作失败，并包含一个描述错误的值，其类型为泛型 <code>E</code>。</li>\n</ul>\n<h3 id=\"1-示例解析字符串\"><a class=\"anchor\" href=\"#1-示例解析字符串\">#</a> 1. 示例：解析字符串</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">num</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">ParseIntError</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 函数尝试将字符串解析为 i32</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 成功时返回 Ok(i32)，失败时返回 Err(ParseIntError)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> parse_number</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">str</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Result</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> ParseIntError</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    s</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">parse</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> success</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> parse_number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">123</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> failure</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> parse_number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">abc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">尝试解析 '123': </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> success</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">尝试解析 'abc': </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> failure</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>执行结果：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">尝试解析</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">123</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Ok</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">123</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">尝试解析</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">abc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Err</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ParseIntError</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> kind:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> InvalidDigit</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"2-使用-match-表达式处理\"><a class=\"anchor\" href=\"#2-使用-match-表达式处理\">#</a> 2. 使用 <code>match</code> 表达式处理</h3>\n<p><code>match</code> 是处理 <code>Result</code> 最基础、最明确的方式。Rust 的 <code>match</code> 是穷尽的（exhaustive），编译器会强制你处理所有可能的情况（<code>Ok</code> 和 <code>Err</code>），确保错误不会被意外忽略。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number_str</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">42</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    match</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">42</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">parse</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 如果结果是 Ok，`n` 会绑定到 Ok 内部的值</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Ok</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">解析成功！数字是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 如果结果是 Err，`e` 会绑定到 Err 内部的错误</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">e</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">解析失败！错误是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> e</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    match</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">parse</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Ok</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">解析成功！数字是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">e</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">解析失败！错误是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> e</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"三-运算符简洁的错误传播\"><a class=\"anchor\" href=\"#三-运算符简洁的错误传播\">#</a> 三、 <code>?</code> 运算符：简洁的错误传播</h2>\n<p>在实际开发中，函数内部常常会调用多个可能失败的操作。如果每个操作都使用 <code>match</code> 处理，代码会变得冗长和嵌套。<code>?</code> 运算符就是为了解决这个问题而生的，它用于实现错误的 <strong>传播（Propagation）</strong>，即如果内部调用失败，则立即将错误返回给当前函数的调用者。</p>\n<ul>\n<li><strong>核心功能</strong>：当 <code>Result</code> 的值为 <code>Ok(T)</code> 时，它会解包出 <code>T</code> 并让程序继续；如果值为 <code>Err(E)</code>，它会立刻中断当前函数的执行，并将 <code>Err(E)</code> 作为当前函数的返回值。</li>\n<li><strong>链式调用</strong>：<code>?</code> 运算符可以使一系列可能失败的操作代码保持线性、清晰和易读。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fs</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">File</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">io</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Read</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 链式调用示例：打开文件并读取其所有内容</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> read_username_from_file</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Result</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> io</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Error</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> username</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">new</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. File::open 返回 Result&#x3C;File, io::Error></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    //    `?` 在成功时返回 File 实例，失败时将 io::Error 返回</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. .read_to_string 返回 Result&#x3C;usize, io::Error></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    //    `?` 在成功时返回读取的字节数，失败时将 io::Error 返回</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    File</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">open</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">username.txt</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">?.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">read_to_string</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> username</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Ok</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">username</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"四-运算符的工作机制\"><a class=\"anchor\" href=\"#四-运算符的工作机制\">#</a> 四、 <code>?</code> 运算符的工作机制</h2>\n<h3 id=\"1-使用前提函数的返回类型\"><a class=\"anchor\" href=\"#1-使用前提函数的返回类型\">#</a> 1. 使用前提：函数的返回类型</h3>\n<p><code>?</code> 运算符只能在返回类型为 <code>Result&lt;T, E&gt;</code>、<code>Option&lt;T&gt;</code> 或其他实现了内部 <code>FromResidual</code> Trait 的函数中使用。这是因为 <code>?</code> 的核心行为是“提前返回一个 <code>Err</code> 或 <code>None</code>”，如果当前函数的签名不允许返回这样的类型，编译器就会报错。</p>\n<p><strong>错误示例</strong>： <code>main</code> 函数默认返回 <code>()</code>，不能使用 <code>?</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fs</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">File</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 编译错误！</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // error[E0277]: the `?` operator can only be used in a function that returns `Result` or `Option`</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> f</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> File</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">open</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello.txt</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"2-错误类型的自动转换\"><a class=\"anchor\" href=\"#2-错误类型的自动转换\">#</a> 2. 错误类型的自动转换</h3>\n<p><code>?</code> 运算符还有一个强大的功能：如果它遇到的错误类型 <code>E1</code> 与当前函数签名的错误类型 <code>E2</code> 不同，它会尝试使用 <code>From</code> Trait 将 <code>E1</code> 自动转换为 <code>E2</code>。这是通过 <code>E2::from(E1)</code> 实现的。这在处理来自不同库的多种错误类型时非常有用。</p>\n<h2 id=\"五-应用程序顶层的错误处理\"><a class=\"anchor\" href=\"#五-应用程序顶层的错误处理\">#</a> 五、 应用程序顶层的错误处理</h2>\n<p>从 Rust 1.26 版本开始，<code>main</code> 函数可以返回一个 <code>Result</code>，只要其错误类型实现了 <code>std::process::Termination</code> Trait（<code>std::error::Error</code> Trait 的实现者通常也满足要求）。最常见的实践是让 <code>main</code> 返回 <code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code>。</p>\n<ul>\n<li><code>()</code> 作为成功类型：表示程序成功运行到结束，没有特定的返回值。</li>\n<li><code>Box&lt;dyn Error&gt;</code> 作为错误类型：这是一个 <strong>Trait 对象</strong>，可以容纳任何实现了 <code>std::error::Error</code> Trait 的错误类型。</li>\n</ul>\n<p><strong>为什么这样设计？</strong><br />\n一个复杂的程序可能会遇到多种错误，例如 <code>io::Error</code>（文件操作）、<code>serde_json::Error</code>（JSON 解析）或 <code>reqwest::Error</code>（网络请求）。</p>\n<p>借助 <code>?</code> 运算符的自动类型转换能力，任何具体的错误类型（如 <code>io::Error</code>）都可以被自动转换并装箱（Box）成一个 <code>Box&lt;dyn Error&gt;</code>。这使得我们可以在 <code>main</code> 函数中使用 <code>?</code> 来统一处理来自不同模块的异构错误，极大地简化了顶层错误处理逻辑。</p>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/28/Programming/Rust/Trait%E4%B8%8E%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E7%AE%80%E5%8C%96%EF%BC%88%E4%B8%89%EF%BC%89/",
            "url": "https://haoruanwn.github.io/2025/08/28/Programming/Rust/Trait%E4%B8%8E%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E7%AE%80%E5%8C%96%EF%BC%88%E4%B8%89%EF%BC%89/",
            "title": "Trait与函数签名简化（三）",
            "date_published": "2025-08-28T15:14:45.000Z",
            "content_html": "<h1 id=\"指定返回类型impl-trait-语法\"><a class=\"anchor\" href=\"#指定返回类型impl-trait-语法\">#</a> 指定返回类型：<code>impl Trait</code> 语法</h1>\n<h3 id=\"核心问题\"><a class=\"anchor\" href=\"#核心问题\">#</a> 核心问题</h3>\n<p>当函数返回一个复杂但实现了某个 trait 的类型时，如何简化函数签名，同时又不丢失必要的类型信息？</p>\n<p>这在以下两种情况中尤为突出：</p>\n<ol>\n<li>\n<p><strong>返回类型极其复杂</strong>：函数的返回值是一个由泛型和闭包等组合而成的具体类型，其名称可能非常长，甚至在语法上无法直接写出。这在 Rust 的迭代器适配器链中尤为常见。</p>\n<p>例如，对于下面的函数，其返回值的具体类型是什么？</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> get_even_plus_one</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">numbers</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Vec</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">u32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ???</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    numbers</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">into_iter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">filter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> %</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">map</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>其具体的返回类型是 <code>std::iter::Map&lt;std::iter::Filter&lt;std::vec::IntoIter&lt;u32&gt;, _&gt;, _&gt;</code>。这种类型既冗长又暴露了实现细节，并且由于闭包的存在，我们无法在代码中显式地写出它。</p>\n</li>\n<li>\n<p><strong>返回类型是实现细节</strong>：作为 API 的设计者，我们可能不希望将返回值的具体类型暴露给调用者。我们只想承诺返回一个“具备某种能力”的对象，而这个对象的具体实现可能会在未来版本中更改，只要它仍然具备承诺的能力即可。</p>\n</li>\n</ol>\n<h3 id=\"impl-trait只描述能力不暴露类型\"><a class=\"anchor\" href=\"#impl-trait只描述能力不暴露类型\">#</a> <code>impl Trait</code>：只描述能力，不暴露类型</h3>\n<p><code>impl Trait</code> 语法允许我们在函数签名中指定一个抽象的返回类型，该类型是静态分发的（在编译期确定）。我们不关心返回值的具体类型是什么，只关心它实现了哪个 <code>Trait</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 我们承诺返回一个“实现了 Iterator trait 的东西”，其迭代的元素类型是 u32</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> get_even_plus_one</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">numbers</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Vec</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">u32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Iterator</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Item</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    numbers</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">into_iter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">filter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> %</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">map</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_numbers</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> vec!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // a_special_iterator 的具体类型被编译器隐藏了</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 我们只知道它可以像任何迭代器一样被使用</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a_special_iterator</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> get_even_plus_one</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">my_numbers</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> num</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a_special_iterator</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> num</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 3, 5, 7</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>优势总结</strong>：</p>\n<ul>\n<li><strong>简化签名</strong>：隐藏了复杂的具体类型。</li>\n<li><strong>封装实现</strong>：允许库作者在不破坏兼容性的前提下改变内部实现。</li>\n<li><strong>零成本抽象</strong>：<code>impl Trait</code> 是静态分发的，没有运行时开销。</li>\n</ul>\n<h3 id=\"与-c-的对比\"><a class=\"anchor\" href=\"#与-c-的对比\">#</a> 与 C++ 的对比</h3>\n<p><code>impl Trait</code> 的概念在 C++ 中可以找到一些类似的模式，但 Rust 提供了更强的编译期保证。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">C++ 方式</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">优点</th>\n<th style=\"text-align:left\">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>auto</code> 返回类型</td>\n<td style=\"text-align:left\">使用 <code>auto</code> 关键字让编译器自动推导返回类型，从而隐藏复杂性。</td>\n<td style=\"text-align:left\">隐藏了复杂的模板类型名，简化了函数签名。</td>\n<td style=\"text-align:left\"><code>auto</code> 只隐藏了类型，没有提供任何关于“返回值能力”的契约或接口信息。调用者必须阅读文档或源码才能知道返回的对象能做什么。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">返回基类指针/引用</td>\n<td style=\"text-align:left\">返回一个指向基类（接口类）的指针或引用，以实现多态。</td>\n<td style=\"text-align:left\">在函数签名中明确了接口信息。</td>\n<td style=\"text-align:left\">通常涉及动态分发（虚函数）和堆内存分配（如 <code>std::unique_ptr</code>），会带来运行时开销。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"c-auto-示例\"><a class=\"anchor\" href=\"#c-auto-示例\">#</a> C++ <code>auto</code> 示例</h4>\n<p>下面的代码使用 <code>auto</code> 隐藏了 C++20 ranges 库生成的复杂类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vector</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ranges</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 使用 auto，我们也不用写出 ranges 生成的那个复杂类型名</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">auto</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> get_even_plus_one</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">vector</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> numbers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numbers</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">         |</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">views</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">filter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> n </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">%</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">         |</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">views</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">transform</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> n</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> n </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> my_numbers </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    auto</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> a_special_range </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> get_even_plus_one</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">my_numbers</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> num </span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> a_special_range</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> num </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 3, 5, 7</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>相较于 C++ 的 <code>auto</code>，Rust 的 <code>impl Trait</code> 不仅隐藏了类型，还明确地在编译期强制约束了该类型必须满足的 <code>Trait</code> 契约，提供了更好的类型安全和代码清晰度。</p>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/27/Programming/Rust/Trait%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "url": "https://haoruanwn.github.io/2025/08/27/Programming/Rust/Trait%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "title": "Trait与泛型约束（二）",
            "date_published": "2025-08-27T13:54:39.000Z",
            "content_html": "<h1 id=\"trait-与泛型约束trait-bounds\"><a class=\"anchor\" href=\"#trait-与泛型约束trait-bounds\">#</a> Trait 与泛型约束：Trait Bounds</h1>\n<p><code>Trait</code> 约束（Trait Bounds）是 Rust 泛型系统中的核心特性，它允许我们对泛型参数可以使用的类型进行限制。其功能和设计哲学与 C++20 中引入的 <code>Concepts</code> 非常相似，主要解决了传统 C++ 模板（Templates）因“鸭子类型”而导致的编译错误信息晦涩难懂的问题。</p>\n<h3 id=\"一-c-模板的历史问题鸭子类型\"><a class=\"anchor\" href=\"#一-c-模板的历史问题鸭子类型\">#</a> 一、C++ 模板的历史问题：鸭子类型</h3>\n<p>在 C++20 引入 <code>Concepts</code> 之前，C++ 模板遵循“鸭子类型”原则：“如果一个东西走起来像鸭子，叫起来也像鸭子，那它就是一只鸭子”。编译器不会在定义模板时检查类型的合法性，而是在模板被具体类型实例化时，才去检查模板内的代码是否对该类型有效。</p>\n<p>这种机制导致，如果传入的类型不满足模板内部的隐式要求（例如缺少某个成员函数），编译器不会直接提示“类型不满足约束”，而是会深入模板内部，报告一个具体但脱离上下文的、往往非常冗长的编译错误，增加了调试难度。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 此模板函数隐式地期望类型 T 有一个 .summarize() 成员函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> print_summary</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">This is an article.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    Article article</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    print_summary</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">article</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // OK，Article 实现了 .summarize()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> my_number </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 编译失败：int 类型没有 .summarize() 成员函数</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 编译器会产生一大堆晦涩难懂的模板错误信息</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // print_summary(my_number); </span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"二-基本的-trait-bound-语法\"><a class=\"anchor\" href=\"#二-基本的-trait-bound-语法\">#</a> 二、基本的 Trait Bound 语法</h3>\n<p>Rust 通过 Trait Bounds 在编译时就对泛型参数进行约束，从根本上解决了上述问题。基本语法是 <code>&lt;T: Trait&gt;</code>，它明确告诉编译器：任何用于实例化泛型参数 <code>T</code> 的类型，都<strong>必须</strong>实现了指定的 <code>Trait</code>。</p>\n<p>这样，编译器就可以在函数定义层面进行检查。如果一个类型不满足约束，编译器会立即给出一个清晰、准确的错误提示，指出哪个 Trait 未被实现。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 定义一个 Summary Trait</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 为 Article 实现 Summary Trait</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Article: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// &#x3C;T: Summary> 就是 Trait Bound</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 它约束了 T 必须是实现了 Summary Trait 的类型</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 编译器因此可以保证 item.summarize() 调用是合法的</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> notify</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Breaking News! </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rust is Awesome</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">to_string</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    notify</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">article</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 编译失败：编译器会明确提示 a trait bound was not satisfied:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // the trait `Summary` is not implemented for `&#123;integer&#125;`</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // notify(&#x26;my_number);</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>这与 C++20 <code>Concepts</code> 的作用完全相同，都是将隐式要求明确化。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// C++20 Concepts</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">concepts</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">concept</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> HasSummary </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> requires</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> t</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> t</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">convertible_to</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 约束 T 必须满足 HasSummary</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">HasSummary</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> notify</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 此时，用 int 调用 notify 会得到一个关于 Concept 不满足的清晰错误</span></span></code></pre>\n<h3 id=\"三-指定多个-trait-bound-语法\"><a class=\"anchor\" href=\"#三-指定多个-trait-bound-语法\">#</a> 三、指定多个 Trait Bound: <code>+</code> 语法</h3>\n<p>当泛型参数需要满足多个约束时，可以使用 <code>+</code> 语法将多个 Trait Bound 组合起来。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Display</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Article: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Display</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> f</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;mut</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Formatter</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">_</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Result</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> write!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> f</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;mut</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Formatter</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">_</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Result</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> write!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Article &#x3C;!--swig￼0--></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// T 必须同时实现 Summary 和 Display 两个 Trait</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> notify_and_print</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Display</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Summary: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // item 可以直接用 &#123;&#125; 打印，因为 T 实现了 Display</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Displaying item: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Article</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rust is Awesome</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">to_string</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    notify_and_print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">article</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>这类似于 C++20 <code>Concepts</code> 中使用 <code>&amp;&amp;</code> 来组合多个约束。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 伪代码示例</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">concept</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> IsDisplayable </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> requires</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> t</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /* ... */</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 要求 T 同时满足 HasSummary 和 IsDisplayable</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    requires</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> HasSummary</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> IsDisplayable</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> some_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /* ... */</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"四-使用-where-子句处理复杂约束\"><a class=\"anchor\" href=\"#四-使用-where-子句处理复杂约束\">#</a> 四、使用 <code>where</code> 子句处理复杂约束</h3>\n<p>当泛型参数较多，或者每个参数的 Trait Bound 列表很长时，函数签名会变得非常臃肿和难以阅读。此时，可以使用 <code>where</code> 子句来声明约束，将函数签名（做什么）和泛型约束（对谁做）分离开，提高代码的可读性。</p>\n<p><strong>未使用 <code>where</code> 的写法：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"># </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Display</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"># </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cmp</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">PartialEq</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> some_function</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Display</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Clone</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Clone</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">U</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>使用 <code>where</code> 子句的写法：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Display</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cmp</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">PartialEq</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 使用 where 子句将复杂的约束整理到函数签名之后</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> compare_and_print</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> U</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">a</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">U</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">where</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Display</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> PartialEq</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">U</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // T 必须能打印，且能与类型 U 进行相等比较</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Display</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Debug</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // U 必须能打印，且支持调试打印</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Are they equal? </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">eq</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">b</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Debug info for b: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>C++20 的 <code>requires</code> 子句也提供了类似的功能，用于将复杂的约束条件整理在函数签名之后。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">concepts</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 伪代码，仅为演示结构</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> concept</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> IsDisplayable </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /* ... */</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> concept</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> IsDebuggable </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /* ... */</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typename</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> U</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> compare_and_print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    requires</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">equality_comparable_with</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">             IsDisplayable</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">             IsDisplayable</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">             IsDebuggable</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">U</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 函数体</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/27/Programming/Rust/Trait%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "https://haoruanwn.github.io/2025/08/27/Programming/Rust/Trait%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "Trait的基本使用（一）",
            "date_published": "2025-08-27T13:54:13.000Z",
            "content_html": "<h2 id=\"一-trait-的本质定义共享行为\"><a class=\"anchor\" href=\"#一-trait-的本质定义共享行为\">#</a> 一、<strong>Trait 的本质：定义共享行为</strong></h2>\n<ul>\n<li><strong>核心类比 (C++)</strong>: <code>trait</code> ≈ 抽象基类 (Abstract Base Class) / 纯虚接口 (Interface)。</li>\n<li><strong>关键区别</strong>: Rust 的 <code>trait</code> 是编译期抽象，且更侧重于行为的“组合”而非类型的“继承”。</li>\n<li><strong>要点</strong>:\n<ul>\n<li>如何定义一个 <code>trait</code>？</li>\n<li>如何为一个类型实现 (<code>impl</code>) <code>trait</code>？</li>\n<li>提供默认实现 (Default Implementation) -&gt; 对比 C++ 抽象基类中的虚函数实现。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-c-中的类比抽象基类\"><a class=\"anchor\" href=\"#1-c-中的类比抽象基类\">#</a> 1. C++ 中的类比：抽象基类</h3>\n<p>在传统的面向对象语言如 C++ 中，实现共享行为通常通过定义一个抽象基类来完成。该基类包含纯虚函数，其他类通过继承这个抽象基类并实现这些纯虚函数来获得共享的行为。</p>\n<h4 id=\"2-定义和实现trait\"><a class=\"anchor\" href=\"#2-定义和实现trait\">#</a> 2、定义和实现trait</h4>\n<p>在 Rust 中，我们通过定义 <code>trait</code> 和为类型 <code>impl</code> 这个 <code>trait</code> 来实现。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1. 定义一个 Trait，就像定义一个接口</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 它只包含方法的签名，不包含具体实现。</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pub</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 定义两个不同的结构体</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pub</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> NewsArticle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    pub</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    pub</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> author</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    pub</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pub</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    pub</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> username</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    pub</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2. 为 NewsArticle 类型实现 (impl) Summary trait</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这告诉编译器，NewsArticle 实例现在具备了 summarize 的能力。</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> NewsArticle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, by </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">author</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 3. 为 Tweet 类型也实现 Summary trait</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> tweeted: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">username</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">content</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> NewsArticle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rust wins another award!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        author</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rustacean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        username</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">johndoe</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">I really love Rust's trait system!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">New article: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">New tweet: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> tweet</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">summarize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"3-提供默认实现\"><a class=\"anchor\" href=\"#3-提供默认实现\">#</a> 3、提供默认实现</h4>\n<p>Trait 中的方法可以拥有默认实现。这意味着实现该 Trait 的类型可以无需覆盖这些方法，直接使用默认行为。这类似于 C++ 中拥有函数体的虚函数。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">pub</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 提供一个有默认实现的方法</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 任何实现 Summary 的类型都会自动获得这个方法</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> read_more</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">(Read more...)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 默认行为</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 为 NewsArticle 实现时，我们只关心必须实现的 summarize</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> NewsArticle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, by </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">headline</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">author</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 我们可以选择覆盖(override)默认实现</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> read_more</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Read more from </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">author</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Summary</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // Tweet 只实现必须的 summarize，它将免费获得默认的 read_more</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> summarize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        format!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> tweeted: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">username</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">content</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> NewsArticle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        headline</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rust wins another award!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        author</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rustacean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Tweet</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        username</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">johndoe</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        content</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">I really love Rust's trait system!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> article</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">read_more</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出: \"Read more from Rustacean...\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> tweet</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">read_more</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 输出: \"(Read more...)\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>类似于c++中的普通虚函数，而不是纯虚函数</p>\n<h4 id=\"问题\"><a class=\"anchor\" href=\"#问题\">#</a> 问题</h4>\n<ol>\n<li>\n<p><strong>必须实现 Trait 中的所有方法吗？</strong></p>\n<p>不是。只需要实现那些没有默认实现的方法，这些方法是强制必须实现的。</p>\n</li>\n<li>\n<p><strong>大部分 Trait 的方法都是默认方法吗？</strong></p>\n<p>是的，Rust 标准库遵循一种“最小化 <code>trait</code>”的设计模式。该模式要求实现者仅需提供一两个最核心的方法，<code>trait</code> 会基于这些核心方法，通过默认实现提供大量便捷的高级功能。</p>\n<p>典型的例子是 <code>Iterator</code> trait。要使自定义类型成为一个迭代器，<strong>唯一必须实现的方法就是 <code>next()</code></strong>。一旦实现了 <code>next()</code>，类型就自动获得了数十个强大的方法，如 <code>map()</code>、<code>filter()</code>、<code>fold()</code>、<code>collect()</code> 等。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 示例：一个从 1 数到 5 的简单迭代器</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    current</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    max</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 我们只需要实现 Iterator trait</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Iterator</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    type</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Item</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 关联类型，指定迭代器返回的元素类型</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 这是我们唯一需要手写的核心方法！</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;mut</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Option</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">Self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Item</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">current </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">max </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">            self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">current </span><span style=\"color:#999999;--shiki-dark:#666666\">+=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            Some</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">current</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            None</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> current</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> max</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 基于 next() 获得的免费功能</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> sum_of_squares_of_even_numbers</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">filter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> num</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> %</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // filter 是默认方法</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">map</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> num</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> num</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       // map 是默认方法</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        .</span><span style=\"color:#59873A;--shiki-dark:#80A665\">sum</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                     // sum 也是默认方法</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Sum: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> sum_of_squares_of_even_numbers</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出: Sum: 20 (即 2*2 + 4*4)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>这些默认方法内部的实现，全都是通过反复调用你提供的那个 <code>next()</code> 方法来完成的。</p>\n<ul>\n<li><strong>与C++的区别</strong>: C++ 标准库不把 <code>map</code>, <code>filter</code> 等功能放在迭代器基类中，而是提供大量的<strong>全局算法函数</strong>（如 <code>std::transform</code>, <code>std::copy_if</code>），这些函数接受一对迭代器作为参数。Rust 的方法链调用方式通常被认为可读性更高。</li>\n</ul>\n</li>\n<li>\n<p><strong>如果 Trait 全是默认方法，编译器如何知道类型实现了它？</strong></p>\n<p>Rust 遵循“显式优于隐式”的原则。即使一个 <code>trait</code> 的所有方法都有默认实现，你<strong>仍然必须为这个类型写一个空的 <code>impl</code> 块</strong>来显式地告诉编译器该类型实现了这个 <code>trait</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 假设 MyTrait 的所有方法都有默认实现</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyTrait</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> do_something</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Default action</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyType</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 必须有这个空的 impl 块</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyTrait</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyType</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> instance</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyType</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    instance</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">do_something</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 可以调用</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"二-trait-的实现规则一致性与孤儿规则\"><a class=\"anchor\" href=\"#二-trait-的实现规则一致性与孤儿规则\">#</a> 二、<strong>Trait 的实现规则：一致性与孤儿规则</strong></h2>\n<ul>\n<li><strong>核心问题</strong>: 谁有权为哪个类型实现哪个 <code>trait</code>？</li>\n<li><strong>C++ 对比</strong>: C++ 没有这个概念，任何地方都可以为任何类写一个自由函数，这有时会导致混乱。孤儿规则系统性地解决了这个问题，保证了代码库的一致性和可维护性。</li>\n<li><strong>要点</strong>: 规则详解：“只要 <code>trait</code> 或者类型其中之一属于当前 <code>crate</code>，就可以为其实现 <code>trait</code>”。</li>\n</ul>\n<h4 id=\"1-c中的对应操作\"><a class=\"anchor\" href=\"#1-c中的对应操作\">#</a> 1、C++中的对应操作</h4>\n<p>在 C++ 中，允许任何人在任何地方为任何类型实现自由函数或重载操作符（只要能访问其定义）。这种灵活性可能导致不可预知的混乱，例如两个不同的第三方库可能为同一个标准库类型重载了相同的操作符，从而引发冲突和不确定性。</p>\n<h4 id=\"2-孤儿原则\"><a class=\"anchor\" href=\"#2-孤儿原则\">#</a> 2、孤儿原则</h4>\n<p>要为一个类型 <code>T</code> 实现一个 <code>trait Tr</code>，那么<strong>类型 <code>T</code></strong> 或 <strong><code>trait Tr</code></strong>，至少有一个必须是在当前 <code>crate</code>（可理解为当前项目或库）中定义的。</p>\n<p>换言之，<strong>不能为一个外部的类型实现一个外部的 <code>trait</code></strong>。这样的实现会像一个没有归属的“孤儿”，因为它既不属于类型 <code>T</code> 的维护者，也不属于 <code>trait Tr</code> 的维护者。</p>\n<p><strong>允许的情况</strong></p>\n<ul>\n<li>\n<p><strong>为 “外部类型” 实现 “本地 Trait”</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1. 定义我们自己的 trait，这是“本地的”。</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">trait</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> CsvDisplay</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> to_csv</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2. 为标准库的 Vec&#x3C;String> (外部类型) 实现我们本地的 CsvDisplay trait。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">//    这是合法的，因为 `CsvDisplay` trait 是在我们当前的 crate 中定义的。</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> CsvDisplay</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Vec</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> to_csv</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> vec!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">name</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">city</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">to_csv</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出: name,age,city</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n</li>\n<li>\n<p><strong>为 “本地类型” 实现 “外部 Trait”</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// my_crate/src/main.rs</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fmt</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1. 定义我们自己的 struct，这是“本地的”。</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Point</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2. 为我们本地的 Point 类型实现标准库的 `Display` trait (外部 trait)。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">//    这是合法的，因为 `Point` 类型是在我们当前的 crate 中定义的。</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Display</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Point</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> f</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;mut</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Formatter</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">_</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Result</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        write!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">(</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">y</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Point</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The point is at: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出: The point is at: (10, -5)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n</li>\n</ul>\n<p><strong>违反孤儿原则的情况</strong></p>\n<p>你不能为标准库的 <code>Vec&lt;i32&gt;</code>（外部类型）实现标准库的 <code>fmt::Display</code>（外部 trait），因为类型和 trait 都定义在当前 <code>crate</code> 之外。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// my_crate/src/main.rs</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">use</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fmt</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 尝试为外部类型 `Vec&#x3C;i32>` 实现外部 trait `Display`</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这段代码无法通过编译！</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Display</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Vec</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> f</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;mut</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Formatter</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">_</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fmt</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Result</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // ... 实现逻辑 ...</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        write!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A vector of integers</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/24/Linux/%E5%AF%B9CPU%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E7%9A%84%E7%90%86%E8%A7%A3/",
            "url": "https://haoruanwn.github.io/2025/08/24/Linux/%E5%AF%B9CPU%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E7%9A%84%E7%90%86%E8%A7%A3/",
            "title": "对CPU高速缓存的理解",
            "date_published": "2025-08-24T15:38:07.000Z",
            "content_html": "<h3 id=\"一-缓存失效的背后三大核心机制\"><a class=\"anchor\" href=\"#一-缓存失效的背后三大核心机制\">#</a> <strong>一、缓存失效的背后：三大核心机制</strong></h3>\n<p><strong>为何CPU高速缓存中的数据会“失效”，其背后的主要机制有哪些？</strong></p>\n<blockquote>\n<p>CPU高速缓存是提升性能的关键，但它并非一个静态的存储区域。缓存中的数据会因为容量限制、多核间的数据同步以及与外部设备交互等多种原因被替换或宣告无效，理解这些机制是优化性能的基础。</p>\n</blockquote>\n<p>CPU缓存中的数据“失效”，通常指数据被替换或被标记为无效，使其无法再被CPU使用。这一过程主要由以下三种机制驱动：</p>\n<ol>\n<li><strong>容量竞争与替换</strong>：CPU缓存的容量非常有限。当缓存已满时，若要载入新的数据，就必须按照某种替换算法（如 <strong>LRU - 最近最少使用算法</strong>）丢弃一些现有的数据。这是最常见和基本的“失效”形式，由缓存自身的物理限制导致。</li>\n<li><strong>多核一致性协议</strong>：在多核处理器中，同一份内存数据可能被多个核心同时加载到各自的缓存中。如果其中一个核心修改了这份数据，其他核心缓存中的副本就变成了过时的“脏数据”。为了保证数据一致性，硬件层面的缓存一致性协议（如 <strong>MESI协议</strong>）会强制将其他核心的这份数据副本标记为“无效”，迫使它们在需要时重新从内存或已更新的核心获取最新版本。</li>\n<li><strong>外部I/O操作</strong>：当外部设备（如网卡、硬盘控制器）通过 <strong>DMA (直接内存访问)</strong> 技术绕过CPU直接向主内存写入数据时，CPU缓存中可能还保留着这块内存区域的旧副本。由于CPU对此操作无感知，其缓存数据已然过期。在这种情况下，必须由软件（通常是驱动程序）显式地执行缓存无效化指令，才能避免CPU读到脏数据。</li>\n</ol>\n<hr />\n<h3 id=\"二-打破亲和性任务迁移的驱动力\"><a class=\"anchor\" href=\"#二-打破亲和性任务迁移的驱动力\">#</a> <strong>二、打破亲和性：任务迁移的驱动力</strong></h3>\n<p><strong>在调度器倾向于维持“CPU亲和性”的情况下，究竟是哪些更高优先级的考量会促使一个任务被主动迁移到其他CPU核心上执行？</strong></p>\n<blockquote>\n<p>为了最大化利用缓存，操作系统调度器会尽量让一个任务保持在同一个CPU核心上运行。然而，为了保证整个系统的响应速度和资源利用率，调度器在某些特定情境下，不得不打破这种“亲和性”，主动进行跨核心的任务迁移。</p>\n</blockquote>\n<p>尽管维持CPU亲和性可以带来显著的性能优势，但操作系统调度器为了更宏观的目标，会在以下几种主要情境下主动进行任务迁移：</p>\n<ol>\n<li><strong>负载均衡 (Load Balancing)</strong>：这是任务迁移最主要的原因。如果系统中的任务都集中在少数几个核心上，导致它们不堪重负，而其他核心却处于空闲，会造成巨大的资源浪费。调度器的负载均衡模块会周期性地检查各核心的负载，并在发现严重失衡时，将任务从繁忙的核心迁移到空闲的核心，以实现所有计算资源的充分利用。</li>\n<li><strong>提升任务响应速度</strong>：当一个因I/O等待而休眠的任务被唤醒时，它原本所在的“亲和”核心可能正在处理一个高优先级的长耗时任务。为了让被唤醒的任务能尽快得到执行，而不是在原核心上排队等待，调度器可能会选择将它迁移到一个当前负载较低或空闲的核心上。</li>\n<li><strong>功耗与性能策略</strong>：现代CPU的功耗管理非常复杂。例如，为了节省能源，某些核心可能处于深度睡眠状态。此时，将一个新任务迁移到已经处于活跃状态的核心上，可能比花费时间和功耗去唤醒一个睡眠核心更具效率。</li>\n</ol>\n<hr />\n<h3 id=\"三-缓存数据的寿命由竞争决定\"><a class=\"anchor\" href=\"#三-缓存数据的寿命由竞争决定\">#</a> <strong>三、缓存数据的“寿命”：由竞争决定</strong></h3>\n<p><strong>缓存中某个任务的“热数据”能够保存多久，是由时间决定的，还是由CPU核心的竞争和访问模式决定的？</strong></p>\n<blockquote>\n<p>当一个任务被换下CPU时，它留在缓存中的“热数据”并不会立刻消失，但其“寿命”却难以预测。这份数据的存留时间并非由一个固定的计时器来管理，而是取决于后续在该CPU核心上运行的其他任务对其造成的影响。</p>\n</blockquote>\n<p>缓存中数据的“寿命”<strong>并非由时间决定，而是完全由该CPU核心上发生的缓存空间竞争激烈程度所决定</strong>。不存在一个“数据过期计时器”。</p>\n<p>数据的存留情况取决于后续在该核心上运行的其他任务的内存访问模式。我们可以设想两种极端情况：</p>\n<ul>\n<li><strong>低竞争环境</strong>：如果一个核心在接下来的很长一段时间内，运行的任务所访问的数据集很小，或者与之前任务的数据在缓存中占用的位置不冲突，那么之前任务的“热数据”就有可能在缓存中存留很长时间。</li>\n<li><strong>高竞争环境</strong>：如果后续运行的任务是一个需要大量内存的 <strong>“缓存破坏者” (Cache Buster)</strong>，它会大量加载自己的数据，迅速地将前一个任务留下的数据从缓存中替换出去。在这种情况下，前一个任务的数据可能在短短几微秒或几毫秒内就完全“蒸发”了。</li>\n</ul>\n<p>因此，缓存数据的存留期是一个动态变化的过程，直接反映了CPU核心上任务切换和内存访问的实时状况。</p>\n<hr />\n<h3 id=\"四-缓存命中高速公路的入口\"><a class=\"anchor\" href=\"#四-缓存命中高速公路的入口\">#</a> <strong>四、“缓存命中”：高速公路的入口</strong></h3>\n<p><strong>“缓存命中”这一概念的准确定义是什么？它与任务上下文切换后期望的“热数据”重用之间是什么关系？</strong></p>\n<blockquote>\n<p>“缓存命中”是衡量缓存效率的核心指标。它描述了一个基础而关键的事件：CPU需要的数据恰好在高速缓存中被找到。理解其准确定义，有助于我们弄清为何CPU亲和性等调度策略对于提升多任务系统的性能至关重要。</p>\n</blockquote>\n<p><strong>“缓存命中” (Cache Hit)</strong> 的准确定义是：CPU在尝试从某个内存地址读取数据或指令时，在高速缓存中直接找到了所需的内容，无需再访问更低速的主内存。这是一次成功的、高效的内存访问。反之，如果在缓存中没有找到，必须去主内存读取，则称为 <strong>“缓存未命中” (Cache Miss)</strong>。</p>\n<p>它与任务上下文切换的关系体现在：</p>\n<p>上下文切换后，任务能否快速恢复高性能，关键就在于其重新执行时缓存命中的概率有多高。</p>\n<ul>\n<li><strong>CPU亲和性策略</strong>的目的，就是为了让一个任务在被切换出去又切换回来后，能够大概率地在 <strong>同一个CPU核心</strong> 上运行。</li>\n<li>这样做的<strong>最终目标</strong>，是为了让这个任务能够重用上次运行时留在该核心缓存中的 <strong>“热数据”</strong>。</li>\n<li>当任务成功重用这些数据时，就表现为<strong>大量的缓存命中</strong>，从而避免了因缓存未命中而去访问慢速主内存所带来的巨大性能损失。</li>\n</ul>\n<p>简而言之，CPU亲和性是一种<strong>策略</strong>，而缓存命中是该策略成功时所获得的<strong>收益</strong>。</p>\n<hr />\n<h3 id=\"五-单片机中的缓存权责分明\"><a class=\"anchor\" href=\"#五-单片机中的缓存权责分明\">#</a> <strong>五、单片机中的缓存：权责分明</strong></h3>\n<p><strong>对于带有缓存的单片机（如Cortex-M7），其缓存工作机制与通用处理器相比，在内存模型和开发者责任方面最核心的区别是什么？</strong></p>\n<blockquote>\n<p>缓存并非大型CPU的专利，诸如STM32H7系列的高性能单片机也配备了缓存。然而，由于其硬件架构和应用场景的差异，这类嵌入式系统中的缓存工作原理、尤其是在与RTOS和DMA交互时，与我们熟悉的Linux系统存在着根本性的不同。</p>\n</blockquote>\n<p>其核心区别源于有无 <strong>MMU (内存管理单元)</strong>，这直接导致了内存模型和开发者责任的巨大差异。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">通用处理器 (如Linux系统)</th>\n<th style=\"text-align:left\">高性能单片机 (如Cortex-M7)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>核心硬件</strong></td>\n<td style=\"text-align:left\">拥有 <strong>MMU (内存管理单元)</strong></td>\n<td style=\"text-align:left\">通常<strong>无MMU</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>内存模型</strong></td>\n<td style=\"text-align:left\"><strong>虚拟内存</strong>，进程拥有独立地址空间</td>\n<td style=\"text-align:left\"><strong>物理内存</strong>，所有任务共享同一地址空间</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>缓存一致性</strong></td>\n<td style=\"text-align:left\">由<strong>操作系统和驱动</strong>自动处理</td>\n<td style=\"text-align:left\">责任落在<strong>嵌入式开发者</strong>身上</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>开发者操作</strong></td>\n<td style=\"text-align:left\">无需关心底层缓存细节</td>\n<td style=\"text-align:left\">必须<strong>手动调用</strong> <code>SCB_CleanDCache</code> 等函数进行缓存维护</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "Linux",
                "CPU缓存"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/24/Linux/%E5%AF%B9Linux%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E7%9A%84%E7%90%86%E8%A7%A3/",
            "url": "https://haoruanwn.github.io/2025/08/24/Linux/%E5%AF%B9Linux%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E7%9A%84%E7%90%86%E8%A7%A3/",
            "title": "对Linux任务调度的理解",
            "date_published": "2025-08-24T15:13:29.000Z",
            "content_html": "<h3 id=\"一-统一的调度单元任务task\"><a class=\"anchor\" href=\"#一-统一的调度单元任务task\">#</a> <strong>一、统一的调度单元：任务（Task）</strong></h3>\n<p><strong>Linux调度器进行上下文切换的基本单位究竟是什么，它又是如何统一进程与线程这两个概念的呢？</strong></p>\n<blockquote>\n<p>操作系统中同时存在进程和线程，它们都需要CPU资源且都会发生上下文切换。为了高效管理，调度器并非在两种不同类型的实体间做选择，而是将它们抽象成一个统一的调度单元。</p>\n</blockquote>\n<p>在Linux内核的视角中，进行调度和上下文切换的基本单位是<strong>任务（task）</strong>，它由一个名为 <code>task_struct</code> 的数据结构来描述。这种设计巧妙地统一了进程和线程的概念。</p>\n<p>具体来说，一个<strong>进程</strong>被视为一个资源的集合（如虚拟内存空间、文件描述符等），以及至少一个执行流。当一个进程被创建时，内核会创建一个代表其主执行流的“任务”，这个任务就是主线程。</p>\n<p>如果这个进程通过系统调用（如 <code>clone()</code>）创建了新的<strong>线程</strong>，内核所做的仅仅是创建了一个新的“任务”。这个新任务会共享其父进程的资源（如内存空间），但拥有自己独立的CPU状态、寄存器和栈，因此可以被独立调度。</p>\n<p>因此，调度器无需关心它正在处理的是“进程”还是“线程”。它只维护一个所有可运行“任务”的列表，并从中选择下一个来执行。这种统一的抽象大大简化了调度器的设计和实现。</p>\n<h3 id=\"二-切换的代价轻量级与重量级\"><a class=\"anchor\" href=\"#二-切换的代价轻量级与重量级\">#</a> <strong>二、切换的代价：轻量级与重量级</strong></h3>\n<p><strong>同样是线程切换，为何在同一进程内的成本会远低于跨进程切换，其背后最主要的开销差异体现在哪里？</strong></p>\n<blockquote>\n<p>上下文切换的成本并非一成不变。当CPU的控制权从一个线程转移到另一个线程时，如果两个线程共享同一个内存空间，切换就相对轻快；反之，如果它们分属不同进程，切换过程就需要处理更复杂的重量级资源，导致开销剧增。</p>\n</blockquote>\n<p>这两种切换成本差异的根源在于是否需要更换<strong>虚拟内存空间</strong>。</p>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>同进程内切换 (轻量级)</th>\n<th>跨进程切换 (重量级)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>共享资源</strong></td>\n<td>共享同一虚拟内存空间、文件描述符等</td>\n<td>拥有独立的虚拟内存空间和资源</td>\n</tr>\n<tr>\n<td><strong>核心操作</strong></td>\n<td>保存/恢复线程私有的CPU寄存器、栈指针等</td>\n<td>除线程私有状态外，还需切换整个页表</td>\n</tr>\n<tr>\n<td><strong>主要开销</strong></td>\n<td>仅CPU状态切换，速度快</td>\n<td>内存管理单元(MMU)相关操作，开销大</td>\n</tr>\n<tr>\n<td><strong>缓存影响</strong></td>\n<td>对 <strong>TLB</strong> (转译后备缓冲器) 无影响</td>\n<td>导致 <strong>TLB</strong> 大部分失效，引起性能下降</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"三-完全公平的实现虚拟运行时间vruntime\"><a class=\"anchor\" href=\"#三-完全公平的实现虚拟运行时间vruntime\">#</a> <strong>三、完全公平的实现：虚拟运行时间（vruntime）</strong></h3>\n<p><strong>Linux的CFS调度器是如何通过“虚拟运行时间”（vruntime）这一核心机制，来实现其“完全公平”的调度策略的？</strong></p>\n<blockquote>\n<p>为了在多任务环境中实现公平，调度器不能简单地轮流分配时间。CFS（完全公平调度器）引入了一个精巧的机制，它追踪每个任务“应得”的运行时间，并总是优先选择那个“受委屈最多”的任务，从而在宏观上达到公平。</p>\n</blockquote>\n<p>CFS (Completely Fair Scheduler) 的核心目标并非让每个任务获得绝对相等的时间片，而是让每个任务获得与其权重（优先级）相称的<strong>CPU使用比例</strong>。它通过<strong>虚拟运行时间 (<code>vruntime</code>)</strong> 这一机制来实现这一目标。</p>\n<p>每个任务都有一个 <code>vruntime</code> 计数器。当任务在CPU上运行时，它的 <code>vruntime</code> 会不断增长。这个增长的速度会根据任务的优先级进行加权：高优先级任务的 <code>vruntime</code> 增长得<em>慢</em>，低优先级任务的 <code>vruntime</code> 增长得<em>快</em>。</p>\n<p>CFS调度器的调度规则只有一条：<strong>在所有可运行的任务中，永远选择 vruntime 值最小的那个任务来执行。</strong></p>\n<p>这个简单的规则确保了那个在“虚拟时间”上等待最久（即“受委屈最多”）的任务能够优先获得CPU。因为高优先级任务的 <code>vruntime</code> 跑得慢，所以它能获得更多的实际运行时间，才能让自己的 <code>vruntime</code> 追上其他任务。这样，CFS就将复杂的调度问题转化为了一个简单的“谁最小，谁运行”的问题，从而实现了对所有任务的公平调度。</p>\n<h3 id=\"四-公平与效率的平衡术\"><a class=\"anchor\" href=\"#四-公平与效率的平衡术\">#</a> <strong>四、公平与效率的平衡术</strong></h3>\n<p><strong>既然调度器的首要原则是公平，那么它采用了哪些策略来间接缓解高昂的跨进程切换开销对系统整体吞吐量的影响，从而在公平与效率之间取得平衡？</strong></p>\n<blockquote>\n<p>一个理想的调度器不仅要公平，还要高效。如果为了绝对公平而频繁地进行高成本的进程切换，系统总性能会下降。因此，调度器在坚守其公平原则的同时，也必须内建一些机制来摊薄和优化这些切换带来的开销。</p>\n</blockquote>\n<p>调度器在坚守“公平”（<code>vruntime</code>优先）这一首要原则的同时，通过以下几种策略来兼顾效率，缓解高昂切换成本带来的影响：</p>\n<ol>\n<li><strong>最小调度粒度 (Minimum Granularity)</strong>：调度器会确保任何一个任务一旦被调度上CPU，至少会运行一个最小的时间（例如1-2毫秒）。这就避免了因任务过多导致时间片被无限细分，从而使得CPU把大量时间浪费在“切换”而非“执行”上的情况。这个机制相当于为每一次上下文切换的成本设置了一个“保底”的有效工作时间，从而摊薄了开销。</li>\n<li><strong>目标延迟 (Target Latency)</strong>：CFS会尝试在一个可配置的时间周期（目标延迟，如20毫秒）内，让所有可运行的任务都至少执行一次。它会根据当前可运行任务的数量来动态计算每个任务应得的时间片。这在任务数量较少时，可以提供更长的执行时间，减少切换频率；在任务数量多时，又能保证较低的响应延迟。</li>\n<li><strong>智能唤醒策略</strong>：当一个任务从睡眠中被唤醒时，调度器会智能地决定将它放到哪个CPU的运行队列中。它通常会优先选择任务上次运行的CPU，或者唤醒它的任务所在的CPU，以期提高缓存的利用率，这与下一节的CPU亲和性紧密相关。</li>\n</ol>\n<h3 id=\"五-缓存的价值cpu亲和性\"><a class=\"anchor\" href=\"#五-缓存的价值cpu亲和性\">#</a> <strong>五、缓存的价值：CPU亲和性</strong></h3>\n<p><strong>CPU亲和性策略具体是如何通过提升缓存命中率，来显著降低任务因上下文切换（尤其是在CPU核心间迁移）而导致的性能损失的？</strong></p>\n<blockquote>\n<p>上下文切换的代价不仅在于切换操作本身，更在于其对CPU高速缓存的破坏性影响。调度器通过一种名为“CPU亲和性”的策略，试图让任务“记住”它上次运行的核心，从而最大化地重用缓存中的“热”数据，避免昂贵的内存访问。</p>\n</blockquote>\n<p><strong>CPU亲和性 (Cache Affinity)</strong> 并不减少上下文切换本身的直接开销（如保存寄存器），但它能极大地缓解切换带来的<strong>间接性能损失</strong>，这个损失主要来源于CPU高速缓存的失效。</p>\n<p>其工作原理如下：</p>\n<p>当一个任务在某个CPU核心上运行时，它所需要的数据和指令会被加载到该核心的 <code>L1</code>、<code>L2</code> 甚至 <code>L3</code> 缓存中。我们称这个缓存是<strong>热的 (hot)</strong>。从缓存中读取数据的速度比从主内存读取要快几个数量级。</p>\n<p>如果该任务被切换出去，稍后又被调度器放回<strong>同一个CPU核心</strong>上运行，那么它之前留在缓存中的数据有很大概率仍然存在。任务可以立刻高速地访问这些“热”数据，迅速恢复到最佳运行性能。</p>\n<p>相反，如果调度器将这个任务迁移到<strong>另一个CPU核心</strong>上，新核心的缓存对这个任务来说是<strong>冷的 (cold)</strong>。任务必须重新从缓慢的主内存中加载所有需要的数据，这个过程会造成显著的性能瓶颈。</p>\n<p>因此，CPU亲和性策略就是<strong>让调度器“倾向于”将一个任务调度回它上一次执行的那个CPU核心上</strong>。通过维持这种“亲和性”，调度器最大化了缓存的重用率，显著减少了因任务迁移带来的性能惩罚，从而在宏观上提升了整个系统的运行效率。</p>\n",
            "tags": [
                "Linux",
                "任务调度"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/24/ENV_CONFIG/%E8%B0%83%E8%AF%95USB%E6%91%84%E5%83%8F%E5%A4%B4/",
            "url": "https://haoruanwn.github.io/2025/08/24/ENV_CONFIG/%E8%B0%83%E8%AF%95USB%E6%91%84%E5%83%8F%E5%A4%B4/",
            "title": "调试USB摄像头",
            "date_published": "2025-08-24T12:21:57.000Z",
            "content_html": "<h1 id=\"usb摄像头带麦克风和扬声器调试\"><a class=\"anchor\" href=\"#usb摄像头带麦克风和扬声器调试\">#</a> USB摄像头（带麦克风和扬声器）调试</h1>\n<p>带麦克风咪头和扬声器的USB摄像头<br />\n<img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250824202654485.jpg\" alt=\"qq_pic_merged_1756038364912\" /></p>\n<h2 id=\"摄像头探测\"><a class=\"anchor\" href=\"#摄像头探测\">#</a> 摄像头探测</h2>\n<p>首先，需要确认摄像头设备是否被系统正确识别。</p>\n<ol>\n<li>\n<p>列出USB设备</p>\n<p>使用lsusb命令可以查看所有连接到系统的USB设备。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> lsusb</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0003</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 003</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 004</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 004</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 002:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 349c:3307</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Generic</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> HD</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 005</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 006</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span></code></pre>\n<p>其中<code>HD video</code>就是我们的USB摄像头。</p>\n</li>\n<li>\n<p>查看视频设备节点</p>\n<p>系统会为视频设备创建相应的设备文件。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">/dev/video0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  /dev/video1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  /dev/video2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  /dev/video5</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  /dev/video-dec1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  /dev/video-dec2</span></span></code></pre>\n</li>\n<li>\n<p>使用v4l-utils工具</p>\n<p>v4l-utils是一个强大的视频设备调试工具集，可以提供更详细的设备信息。如果系统未安装，请先安装。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt-get</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l-utils</span></span></code></pre>\n<p>使用<code>v4l2-ctl</code>列出所有视频设备及其关联的设备节点。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2-ctl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --list-devices</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">rockchip,rk3328-vpu-dec</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">platform:fdea0000.video-codec</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video2</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/media1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">rockchip,rk3568-vepu-enc</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">platform:fdee0000.video-codec</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video5</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/media3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">rockchip-rga</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">platform:rga</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">rkvdec2</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">platform:rkvdec2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/media0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">HD</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  :</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> HD</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">usb-fd840000.usb-1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video3</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/video4</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        /dev/media2</span></span></code></pre>\n<p>从输出中可以看到，名为<code>HD video</code>的USB摄像头关联了<code>/dev/video3</code>和<code>/dev/video4</code>两个设备节点。</p>\n</li>\n</ol>\n<h2 id=\"查看摄像头参数\"><a class=\"anchor\" href=\"#查看摄像头参数\">#</a> 查看摄像头参数</h2>\n<p>接下来，我们需要确定哪个设备节点是有效的，并查看其支持的视频格式、分辨率和帧率。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2-ctl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video4</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --list-formats-ext</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ioctl:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> VIDIOC_ENUM_FMT</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        Type:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Video</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Capture</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2-ctl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --list-formats-ext</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ioctl:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> VIDIOC_ENUM_FMT</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        Type:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Video</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Capture</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">MJPG</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Motion-JPEG, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">compressed</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Size:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1280x720</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.067s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">15.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.100s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">10.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Size:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 800x480</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.050s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">20.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.067s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">15.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Size:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 640x480</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.040s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">25.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.067s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">15.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Size:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 480x320</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.040s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">25.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.067s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">15.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Size:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 480x854</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.040s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">25.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                        Interval:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Discrete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.050s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">20.000 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>结果表明，<code>/dev/video4</code>不支持视频捕获格式，而<code>/dev/video3</code>支持<code>MJPG</code>格式，并列出了多种分辨率和帧率的组合。因此，我们应该使用<code>/dev/video3</code>作为视频输入设备。</p>\n<h2 id=\"使用摄像头\"><a class=\"anchor\" href=\"#使用摄像头\">#</a> 使用摄像头</h2>\n<h3 id=\"拍照\"><a class=\"anchor\" href=\"#拍照\">#</a> 拍照</h3>\n<p>使用<code>ffmpeg</code>从摄像头捕获一帧图像并保存为图片。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ffmpeg</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -ss</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.5</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -vframes</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -update</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">您的文件名.jp</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">g</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<h3 id=\"录制视频无声\"><a class=\"anchor\" href=\"#录制视频无声\">#</a> 录制视频（无声）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ffmpeg</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -input_format</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mjpeg</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1280x720</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c:v</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> copy</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> output.mkv</span></span></code></pre>\n<p>在终端里按<code>Ctrl + C</code>停止录制。</p>\n<p><strong>参数说明:</strong></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-f v4l2</code></td>\n<td>强制使用<code>v4l2</code>驱动。</td>\n</tr>\n<tr>\n<td><code>-input_format mjpeg</code></td>\n<td>指定输入流是摄像头支持的<code>mjpeg</code>格式。</td>\n</tr>\n<tr>\n<td><code>-s 1280x720</code></td>\n<td>设置视频分辨率。</td>\n</tr>\n<tr>\n<td><code>-r 15</code></td>\n<td>设置视频帧率。</td>\n</tr>\n<tr>\n<td><code>-i /dev/video3</code></td>\n<td>指定输入设备。</td>\n</tr>\n<tr>\n<td><code>-c:v copy</code></td>\n<td>直接复制视频流，不进行重新编码，以降低CPU消耗。</td>\n</tr>\n<tr>\n<td><code>output.mkv</code></td>\n<td>输出的视频文件名。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>注意</strong>: 分辨率和帧率需要选择摄像头支持的组合。根据探测结果，<code>1280x720</code>分辨率下支持<code>15.000 fps</code>。</p>\n<h2 id=\"音频设备探测\"><a class=\"anchor\" href=\"#音频设备探测\">#</a> 音频设备探测</h2>\n<p>使用<code>aplay</code>和<code>arecord</code>命令探测播放和录音设备。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> aplay</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -l</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">****</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> List of PLAYBACK Hardware Devices </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">****</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">card</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">HD </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">video],</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> USB</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Audio</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">USB </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Audio]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1/1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevice</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0: subdevice #0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">card</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> RK809</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Analog </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">RK809],</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fe410000.i2s-rk817-hifi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rk817-hifi-0</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fe410000.i2s-rk817-hifi </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rk817-hifi-0]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0/1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevice</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0: subdevice #0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">hao@lckfb-taishanpi:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> arecord</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -l</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">****</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> List of CAPTURE Hardware Devices </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">****</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">card</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">HD </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">video],</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> USB</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Audio</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">USB </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Audio]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1/1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevice</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0: subdevice #0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">card</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> RK809</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Analog </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">RK809],</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fe410000.i2s-rk817-hifi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rk817-hifi-0</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fe410000.i2s-rk817-hifi </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rk817-hifi-0]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0/1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Subdevice</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0: subdevice #0</span></span></code></pre>\n<p><strong>设备列表:</strong></p>\n<table>\n<thead>\n<tr>\n<th>设备名称</th>\n<th>类型</th>\n<th>声卡号 (Card)</th>\n<th>设备号 (Device)</th>\n<th>ALSA标识</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>HD video</strong></td>\n<td>播放 &amp; 录制</td>\n<td>0</td>\n<td>0</td>\n<td><code>hw:0,0</code></td>\n</tr>\n<tr>\n<td><strong>Analog RK809</strong></td>\n<td>播放 &amp; 录制</td>\n<td>1</td>\n<td>0</td>\n<td><code>hw:1,0</code></td>\n</tr>\n</tbody>\n</table>\n<p>我们的USB摄像头集成了麦克风和扬声器，被识别为声卡0。</p>\n<h2 id=\"使用音频设备\"><a class=\"anchor\" href=\"#使用音频设备\">#</a> 使用音频设备</h2>\n<h3 id=\"录制有声视频\"><a class=\"anchor\" href=\"#录制有声视频\">#</a> 录制有声视频</h3>\n<p>结合视频和音频输入，录制带有声音的视频。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ffmpeg</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> v4l2</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -input_format</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mjpeg</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/video3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> alsa</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -channels</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hw:0,0</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c:v</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> copy</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c:a</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> aac</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> video_with_audio.mp4</span></span></code></pre>\n<p><strong>新增音频参数说明:</strong></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-f alsa</code></td>\n<td>强制使用<code>alsa</code>作为音频驱动。</td>\n</tr>\n<tr>\n<td><code>-channels 1</code></td>\n<td>设置音频通道为单声道。某些设备可能不支持双声道录制。</td>\n</tr>\n<tr>\n<td><code>-i hw:0,0</code></td>\n<td>指定音频输入设备（声卡0，设备0）。</td>\n</tr>\n<tr>\n<td><code>-c:a aac</code></td>\n<td>指定音频编码器为<code>aac</code>。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"播放音频\"><a class=\"anchor\" href=\"#播放音频\">#</a> 播放音频</h3>\n<ul>\n<li>\n<p><strong>使用<code>aplay</code>播放<code>.wav</code>格式文件</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">aplay</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hw:0,0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> test_sound.wav</span></span></code></pre>\n<p><code>-D hw:0,0</code>明确指定使用声卡0，设备0进行播放。</p>\n</li>\n<li>\n<p>使用ffplay播放多种格式音频</p>\n<p>ffplay可以播放mp3等多种格式，并且能自动选择默认声卡。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ffplay</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> music.mp3</span></span></code></pre>\n</li>\n</ul>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "音视频"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/22/ENV_CONFIG/%E4%BD%BF%E7%94%A8Docker%E5%AE%89%E8%A3%85%E5%B9%B6%E8%BF%90%E8%A1%8CVivado%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/",
            "url": "https://haoruanwn.github.io/2025/08/22/ENV_CONFIG/%E4%BD%BF%E7%94%A8Docker%E5%AE%89%E8%A3%85%E5%B9%B6%E8%BF%90%E8%A1%8CVivado%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/",
            "title": "使用Docker安装并运行Vivado开发套件",
            "date_published": "2025-08-21T16:06:40.000Z",
            "content_html": "<h1 id=\"使用-docker-安装并运行-vivado-开发套件\"><a class=\"anchor\" href=\"#使用-docker-安装并运行-vivado-开发套件\">#</a> 使用 Docker 安装并运行 Vivado 开发套件</h1>\n<p>本文档旨在记录如何通过 Docker 来安装和运行 Xilinx Vivado 开发套件，以实现开发环境的隔离与快速部署。</p>\n<h2 id=\"1-修复语言环境问题的-dockerfile\"><a class=\"anchor\" href=\"#1-修复语言环境问题的-dockerfile\">#</a> 1. 修复语言环境问题的 Dockerfile</h2>\n<p>基础镜像 <code>gusanagy/xilinx-vivado:2024.1-x11</code> 存在语言环境（locale）配置问题，可能导致部分 GUI 工具无法正常启动。通过以下 <code>Dockerfile</code> 可以修复此问题。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-dockerfile\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gusanagy/xilinx-vivado:2024.1-x11</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 切换到 root 用户以获得安装权限</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 修复命令，来安装并生成语言环境</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RUN</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> apt-get update &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    apt-get install -y locales &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    sed -i -e </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">'s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /etc/locale.gen &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    dpkg-reconfigure --frontend=noninteractive locales</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将修复好的语言环境设置为系统默认</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ENV</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> LANG en_US.UTF-8</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ENV</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> LANGUAGE en_US:en</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ENV</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> LC_ALL en_US.UTF-8</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 切换回镜像默认的非 root 用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> vivadouser</span></span></code></pre>\n<h2 id=\"2-配置-docker-composeyml\"><a class=\"anchor\" href=\"#2-配置-docker-composeyml\">#</a> 2. 配置 docker-compose.yml</h2>\n<p>为了简化容器的启动和管理，我们使用 <code>docker-compose.yml</code> 文件来定义服务。该配置包含了 GUI 转发、工作目录挂载以及可选的硬件设备映射。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yaml\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">services</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  vivado</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    build</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> .</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    image</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vivado-fixed:2024.1</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    container_name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vivado</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    stdin_open</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    tty</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    environment</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> DISPLAY=$&#123;DISPLAY&#125;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # - XAUTHORITY=$&#123;XAUTHORITY&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    volumes</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /tmp/.X11-unix:/tmp/.X11-unix</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # - ~/.Xauthority:/home/vivadouser/.Xauthority:ro</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .:/home/vivadouser/workspace</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    working_dir</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/vivadouser/workspace</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # (可选) 挂载JTAG等硬件设备</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # devices:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    #   - \"/dev/xilinx_jtag:/dev/xilinx_jtag\"</span></span></code></pre>\n<h2 id=\"3-构建镜像并启动容器\"><a class=\"anchor\" href=\"#3-构建镜像并启动容器\">#</a> 3. 构建镜像并启动容器</h2>\n<p>将上述两个文件放置在同一目录下，然后执行以下命令来构建镜像并以守护进程模式（<code>-d</code>）启动容器。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span></code></pre>\n<p>对于旧版本的 Docker，可能需要使用 <code>docker-compose</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker-compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span></code></pre>\n<h2 id=\"4-启动-vivado-图形化界面\"><a class=\"anchor\" href=\"#4-启动-vivado-图形化界面\">#</a> 4. 启动 Vivado 图形化界面</h2>\n<p>容器成功运行后，按照以下步骤进入容器并启动 Vivado。</p>\n<h3 id=\"41-进入容器内部\"><a class=\"anchor\" href=\"#41-进入容器内部\">#</a> 4.1 进入容器内部</h3>\n<p>执行 <code>docker exec</code> 命令进入容器的交互式终端。推荐使用 <code>-u vivadouser</code> 参数以非 root 用户身份登录，以避免潜在的权限问题。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> exec</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -it</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vivadouser</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vivado</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bash</span></span></code></pre>\n<h3 id=\"42-初始化环境变量\"><a class=\"anchor\" href=\"#42-初始化环境变量\">#</a> 4.2 初始化环境变量</h3>\n<p>在容器的 shell 中，首先需要 source Vivado 的设置脚本来配置必要的环境变量。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">source</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/vivadouser/Vivado/2024.1/settings64.sh</span></span></code></pre>\n<h3 id=\"43-启动图形化界面\"><a class=\"anchor\" href=\"#43-启动图形化界面\">#</a> 4.3 启动图形化界面</h3>\n<p>最后，执行 <code>vivado</code> 命令启动 Vivado 的图形化界面。使用 <code>&amp;</code> 将其置于后台运行，以免阻塞当前终端。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">vivado</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x26;</span></span></code></pre>\n<h2 id=\"5-注意事项\"><a class=\"anchor\" href=\"#5-注意事项\">#</a> 5. 注意事项</h2>\n<ul>\n<li><strong>镜像体积</strong>：基础镜像 <code>gusanagy/xilinx-vivado</code> 体积接近 25GB，请确保本地磁盘空间充足且网络条件良好，以便顺利拉取。</li>\n<li><strong>X11 转发</strong>：在 Linux 主机上，<code>docker-compose.yml</code> 中的 <code>DISPLAY</code> 和 <code>/tmp/.X11-unix</code> 挂载通常足以实现 GUI 转发。在 macOS 或 Windows (WSLg) 上，可能需要额外的 X Server 配置。</li>\n</ul>\n",
            "tags": [
                "FPGA/ZYNQ",
                "Vivado"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Enum/",
            "url": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Enum/",
            "title": "Rust中的Enum",
            "date_published": "2025-08-20T15:08:51.000Z",
            "content_html": "<h1 id=\"rust-中的枚举-enum\"><a class=\"anchor\" href=\"#rust-中的枚举-enum\">#</a> Rust 中的枚举 (Enum)</h1>\n<p>枚举（Enumeration）是一种允许我们列举所有可能的值来定义一个类型的方式。</p>\n<h2 id=\"定义枚举\"><a class=\"anchor\" href=\"#定义枚举\">#</a> 定义枚举</h2>\n<p>我们可以使用 <code>enum</code> 关键字来定义一个枚举类型，它的每个成员（变体）都可以代表一种可能的值。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">enum</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> IpAddrKind</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    V4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    V6</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"将数据附加到枚举变体\"><a class=\"anchor\" href=\"#将数据附加到枚举变体\">#</a> 将数据附加到枚举变体</h3>\n<p>Rust 的枚举一个强大的功能是，每个变体都可以关联不同类型和数量的数据。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">enum</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> IpAddrKind</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    V4</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    V6</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> home</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> IpAddrKind</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">V4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> loopback</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> IpAddrKind</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">V6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">::1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>我们还可以为每个变体定义不同类型和结构的关联数据。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">enum</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Message</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Quit</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Move</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 关联一个匿名结构体</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    Write</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           // 关联一个 String</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ChangeColor</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">u8</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 关联一个三元组</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"为枚举实现方法\"><a class=\"anchor\" href=\"#为枚举实现方法\">#</a> 为枚举实现方法</h2>\n<p>与结构体类似，我们也可以使用 <code>impl</code> 关键字为枚举定义方法。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Message</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> process</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        match</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            Message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Quit</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Quit message received</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            Message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Move</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Move message received: x=</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, y=</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            Message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Write</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">text</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Write message received: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> text</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">            Message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ChangeColor</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> g</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ChangeColor message received: r=</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, g=</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, b=</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> r</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> g</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"option-枚举\"><a class=\"anchor\" href=\"#option-枚举\">#</a> <code>Option</code> 枚举</h2>\n<p><code>Option</code> 是一个由标准库定义的非常重要的枚举。它用于处理一个值可能存在或不存在的情况，有效地替代了其他语言中普遍存在的 <code>null</code>。</p>\n<p><code>Option&lt;T&gt;</code> 的定义如下：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">enum</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Option</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Some</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">T</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 表示存在一个 T 类型的值</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    None</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 表示不存在值</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>使用 <code>Option</code> 可以让编译器强制我们处理值不存在的情况，从而提高代码的健壮性。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i8</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Option</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i8</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Some</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 为了处理 y 可能为 None 的情况，不能直接将 x 和 y 相加</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 必须使用 match 表达式来处理</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">match</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Some</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">val</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x + y = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> val</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    None</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">y is None</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"match-控制流运算符\"><a class=\"anchor\" href=\"#match-控制流运算符\">#</a> <code>match</code> 控制流运算符</h2>\n<p><code>match</code> 是 Rust 中一个强大的控制流运算符，它允许我们将一个值与一系列模式进行比较，并根据匹配的模式执行相应的代码。<code>match</code> 常常与枚举一起使用，以确保我们处理了所有可能的变体。</p>\n<p><code>match</code> 的匹配是穷尽的，这意味着我们必须为所有可能的值提供一个分支。这在处理枚举时特别有用，因为编译器会检查是否遗漏了任何变体。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">enum</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Coin</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Penny</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Nickel</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Dime</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">    Quarter</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> value_in_cents</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">coin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Coin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    match</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> coin</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Coin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Penny</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Coin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Nickel</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Coin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Dime</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">        Coin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Quarter</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 25</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Struct/",
            "url": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Struct/",
            "title": "Rust中的Struct",
            "date_published": "2025-08-20T15:08:30.000Z",
            "content_html": "<h1 id=\"rust-中的结构体-struct\"><a class=\"anchor\" href=\"#rust-中的结构体-struct\">#</a> Rust 中的结构体 (Struct)</h1>\n<p>结构体（Struct）是一种自定义数据类型，允许你将多个相关的值组合在一起，并为每个值命名。</p>\n<h2 id=\"定义与实例化\"><a class=\"anchor\" href=\"#定义与实例化\">#</a> 定义与实例化</h2>\n<p>使用 <code>struct</code> 关键字来定义一个结构体，并在花括号中为所有字段指定名称和类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 定义一个结构体</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    email</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建结构体实例</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user1</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    email</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">alice@example.com</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"结构体更新语法\"><a class=\"anchor\" href=\"#结构体更新语法\">#</a> 结构体更新语法</h3>\n<p>当你想要基于另一个结构体实例来创建一个新实例，并且只更改其中少量字段时，可以使用 <code>..</code> 语法。这会使用未显式设置的字段的旧实例中的值。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user2</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    email</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello@gmail.com</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    ..</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // user1 的 name 和 age 字段会被用于 user2</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h2 id=\"元组结构体-tuple-structs\"><a class=\"anchor\" href=\"#元组结构体-tuple-structs\">#</a> 元组结构体 (Tuple Structs)</h2>\n<p>元组结构体是一种类似于元组的结构体，其字段没有名称，只有类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> UserTuple</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> UserTuple2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user3</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> UserTuple</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 25</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bob@example.com</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>注意</strong>：即使两个元组结构体具有完全相同的字段类型，它们也是不同的类型。例如，<code>UserTuple</code> 和 <code>UserTuple2</code> 是不可互换的。</p>\n<h2 id=\"使用-derive-trait-增加功能\"><a class=\"anchor\" href=\"#使用-derive-trait-增加功能\">#</a> 使用 <code>derive</code> trait 增加功能</h2>\n<p>我们可以通过 <code>#[derive]</code> 注解为结构体自动实现某些 trait。例如，<code>Debug</code> trait 允许我们使用 <code>&#123;:?&#125;</code> 或 <code>&#123;:#?&#125;</code> 格式化字符串来打印结构体实例，这对于调试非常有用。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">derive</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Debug</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">struct</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rect1</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 使用 Debug trait 进行打印</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:#?</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rect1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h2 id=\"结构体方法\"><a class=\"anchor\" href=\"#结构体方法\">#</a> 结构体方法</h2>\n<p>方法与函数类似，但它们在结构体（或枚举、trait对象）的上下文中定义，并且它们的第一个参数总是 <code>self</code>，代表调用该方法的结构体实例。</p>\n<h3 id=\"定义方法\"><a class=\"anchor\" href=\"#定义方法\">#</a> 定义方法</h3>\n<p>方法在 <code>impl</code> (implementation) 块中定义。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 方法的第一个参数永远是 self</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 计算面积，该方法借用了 Rectangle 实例的不可变引用</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> area</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">height</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 判断一个矩形能否容纳另一个矩形</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> can_hold</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> other</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Rectangle</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> bool</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> other</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;&#x26;</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">height </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> other</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">height</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 可变方法，借用了实例的可变引用，可以修改实例的字段</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> set_width</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;mut</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> width</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th><code>self</code> 类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&amp;self</code></td>\n<td>对实例的不可变借用，用于只读操作。</td>\n</tr>\n<tr>\n<td><code>&amp;mut self</code></td>\n<td>对实例的可变借用，用于修改实例的状态。</td>\n</tr>\n<tr>\n<td><code>self</code></td>\n<td>获取实例的所有权，将其移出调用者。</td>\n</tr>\n</tbody>\n</table>\n<p>调用可变方法：</p>\n<p>可变方法必须由一个可变的结构体实例来调用。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rect3</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rect3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">set_width</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Rectangle 3 的宽度是 </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rect3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"关联函数-associated-functions\"><a class=\"anchor\" href=\"#关联函数-associated-functions\">#</a> 关联函数 (Associated Functions)</h3>\n<p><code>impl</code> 块中也可以定义不以 <code>self</code> 作为第一个参数的函数，这被称为关联函数。它们通常用作构造函数。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">impl</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 这是一个关联函数，因为它没有 self 参数</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // Self 是当前 impl 块中类型的别名，即 Rectangle</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> square</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">size</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u32</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> Self</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        Self</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">            width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">            height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>关联函数使用 <code>::</code> 语法调用，而不是 <code>.</code> 语法。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 调用关联函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rect2</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> Rectangle</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">square</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Slice/",
            "url": "https://haoruanwn.github.io/2025/08/20/Programming/Rust/Rust%E4%B8%AD%E7%9A%84Slice/",
            "title": "Rust中的Slice",
            "date_published": "2025-08-20T15:07:41.000Z",
            "content_html": "<h1 id=\"rust-中的字符串切片-string-slice\"><a class=\"anchor\" href=\"#rust-中的字符串切片-string-slice\">#</a> Rust 中的字符串切片 (String Slice)</h1>\n<p>字符串切片（String Slice）是对 <code>String</code> 中一部分的引用。它允许你在不获取整个 <code>String</code> 所有权的情况下，引用其中的一部分连续数据。</p>\n<h2 id=\"创建切片\"><a class=\"anchor\" href=\"#创建切片\">#</a> 创建切片</h2>\n<p>你可以使用方括号和一个范围 <code>[start..end]</code> 来创建一个字符串切片。</p>\n<ul>\n<li><code>start</code>: 范围的起始索引，包含在切片中。</li>\n<li><code>end</code>: 范围的结束索引，<strong>不</strong>包含在切片中。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> s</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello world</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// \"hello\" 的切片，索引从 0 到 4</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> hello</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// \"world\" 的切片，索引从 6 到 10</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> world</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">6</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>范围语法有一些方便的简写：</p>\n<table>\n<thead>\n<tr>\n<th>语法</th>\n<th>描述</th>\n<th>示例 (基于 <code>let s = String::from(&quot;hello&quot;);</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&amp;s[..end]</code></td>\n<td>从开头到索引 <code>end</code> (不含)</td>\n<td><code>let slice = &amp;s[..2];</code> // &quot;he&quot;</td>\n</tr>\n<tr>\n<td><code>&amp;s[start..]</code></td>\n<td>从索引 <code>start</code> 到结尾</td>\n<td><code>let slice = &amp;s[3..];</code> // &quot;lo&quot;</td>\n</tr>\n<tr>\n<td><code>&amp;s[..]</code></td>\n<td>整个字符串的切片</td>\n<td><code>let slice = &amp;s[..];</code> // &quot;hello&quot;</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"切片的本质\"><a class=\"anchor\" href=\"#切片的本质\">#</a> 切片的本质</h2>\n<p>切片本质上是一种特殊类型的引用，它是一个“胖指针”（fat pointer）或“宽指针”（wide pointer）。它内部存储了两部分信息：</p>\n<ol>\n<li>指向数据起始位置的指针。</li>\n<li>切片的长度。</li>\n</ol>\n<h2 id=\"将切片作为函数参数\"><a class=\"anchor\" href=\"#将切片作为函数参数\">#</a> 将切片作为函数参数</h2>\n<p>将字符串切片 <code>&amp;str</code> 作为函数参数，可以使函数更具通用性和灵活性。这样的函数既可以接收 <code>String</code> 的引用，也可以接收字符串字面量（它本身就是切片类型）。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这个函数可以接收 String 类型 (例如 &#x26;s) 和 &#x26;str 类型 (例如 \"hello world\")</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> first_word</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">str</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">str</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bytes</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> s</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">as_bytes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bytes</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">iter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">enumerate</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> '</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 返回直到第一个空格的切片</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    &#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 如果没有空格，返回整个字符串的切片</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p><strong>调用示例</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_string</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello world</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// first_word 对 &#x26;String 同样有效</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> word</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> first_word</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">my_string</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">第一个单词是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> word</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_string_literal</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">hello world</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// first_word 对字符串字面量也有效</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> word</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> first_word</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">my_string_literal</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">第一个单词是: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> word</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/03/ENV_CONFIG/%E4%BD%BF%E7%94%A8pyocd%E8%B0%83%E7%94%A8FLM%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%96%E9%83%A8%E4%B8%8B%E8%BD%BD%E7%AE%97%E6%B3%95/",
            "url": "https://haoruanwn.github.io/2025/08/03/ENV_CONFIG/%E4%BD%BF%E7%94%A8pyocd%E8%B0%83%E7%94%A8FLM%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%96%E9%83%A8%E4%B8%8B%E8%BD%BD%E7%AE%97%E6%B3%95/",
            "title": "使用pyocd调用FLM格式的外部下载算法",
            "date_published": "2025-08-03T14:08:05.000Z",
            "content_html": "<h1 id=\"pyocd-调用-flm-格式的外部下载算法\"><a class=\"anchor\" href=\"#pyocd-调用-flm-格式的外部下载算法\">#</a> pyocd 调用 FLM 格式的外部下载算法</h1>\n<p>记录如何通过 <code>pyocd</code> 调用 Keil 使用的 <code>.FLM</code> 格式外部下载算法，将程序烧录到 STM32H7 系列微控制器的 QSPI Flash 中。</p>\n<h3 id=\"项目背景\"><a class=\"anchor\" href=\"#项目背景\">#</a> 项目背景</h3>\n<table>\n<thead>\n<tr>\n<th>项目</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>开发板</strong></td>\n<td><a href=\"https://item.taobao.com/item.htm?id=838568127129&amp;pisk=gIi_MI2qJ8VFHG385oJFVo7BQuZfhp-yDtwxExINHlETliHZN-S4uF2fcWMJI58DSjgIMX4a6Sz4c-GztAS2IAJXcxH86oua_-hEGXbZ_mPqTnMoNPSZHmWi-bkRbc8g0iZgmodya3-rQAq0DXNEywfGvRy60GEYHlqda56wy3-rIv6aBLkp4mlDc0oAkihYWyCLIWeTH-F9dyezHoITkGQL9W2YDoFOWyBLn81ADSF9d9eYBNQADPUd9-yVBoExMyHLt-EYHjEvdvF3HDUHAJJ41A9WHUubK3YovWsADDwpi5M1Cg2tfR98aANBwdoCqPN-BWsv6ibG95e-2B7gFPGbJDkVUiPrB4c0efC9aPDxRXwsTBbQd4liVknJtiGjEDcQpbKf45HnU4ziXESzPlP_lcH61_NKfXigXf8AVjls7XaQ0EjYXl2Ssln9T1Zjpczozyf6TSurLcUIwBSIirgo3-G6fGEEzf08r2AfP73rEkszcgP5F8QX2kSbd7JBdZbcEQOznV0AZ0zTKJ5ydp1_vPe3d7JBdZb0WJ2e3p9C1kC..&amp;spm=tbpc.boughtlist.suborder_itemtitle.1.3c6a2e8dVW0dPQ&amp;sku_properties=-1%3A-1\">反客STM32H750XHB6</a></td>\n</tr>\n<tr>\n<td><strong>参考工程</strong></td>\n<td><a href=\"https://github.com/Peakors/STM32H750XBH6_Template\">Peakors/STM32H750XBH6_Template</a></td>\n</tr>\n<tr>\n<td><strong>下载算法</strong></td>\n<td><code>FK750M6_XBH6_V0.FLM</code> (由开发板资料提供)</td>\n</tr>\n<tr>\n<td><strong>测试环境</strong></td>\n<td>Fedora 42 (经验可跨平台通用)</td>\n</tr>\n</tbody>\n</table>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250803220535715.png\" alt=\"Snipaste_2025-08-03_22-05-27\" /></p>\n<h3 id=\"前置依赖\"><a class=\"anchor\" href=\"#前置依赖\">#</a> 前置依赖</h3>\n<p>确保已安装以下工具链：</p>\n<ul>\n<li><code>pyocd</code></li>\n<li><code>cmake</code></li>\n<li><code>ninja</code> 或 <code>make</code></li>\n<li><code>arm-none-eabi-gcc</code></li>\n</ul>\n<h3 id=\"编译流程\"><a class=\"anchor\" href=\"#编译流程\">#</a> 编译流程</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 生成 Ninja/Make 构建文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -G</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Ninja</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 执行编译</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/</span></span></code></pre>\n<h3 id=\"原理说明\"><a class=\"anchor\" href=\"#原理说明\">#</a> 原理说明</h3>\n<p>通过在项目根目录创建 <code>pyocd_user.py</code> 脚本，可以自定义 pyOCD 的连接行为。pyOCD 在启动时会自动检测并加载该文件。</p>\n<p>我们在脚本中定义一个 <code>will_connect</code> 函数，该函数会在 pyOCD 连接目标板之前被调用。通过这个函数，我们可以向 pyOCD 的内存地图中添加外部 Flash 的信息（如 QSPI Flash），并指定其使用的 <code>.FLM</code> 下载算法。</p>\n<p>这种机制使得 pyOCD 能够在不修改内置目标支持的情况下，扩展对外部存储器的烧录能力。</p>\n<p><strong>1. 目录结构</strong></p>\n<ul>\n<li>将下载算法文件 <code>FK750M6_XBH6_V0.FLM</code> 存放到项目下的 <code>.config</code> 文件夹中。</li>\n<li>在项目根目录创建 <code>pyocd_user.py</code> 文件。</li>\n</ul>\n<p><strong>2. <code>pyocd_user.py</code> 脚本</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># pyocd_user.py</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> pyocd</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">core</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">memory_map </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> FlashRegion</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> logging</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># --- 定义外部 QSPI Flash 的参数 ---</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">FLM_FILE</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">.config/FK750M6_XBH6_V0.FLM</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 存放下载算法的相对路径</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_START</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">90000000</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_SIZE</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 32</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1024</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1024</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_BLOCKSIZE</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> will_connect</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">board</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    这是一个 pyOCD 代理函数，会在连接前被自动调用。</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    target </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> board</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">target</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 定义外部 Flash 区域</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    external_flash </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> FlashRegion</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        name</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">qspi_flash</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        start</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_START</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        length</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_SIZE</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        blocksize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">QSPI_FLASH_BLOCKSIZE</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        is_boot_memory</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        flm</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">FLM_FILE</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 将其添加到内存地图</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    target</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">memory_map</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">add_region</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">external_flash</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    logging</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">info</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"用户脚本：成功添加外部 QSPI Flash 区域 '</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">external_flash</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">name</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">'\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>具体定义参考<code>/home/hao/.local/lib/python3.13/site-packages/pyocd/core/memory_map.py</code>（pyocd安装路径）</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250803215751929.png\" alt=\"Snipaste_2025-08-03_21-27-37\" /></p>\n<h3 id=\"烧录指令\"><a class=\"anchor\" href=\"#烧录指令\">#</a> 烧录指令</h3>\n<p>使用以下指令将编译生成的 <code>.bin</code> 文件烧录到 QSPI Flash 的起始地址 <code>0x90000000</code>。</p>\n<ul>\n<li><code>--target stm32h750xx</code>：指定目标芯片型号。</li>\n<li><code>-O connect_mode=under-reset</code>：设置连接模式为复位下连接。</li>\n<li><code>./build/STM32H750XBH6_Template.bin@0x90000000</code>：指定固件路径和烧录地址。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32h750xx</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -O</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect_mode=under-reset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./build/STM32H750XBH6_Template.bin@0x90000000</span></span></code></pre>\n<h3 id=\"日志参考\"><a class=\"anchor\" href=\"#日志参考\">#</a> 日志参考</h3>\n<p><strong>1. 简洁版日志</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">❯</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32h750xx</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -O</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect_mode=under-reset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./build/STM32H750XBH6_Template.bin@0x90000000</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000447</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Loading</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/projects/stm32_projects/STM32H750XBH6/CMake/STM32H750XBH6_Template/build/STM32H750XBH6_Template.bin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> at</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x90000000</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_cmd</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==================================================</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 100%</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0002722</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Erased</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 65536</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bytes</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sector</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, programmed 65536 bytes </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">8</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pages</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, skipped 0 bytes </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pages</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> at 28.14 kB/s </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">loader</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<p><strong>2. 详细版日志 (<code>-v</code> 参数)</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">❯</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32h750xx</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -v</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -O</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect_mode=under-reset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./build/STM32H750XBH6_Template.bin@0x90000000</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000346</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> type</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32h750xx</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">board</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000349</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 用户脚本：成功添加外部</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> QSPI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Flash</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 区域</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">qspi_flash</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pyocd_user</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000349</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Asserting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> reset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> prior</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">coresight_target</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000352</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> DP</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> IDR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x6ba02477</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">v2 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rev6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dap</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000366</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CR:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x0070003f</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">target_STM32H750xx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000370</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> AHB-AP#0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> IDR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x84770001</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">AHB-AP </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">var0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rev8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">discovery</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000373</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> AHB-AP#1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> IDR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x84770001</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">AHB-AP </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">var0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rev8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">discovery</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000376</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> APB-AP#2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> IDR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x54770002</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">APB-AP </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">var0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rev5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">discovery</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000379</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> AHB-AP#0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Class</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ROM</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> table</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0 @ 0xe00fe000 (designer=020:ST part=450) [rom_table]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000381</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00ff000:ROM </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">1</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">4c7</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000381</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   AHB-AP#0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Class</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ROM</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> table</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #1 @ 0xe00ff000 (designer=43b:Arm part=4c7) [rom_table]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000383</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e000e000:SCS v7-M </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">00c</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000385</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e0001000:DWT v7-M </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">002</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000386</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e0002000:FPB v7-M </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">00e</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000387</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e0000000:ITM v7-M </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">001</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000389</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e0041000:ETM M7 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">975</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">13</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">4a13</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000391</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e0043000:CTI CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">906</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">40800:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000393</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> APB-AP#2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Class</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ROM</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> table</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0 @ 0xe00e0000 (designer=020:ST part=450) [rom_table]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000396</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00e3000:SWO CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">914</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">11</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ea0:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000398</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00e4000:Trace Funnel CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">908</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">12</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">32:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000399</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00e5000:TSGEN </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">15</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">101</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000400</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00f0000:ROM </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">1</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">020:ST</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">001</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000401</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   APB-AP#2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Class</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ROM</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> table</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #1 @ 0xe00f0000 (designer=020:ST part=001) [rom_table]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000404</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00f1000:CTI CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">906</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">14</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">40800:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000406</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00f3000:Trace Funnel CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">908</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">12</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">34:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000408</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00f4000:ETF </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">961</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">32</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">380:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000410</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">e00f5000:TPIU CS-400 </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">class</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">9</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> designer</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">43b:Arm</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> part</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">912</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">11</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> archid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0000</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> devid</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a0:0:0</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#59873A;--shiki-dark:#80A665\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rom_table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000415</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CPU</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> core</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #0: Cortex-M7 r1p1, v7.0-M architecture [cortex_m]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000415</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   Extensions:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DSP, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">FPU,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> FPU_DP,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> FPU_V5,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> MPU]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cortex_m</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000415</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   FPU</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> present:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> FPv5-D16-M</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cortex_m</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000416</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hardware</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> watchpoints</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dwt</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000419</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hardware</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> breakpoints,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> literal</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> comparators</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fpb</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000431</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Deasserting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> reset</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> post</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">coresight_target</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000433</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Creating</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> algo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> region</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> qspi_flash</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/projects/stm32_projects/STM32H750XBH6/CMake/STM32H750XBH6_Template/.config/FK750M6_XBH6_V0.FLM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">flm_region_builder</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000448</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Loading</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/projects/stm32_projects/STM32H750XBH6/CMake/STM32H750XBH6_Template/build/STM32H750XBH6_Template.bin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> at</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0x90000000</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_cmd</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==================================================</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 100%</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0002723</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Erased</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 65536</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bytes</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1 </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sector</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, programmed 65536 bytes </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">8</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pages</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, skipped 0 bytes </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pages</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> at 28.14 kB/s </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">loader</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span></code></pre>\n<h3 id=\"实现效果\"><a class=\"anchor\" href=\"#实现效果\">#</a> 实现效果</h3>\n<ol>\n<li>\n<p><strong>Bootloader 日志 (运行于片内 Flash)</strong></p>\n<ul>\n<li>程序启动后，首先运行片内 Flash 中的 Bootloader，通过串口打印启动日志。</li>\n<li>Bootloader 日志截图 （乱码系中文编码问题）</li>\n</ul>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250803215422276.png\" alt=\"Snipaste_2025-08-03_21-16-45\" /></p>\n</li>\n<li>\n<p><strong>主程序日志 (运行于外部 QSPI Flash)</strong></p>\n<ul>\n<li>Bootloader 跳转到 QSPI Flash 中执行主程序，主程序通过 USB 虚拟串口打印运行日志。</li>\n<li>USB 虚拟串口日志截图</li>\n</ul>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250803215435181.png\" alt=\"Snipaste_2025-08-03_21-17-15\" /></p>\n</li>\n</ol>\n<p>串口波特率115200</p>\n<h3 id=\"特别鸣谢\"><a class=\"anchor\" href=\"#特别鸣谢\">#</a> 特别鸣谢</h3>\n<p><strong>反客科技</strong>：提供开发板资料和.FLM格式下载算法</p>\n<p><strong>反客交流群的Peakors大佬</strong>：提供STM32H750XHB6的项目模板和openocd外部下载算法，他还制作了很多反客开发板的项目模板和下载算法，<a href=\"https://github.com/Peakors\">GitHub主页</a>。</p>\n<p><strong>谷歌Gemini</strong>：消化pyocd的文档，提供指导建议和文章排版</p>\n",
            "tags": [
                "MCU/单片机/微控制器",
                "pyocd/openocd"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/08/02/ENV_CONFIG/%E4%BD%BF%E7%94%A8Docker%E7%BC%96%E8%AF%91OpenWrt/",
            "url": "https://haoruanwn.github.io/2025/08/02/ENV_CONFIG/%E4%BD%BF%E7%94%A8Docker%E7%BC%96%E8%AF%91OpenWrt/",
            "title": "使用Docker编译OpenWrt",
            "date_published": "2025-08-01T17:11:17.000Z",
            "content_html": "<h1 id=\"使用docker编译openwrt\"><a class=\"anchor\" href=\"#使用docker编译openwrt\">#</a> 使用Docker编译OpenWrt</h1>\n<p>介绍如何利用 Docker 环境编译 OpenWrt 固件，以实现编译环境的隔离和一致性。</p>\n<h2 id=\"前提条件\"><a class=\"anchor\" href=\"#前提条件\">#</a> 前提条件</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类别</th>\n<th style=\"text-align:left\">要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>网络环境</strong></td>\n<td style=\"text-align:left\">良好的科学上网环境，确保可以顺畅访问 GitHub、OpenWrt 源码等国外资源。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>软件工具</strong></td>\n<td style=\"text-align:left\">在宿主机上预先安装好 <code>Git</code> 和 <code>Docker</code> (包括 <code>docker-compose</code>)。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>个人能力</strong></td>\n<td style=\"text-align:left\">具备基本的 Linux 命令行操作和解决问题的能力。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"环境搭建\"><a class=\"anchor\" href=\"#环境搭建\">#</a> 环境搭建</h2>\n<h3 id=\"1-dockerfile\"><a class=\"anchor\" href=\"#1-dockerfile\">#</a> 1. Dockerfile</h3>\n<p>创建一个 <code>Dockerfile</code> 文件，用于定义编译环境镜像。该镜像基于 Ubuntu 22.04，安装了所有 OpenWrt 官方推荐的编译依赖，并创建了一个名为 <code>builder</code> 的非 root 用户以增强安全性。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-dockerfile\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用官方推荐的 Ubuntu 22.04 LTS 作为基础镜像</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ubuntu:22.04</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置环境变量，避免在包安装过程中出现交互式提示</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ENV</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DEBIAN_FRONTEND=noninteractive</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 一次性更新软件源并安装 OpenWrt 编译所需的所有依赖包</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RUN</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> apt-get update &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    apt-get install -y --no-install-recommends \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 编译工具链</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    build-essential \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    clang \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    flex \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    bison \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    g++ \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gawk \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gcc-multilib \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    g++-multilib \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 文本和版本控制工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gettext \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    git \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    subversion \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 核心库和开发头文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    libncurses5-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    libssl-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    zlib1g-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # Python 相关工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-distutils \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-docutils \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-pyelftools \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-setuptools \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 常用辅助工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    rsync \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    swig \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    texinfo \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    unzip \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    wget \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    file \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    time \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 解决 SSL 证书验证问题的关键包</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ca-certificates \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 为非 root 用户提供提权能力的工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    sudo \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 清理 apt 缓存，减小最终镜像大小</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    apt-get clean &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    rm -rf /var/lib/apt/lists/*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 创建一个名为 'builder' 的非 root 用户，并赋予其免密 sudo 权限</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 这是为了安全起见，避免在容器中直接使用 root 用户进行编译等操作</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RUN</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> useradd -m -s /bin/bash builder &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    adduser builder sudo &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    echo </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">'builder ALL=(ALL) NOPASSWD:ALL'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /etc/sudoers</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 切换到新创建的非 root 用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> builder</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 为 builder 用户设置工作目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WORKDIR</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/builder</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置容器启动时执行的默认命令，即启动一个 bash shell</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CMD</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"/bin/bash\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<h3 id=\"2-docker-composeyml\"><a class=\"anchor\" href=\"#2-docker-composeyml\">#</a> 2. docker-compose.yml</h3>\n<p>创建 <code>docker-compose.yml</code> 文件来管理容器的构建和运行。该配置会自动构建镜像，并设置一个关键的卷挂载，将宿主机的 <code>./openwrt</code> 目录映射到容器内，使得源码和编译产物能够持久化保存在宿主机上。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yaml\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">3.8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">services</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  openwrt-builder</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 使用当前目录下的 Dockerfile 来构建镜像</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    build</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> .</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 给构建出的镜像命名</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    image</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt-builder-image</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 容器的名字</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    container_name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 覆盖 Dockerfile 中的 CMD，确保我们能进入 bash</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /bin/bash</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 保持容器在前台运行，并分配一个伪终端 (等同于 -it)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    stdin_open</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    tty</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 网络模式</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    network_mode</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> host</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 挂载卷</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    volumes</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 将宿主机的 ./openwrt 目录挂载到容器的 /home/builder/openwrt</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./openwrt:/home/builder/openwrt</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 设置工作目录，进入容器后会自动切换到这个目录</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    working_dir</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/builder/openwrt</span></span></code></pre>\n<h3 id=\"3-推荐目录结构\"><a class=\"anchor\" href=\"#3-推荐目录结构\">#</a> 3. 推荐目录结构</h3>\n<p>为了便于管理，建议采用以下目录结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-plaintext\"><span class=\"line\"><span>~/openwrt_dev/</span></span>\n<span class=\"line\"><span>├── Dockerfile</span></span>\n<span class=\"line\"><span>├── docker-compose.yml</span></span>\n<span class=\"line\"><span>└── openwrt/</span></span></code></pre>\n<p>其中 <code>openwrt</code> 目录为 OpenWrt 源码。</p>\n<h2 id=\"编译步骤\"><a class=\"anchor\" href=\"#编译步骤\">#</a> 编译步骤</h2>\n<h3 id=\"1-获取openwrt源码\"><a class=\"anchor\" href=\"#1-获取openwrt源码\">#</a> 1. 获取OpenWrt源码</h3>\n<p>在 <code>~/openwrt_dev/</code> 目录下，克隆 OpenWrt 官方源码。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> https://git.openwrt.org/openwrt/openwrt.git</span></span></code></pre>\n<h3 id=\"2-构建镜像与启动容器\"><a class=\"anchor\" href=\"#2-构建镜像与启动容器\">#</a> 2. 构建镜像与启动容器</h3>\n<p>在 <code>~/openwrt_dev/</code> 目录下执行以下命令，Docker Compose 会自动根据 <code>Dockerfile</code> 构建镜像，并根据 <code>docker-compose.yml</code> 的配置启动容器。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 作者安装的docker比较新，把docker-compose整合到docker工具链中了，使用方式和旧版不太一样</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 旧版 docker-compose</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker-compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看容器情况</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ps</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启动或关闭我们的容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span></code></pre>\n<p>使用 <code>-d</code> 参数可以在后台启动容器。</p>\n<h3 id=\"3-进入容器\"><a class=\"anchor\" href=\"#3-进入容器\">#</a> 3. 进入容器</h3>\n<p>容器启动后，使用 <code>docker exec</code> 命令进入容器内部的 <code>bash</code> 环境。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> exec</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -it</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bash</span></span></code></pre>\n<h3 id=\"4-执行编译\"><a class=\"anchor\" href=\"#4-执行编译\">#</a> 4. 执行编译</h3>\n<p>进入容器后，所有操作都在 <code>/home/builder/openwrt</code> 目录下进行。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 更新并安装 Feeds</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">./scripts/feeds</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">./scripts/feeds</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 生成默认配置文件，并进入配置菜单</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#    在这里选择你的目标设备型号、软件包等</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#    本文章的重点不在于此，不再展开</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> menuconfig</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 下载编译所需的依赖包</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> download</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -j</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">nproc</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 开始编译 (使用与CPU核心数相当的线程数以加快速度)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -j</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">nproc</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> V=s</span></span></code></pre>\n<h2 id=\"编译产物\"><a class=\"anchor\" href=\"#编译产物\">#</a> 编译产物</h2>\n<p>编译成功后，生成的固件及相关文件会位于宿主机的 <code>~/openwrt_dev/openwrt/bin/targets/</code> 目录下，具体路径取决于你在 <code>make menuconfig</code> 中选择的目标平台。例如，<code>mediatek/filogic</code> 平台的产物路径如下：</p>\n<p><strong>路径:</strong> <code>~/openwrt_dev/openwrt/bin/targets/mediatek/filogic/</code></p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250802005325556.png\" alt=\"Snipaste_2025-08-02_00-33-20\" /></p>\n",
            "tags": [
                "OpenWrt"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/31/Programming/C++/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AF%BB%E6%89%BE%E4%BE%9D%E8%B5%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%93/",
            "url": "https://haoruanwn.github.io/2025/07/31/Programming/C++/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AF%BB%E6%89%BE%E4%BE%9D%E8%B5%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%93/",
            "title": "CMake使用示例：寻找依赖和自定义库",
            "date_published": "2025-07-31T14:09:44.000Z",
            "content_html": "<h2 id=\"一-添加第三方依赖示例\"><a class=\"anchor\" href=\"#一-添加第三方依赖示例\">#</a> 一、添加第三方依赖示例</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 寻找gflags库，REQUIRED表示必须找到，否则报错</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gflags REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gflags_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags found: $&#123;gflags_INCLUDE_DIRS&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags library: $&#123;gflags_LIBRARIES&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 为可执行文件添加头文件目录和库目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">gflags_INCLUDE_DIRS</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">gflags_LIBRARIES</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量名</th>\n<th style=\"text-align:center\">作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>gflags_INCLUDE_DIRS</code></td>\n<td style=\"text-align:center\">GFlags 头文件目录（如 <code>/usr/include/gflags/</code>）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>gflags_LIBRARIES</code></td>\n<td style=\"text-align:center\">GFlags 库文件路径（如 <code>/usr/lib/libgflags.so</code> 或 <code>libgflags.a</code>）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>gflags_FOUND</code></td>\n<td style=\"text-align:center\">布尔值，标记是否找到 GFlags</td>\n</tr>\n</tbody>\n</table>\n<p>这些变量是由<code>find_package(gflags)</code> 命令自动生成的</p>\n<h2 id=\"二-自己编写依赖库\"><a class=\"anchor\" href=\"#二-自己编写依赖库\">#</a> 二、自己编写依赖库</h2>\n<p>两种情况：</p>\n<ol>\n<li>\n<p>非cmake安装的库：</p>\n<p>需要提供<code>Find&lt;lib name&gt;.cmake</code>，如<code>Finddlib.cmake</code></p>\n</li>\n<li>\n<p>使用cmake安装的库：</p>\n<p>使用<code>install</code>安装，生成<code>&lt;lib name&gt;Config.cmake</code>文件，适用于导入自己开发的cmake项目</p>\n</li>\n</ol>\n<h3 id=\"1-非cmake安装的库\"><a class=\"anchor\" href=\"#1-非cmake安装的库\">#</a> 1、非cmake安装的库</h3>\n<p>项目结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Finddlib.cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span></span></code></pre>\n<p><code>CMakeLists.txt</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置CMAKE_MODULE_PATH，添加自定义模块的路径，find_package会从这里查找Findlib.cmake文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_MODULE_PATH</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_LIST_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/cmake</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用find_package查找自定义模块，会从CMAKE_MODULE_PATH中查找</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib found: $&#123;dlib_INCLUDE_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib library: $&#123;dlib_LIBRARY&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib version: $&#123;dlib_VERSION&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib author: $&#123;dlib_AUTHOR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib lib dir: $&#123;dlib_LIBRARY_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置RPATH</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;dlib_LIBRARY_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加头文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_INCLUDE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 链接动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_LIBRARY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><code>./cmake/Finddlib.cmake</code>，顶层<code>CMakeLists.txt</code>通过这个文件来查找依赖库</p>\n<p>因此，需要自己编写，设置对应的库路径和头文件路径</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 找 dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_path</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    NAMES</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    PATHS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/hao/installed/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">test</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 找 libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_LIBRARY</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    NAMES</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    PATHS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/hao/installed/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">test</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/lib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果dlib.h和libdlib.so都找到了，就设置dlib_FOUND为true</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">AND</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib_LIBRARY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 设置dlib的版本和作者信息</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_VERSION </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"1.0.0\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_AUTHOR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"hao\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # lib文件所在的目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    get_filename_component</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_LIBRARY_DIR </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_LIBRARY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DIRECTORY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FALSE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>输出结果：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">❯</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> The</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> identification</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> GNU</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 11.4.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> The</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> identification</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> GNU</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 11.4.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> working</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/cc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> skipped</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> working</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/c++</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> skipped</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> found:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> library:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/lib/libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> version:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.0.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> author:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hao</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> lib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dir:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/lib</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Configuring</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Generating</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> files</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> have</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> been</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> written</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/cpp-cmake_learn/cmake_projects/custom_find/find_demo/build</span></span></code></pre>\n<h3 id=\"2-cmake安装的库\"><a class=\"anchor\" href=\"#2-cmake安装的库\">#</a> 2、cmake安装的库</h3>\n<p>项目结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.custom_mod</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   │</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlibConfig.cmake.in</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   │</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> src</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">       └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2.find_test</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span></span></code></pre>\n<p><strong>自己的cmake编写和安装的库：</strong></p>\n<p><code>CMakeLists.txt</code>中的</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_PREFIX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"/home/hao/installed/test\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 路径被两次引用，1、编译dlib；2、install export写入config时，所以会报错</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib </span><span style=\"color:#59873A;--shiki-dark:#80A665\">PUBLIC</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># # 使用生成器表达式，解决路径被两次引用的问题</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># target_include_directories(dlib PUBLIC</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#         $&#x3C;BUILD_INTERFACE:$&#123;CMAKE_SOURCE_DIR&#125;/include>  # 生成时的头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#         $&#x3C;INSTALL_INTERFACE:include>                    # 安装时的头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置公共头文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set_target_properties</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib PROPERTIES </span><span style=\"color:#59873A;--shiki-dark:#80A665\">PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> include/dlib.h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加安装</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    EXPORT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib      </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 导出目标</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DESTINATION include </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 公共头文件，只有在设置了 PUBLIC_HEADER 时才会安装，或者使用下面一句</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 通过模板生成 &#x3C;Package>Config.cmake，用于 find_package() 寻找包，可以包装一些信息，比如版本号等</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGET_NAME dlib</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">EXPORT dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    FILE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Target</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMakePackageConfigHelpers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># configure_package_config_file 参数：模板文件，生成文件，安装路径</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">configure_package_config_file</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_SOURCE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/cmake/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake.in</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    INSTALL_DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将生成的 &#x3C;Package>Config.cmake 安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/config 目录下</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># CMAKE_CURRENT_BINARY_DIR 为当前编译目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> FILES</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>安装路径为<code>/home/hao/installed/test</code></p>\n<p><code>dlibConfig.cmake.in</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@PACKAGE_INIT@</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMakeFindDependencyMacro</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"$&#123;CMAKE_CURRENT_LIST_DIR&#125;/dlibTarget.cmake\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">check_required_components</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"@TARGET_NAME@\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">get_target_property</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_INCLUDE_DIR @TARGET_NAME@ </span><span style=\"color:#59873A;--shiki-dark:#80A665\">INTERFACE_INCLUDE_DIRECTORIES</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_LIBRARIES @TARGET_NAME@</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_AUTHOR ENPEI</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>引用库的项目</strong></p>\n<p>顶层<code>CMakeLists.txt</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 首先会在CMAKE_MODULE_PATH中查找Finddlib.cmake文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果找不到，会在CMAKE_PREFIX_PATH中查找dlibConfig.cmake配置文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># set(CMAKE_PREFIX_PATH  \"~/Documents/course_lib/config\")</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_FOUND: $&#123;dlib_FOUND&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_INCLUDE_DIR: $&#123;dlib_INCLUDE_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_LIBRARIES: $&#123;dlib_LIBRARIES&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_AUTHOR: $&#123;dlib_AUTHOR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 获取$&#123;dlib_INCLUDE_DIR&#125;的父目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    get_filename_component</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR_PARENT </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_INCLUDE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DIRECTORY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_INCLUDE_DIR_PARENT: $&#123;dlib_INCLUDE_DIR_PARENT&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置RPATH，否则install后，运行时找不到动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;dlib_INCLUDE_DIR_PARENT&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "CMake"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/31/Programming/C++/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE/",
            "url": "https://haoruanwn.github.io/2025/07/31/Programming/C++/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE/",
            "title": "CMake使用示例：安装设置",
            "date_published": "2025-07-31T14:08:33.000Z",
            "content_html": "<h1 id=\"说明\"><a class=\"anchor\" href=\"#说明\">#</a> 说明</h1>\n<p>发布项目时需要指定项目文件的安装路径<br />\n这里的路径是相对于<code>CMAKE_INSTALL_PREFIX</code>的路径，比如可执行文件就会在<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/bin</code>下<br />\n需要指定<code>CMAKE_INSTALL_PREFIX</code>的路径，如果不指定，默认是<code>/usr/local</code></p>\n<p><strong>安装可执行文件和库：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS test_account</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>安装头文件：</strong></p>\n<ol>\n<li>\n<p>单独安装</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DIRECTORY </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/ DESTINATION include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n</li>\n<li>\n<p>和其他文件一起安装</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS test_account</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DESTINATION include </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 公共头文件</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n</li>\n</ol>\n<h1 id=\"使用示例\"><a class=\"anchor\" href=\"#使用示例\">#</a> 使用示例</h1>\n<p>项目结构</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 入口文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> src</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.cpp</span></span></code></pre>\n<p><code>CMakeLists.txt</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">install_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMAKE_CXX_STANDARD 11</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加公共头文件路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_SOURCE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加静态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">slib STATIC</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    src/slib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/slib.h</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib SHARED</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    src/dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置安装路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_PREFIX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"/home/hao/installed/test\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;CMAKE_INSTALL_PREFIX&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加链接库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    slib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    dlib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 打印安装路径默认值</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"CMAKE_INSTALL_PREFIX: $&#123;CMAKE_INSTALL_PREFIX&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DIRECTORY </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/ DESTINATION include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 安装</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> slib dlib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"一-安装流程\"><a class=\"anchor\" href=\"#一-安装流程\">#</a> 一、安装流程</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 生成cmake配置文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -DCMAKE_INSTALL_PREFIX=./installed</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 如果不指定安装目录，使用cmake中已经写好的或者默认值</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 安装</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span></code></pre>\n<p>安装结果：</p>\n<p><code>\\home\\hao\\installed\\test</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bin</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install_demo</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> lib</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libslib.a</span></span></code></pre>\n<h2 id=\"二-设置运行时库搜索路径rpath\"><a class=\"anchor\" href=\"#二-设置运行时库搜索路径rpath\">#</a> 二、设置运行时库搜索路径(RPATH)</h2>\n<p>设置可执行文件运行时搜索动态库的路径</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;CMAKE_INSTALL_PREFIX&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>默认情况下，CMake在构建时会使用构建目录下的库路径（如 <code>build/lib/</code>），但安装后会切换到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code>。此设置强制让构建阶段和安装阶段的 RPATH 一致，避免运行时因路径切换找不到库。</p>\n<p>**注意：**需要放在<code>add_executable</code>前面</p>\n",
            "tags": [
                "Programming",
                "CMake"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/Programming/Rust/Rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/",
            "url": "https://haoruanwn.github.io/2025/07/28/Programming/Rust/Rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/",
            "title": "rust基本语法",
            "date_published": "2025-07-28T13:49:13.000Z",
            "content_html": "<h1 id=\"rust-基本语法\"><a class=\"anchor\" href=\"#rust-基本语法\">#</a> rust 基本语法</h1>\n<h2 id=\"1-变量与可变性\"><a class=\"anchor\" href=\"#1-变量与可变性\">#</a> 1. 变量与可变性</h2>\n<p>rust 中的变量默认是 <strong>不可变</strong> 的。可以使用 <code>mut</code> 关键字使变量变为 <strong>可变</strong> 的。</p>\n<h3 id=\"11-可变变量\"><a class=\"anchor\" href=\"#11-可变变量\">#</a> 1.1 可变变量</h3>\n<p>通过 <code>mut</code> 关键字，可以声明一个可变变量，其值在后续可以被修改。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 可变变量</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"12-常量\"><a class=\"anchor\" href=\"#12-常量\">#</a> 1.2 常量</h3>\n<p>常量在绑定值后任何时候都不能更改。</p>\n<ul>\n<li><strong>声明</strong>: 使用 <code>const</code> 关键字，且必须显式标注值的类型。</li>\n<li><strong>命名</strong>: rust 常量的命名约定是使用全大写字母，并用下划线分隔单词。</li>\n<li><strong>赋值</strong>: 只能被设置为常量表达式，不能是函数调用的结果或任何其他在运行时才能确定的值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>// 常量 不可用mut，必须标注类型，仅可以用常量表达式赋值</span></span>\n<span class=\"line\"><span>const SPECAL_NUMBER: i32 = 3;</span></span>\n<span class=\"line\"><span>println!(\"The value of SPECAL_NUMBER is: &#123;&#125;\", SPECAL_NUMBER);</span></span></code></pre>\n<h3 id=\"13-变量遮蔽-shadowing\"><a class=\"anchor\" href=\"#13-变量遮蔽-shadowing\">#</a> 1.3 变量遮蔽 (Shadowing)</h3>\n<p>rust 允许声明一个与之前变量同名的新变量，这个过程称为遮蔽 (Shadowing)。新变量会“遮蔽”掉旧的变量。</p>\n<ul>\n<li>它通过再次使用 <code>let</code> 关键字来创建了一个全新的变量。</li>\n<li>这允许我们改变值的类型，同时保持名称不变。</li>\n<li>在离开作用域后，被遮蔽的变量会恢复。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 变量遮蔽</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这里的my_number是一个新的变量，遮蔽了原来的 5</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 在这个内部作用域，my_number又被一次遮蔽</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of my_number in the inner scope is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 12</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of my_number is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 6</span></span></code></pre>\n<h2 id=\"2-数据类型\"><a class=\"anchor\" href=\"#2-数据类型\">#</a> 2. 数据类型</h2>\n<p>rust 是一种静态类型语言，它在编译时就必须知道所有变量的类型。数据类型可以分为两大类：<strong>标量类型</strong>和<strong>复合类型</strong>。</p>\n<h3 id=\"21-标量类型-scalar-types\"><a class=\"anchor\" href=\"#21-标量类型-scalar-types\">#</a> 2.1 标量类型 (Scalar Types)</h3>\n<p>标量类型表示一个单一的值。rust 有四种主要的标量类型：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>整数</strong></td>\n<td>有符号 (<code>i8</code> 到 <code>i128</code>, <code>isize</code>) 和无符号 (<code>u8</code> 到 <code>u128</code>, <code>usize</code>)</td>\n<td><code>let int1 = 98_222;</code></td>\n</tr>\n<tr>\n<td><strong>浮点数</strong></td>\n<td><code>f32</code> (单精度) 和 <code>f64</code> (双精度)</td>\n<td><code>const PI: f64 = 3.14159;</code></td>\n</tr>\n<tr>\n<td><strong>布尔值</strong></td>\n<td><code>bool</code>，值为 <code>true</code> 或 <code>false</code></td>\n<td><code>let is_rust_fun = true;</code></td>\n</tr>\n<tr>\n<td><strong>字符</strong></td>\n<td><code>char</code>，表示一个 Unicode 标量值，用单引号括起来</td>\n<td><code>let char1 = 'z';</code> <code>let char2 = '😻';</code></td>\n</tr>\n</tbody>\n</table>\n<p><strong>整数的字面量表示:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int1</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 98_222</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       // 十进制，下划线可用于提高可读性</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int2</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0xff</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 十六进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int3</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0o77</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 八进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int4</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0b1111_0000</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 二进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int5</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 字节 (u8)</span></span></code></pre>\n<h3 id=\"22-复合类型-compound-types\"><a class=\"anchor\" href=\"#22-复合类型-compound-types\">#</a> 2.2 复合类型 (Compound Types)</h3>\n<p>复合类型可以将多个值组合成一个类型。rust 有两种原生的复合类型：</p>\n<h4 id=\"元组-tuple\"><a class=\"anchor\" href=\"#元组-tuple\">#</a> 元组 (Tuple)</h4>\n<ul>\n<li>将多个不同类型的值组合进一个复合类型中。</li>\n<li>长度固定：一旦声明，其大小不能伸缩。</li>\n<li>可以通过模式匹配进行 <strong>解构 (Destructuring)</strong>，或使用点号 <code>.</code> 加索引来访问元素。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 元组 不同数据类型的组合</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> f64</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 解构元组</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> z</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 通过索引访问</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> five_hundred</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The first value is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> five_hundred</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h4 id=\"数组-array\"><a class=\"anchor\" href=\"#数组-array\">#</a> 数组 (Array)</h4>\n<ul>\n<li>将多个 <strong>相同类型</strong> 的值组合在一起。</li>\n<li>长度固定。</li>\n<li>数据存储在栈上。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> first</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 访问数组元素</span></span></code></pre>\n<h2 id=\"3-函数\"><a class=\"anchor\" href=\"#3-函数\">#</a> 3. 函数</h2>\n<p>使用 <code>fn</code> 关键字定义函数。rust 代码使用蛇形命名法 (snake case) 作为函数和变量名称的规范。</p>\n<h3 id=\"31-函数参数\"><a class=\"anchor\" href=\"#31-函数参数\">#</a> 3.1 函数参数</h3>\n<p>必须为每个参数声明其类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> another_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"32-语句和表达式\"><a class=\"anchor\" href=\"#32-语句和表达式\">#</a> 3.2 语句和表达式</h3>\n<ul>\n<li><strong>语句 (Statements)</strong>: 执行某些操作但不返回值的指令。例如 <code>let x = 6;</code>。</li>\n<li><strong>表达式 (Expressions)</strong>: 会计算并产生一个值。例如 <code>5 + 6</code>。</li>\n<li>函数体由一系列语句和一个可选的结尾表达式构成。</li>\n<li>在 rust 中，代码块 <code>&#123;&#125;</code> 是一个表达式，它会返回块中最后一个表达式的值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 这个块表达式的返回值是 6，注意末尾没有分号</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // y 的值为 6</span></span></code></pre>\n<h3 id=\"33-函数返回值\"><a class=\"anchor\" href=\"#33-函数返回值\">#</a> 3.3 函数返回值</h3>\n<ul>\n<li>在箭头 <code>-&gt;</code> 之后声明返回值的类型。</li>\n<li>函数的返回值是其函数体中最后一个表达式的值。</li>\n<li>可以使用 <code>return</code> 关键字提前从函数中返回。</li>\n<li>没有显式返回值的函数，其返回类型是 <code>()</code>，称为单元类型 (unit type)。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 含返回值的函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> five</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">    5</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 这是一个表达式，其值将作为函数返回值</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> plus_one</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 也可以使用 return 显式返回</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"4-控制流\"><a class=\"anchor\" href=\"#4-控制流\">#</a> 4. 控制流</h2>\n<h3 id=\"41-if-表达式\"><a class=\"anchor\" href=\"#41-if-表达式\">#</a> 4.1 <code>if</code> 表达式</h3>\n<ul>\n<li><code>if</code> 表达式的条件必须是 <code>bool</code> 类型。</li>\n<li>因为 <code>if</code> 是一个表达式，所以可以将其用在 <code>let</code> 语句的右侧来赋值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> if_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is less than 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is equal to 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is greater than 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // if表达式可以返回值</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"42-循环\"><a class=\"anchor\" href=\"#42-循环\">#</a> 4.2 循环</h3>\n<p>rust 提供了三种循环：<code>loop</code>、<code>while</code> 和 <code>for</code>。</p>\n<h4 id=\"loop\"><a class=\"anchor\" href=\"#loop\">#</a> <code>loop</code></h4>\n<ul>\n<li><code>loop</code> 关键字告诉 rust 无限次地执行一块代码，直到你显式地告诉它停止。</li>\n<li>可以使用 <code>break</code> 关键字退出循环，<code>break</code> 后面可以跟一个表达式，作为 <code>loop</code> 循环的返回值。</li>\n<li>可以使用 <code>continue</code> 跳过当前迭代，进入下一次迭代。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> loop_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> +=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            break</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出循环并返回 20</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"循环标签-loop-labels\"><a class=\"anchor\" href=\"#循环标签-loop-labels\">#</a> 循环标签 (Loop Labels)</h4>\n<p>对于嵌套循环，可以使用循环标签来指定 <code>break</code> 或 <code>continue</code> 要作用于哪个循环。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> labeled_loop</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> count</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    '</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">counting_up</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">remaining = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                break</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出内层循环</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> count</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                break</span><span style=\"color:#999999;--shiki-dark:#666666\"> '</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">counting_up</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出名为 'counting_up 的外层循环</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">            remaining</span><span style=\"color:#999999;--shiki-dark:#666666\"> -=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        count</span><span style=\"color:#999999;--shiki-dark:#666666\"> +=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">End count = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"while-循环\"><a class=\"anchor\" href=\"#while-循环\">#</a> <code>while</code> 循环</h4>\n<p>当条件为真时，循环就会继续。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> while_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    while</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        number</span><span style=\"color:#999999;--shiki-dark:#666666\"> -=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">LIFTOFF!!!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"for-循环\"><a class=\"anchor\" href=\"#for-循环\">#</a> <code>for</code> 循环</h4>\n<p>用于遍历集合中的每个元素，如数组。<code>for</code> 循环是更安全、更简洁的选择，因为它避免了 <code>while</code> 循环中可能出现的索引越界等错误。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> for_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 使用 .iter() 方法遍历集合</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> element</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">iter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> element</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 遍历一个范围 (Range)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // .rev() 方法用于反转范围</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rev</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">LIFTOFF!!!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "Programming",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/%E8%AE%BE%E7%BD%AEvim%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E4%B8%BAutf-8/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/%E8%AE%BE%E7%BD%AEvim%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E4%B8%BAutf-8/",
            "title": "设置vim编码格式为utf-8",
            "date_published": "2025-07-28T13:47:38.000Z",
            "content_html": "<h4 id=\"配置-vim-实现永久解决\"><a class=\"anchor\" href=\"#配置-vim-实现永久解决\">#</a> 配置 Vim 实现永久解决</h4>\n<p>为了让 Vim 以后新建或打开文件时都默认使用 UTF-8，需要配置 Vim 的启动文件 <code>.vimrc</code>。</p>\n<ol>\n<li>\n<p><strong>回到您的终端</strong> (如果还在Vim里，先输入 <code>:q</code> 退出)。</p>\n</li>\n<li>\n<p><strong>编辑 Vim 配置文件</strong>。这个文件位于您的用户主目录下，名为 <code>.vimrc</code>。如果不存在，这个命令会自动创建它。</p>\n<p>Bash</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>vim ~/.vimrc</span></span></code></pre>\n</li>\n<li>\n<p><strong>在文件中加入以下配置</strong>：</p>\n<p>Vim Script</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>\" 设置Vim内部使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set encoding=utf-8</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>\" 设置Vim保存文件时使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set fileencoding=utf-8</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>\" 设置Vim与终端通信时使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set termencoding=utf-8</span></span></code></pre>\n<ul>\n<li><strong>提示</strong>：在 Vim 配置文件中，<code>&quot;</code> 开头的行是注释。</li>\n</ul>\n</li>\n<li>\n<p><strong>保存并退出</strong>。</p>\n<ul>\n<li>在 <code>nano</code> 中，按 <code>Ctrl+X</code>，然后按 <code>Y</code>，再按 <code>Enter</code>。</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "VIM"
            ]
        }
    ]
}