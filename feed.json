{
    "version": "https://jsonfeed.org/version/1",
    "title": "好暖好温暖的博客",
    "subtitle": "一个电子信息系的大学生",
    "icon": "https://haoruanwn.github.io/assets/favicon.ico",
    "description": "记录学习与生活的点滴",
    "home_page_url": "https://haoruanwn.github.io",
    "items": [
        {
            "id": "https://haoruanwn.github.io/2025/08/02/%E4%BD%BF%E7%94%A8Docker%E7%BC%96%E8%AF%91OpenWrt/",
            "url": "https://haoruanwn.github.io/2025/08/02/%E4%BD%BF%E7%94%A8Docker%E7%BC%96%E8%AF%91OpenWrt/",
            "title": "使用Docker编译OpenWrt",
            "date_published": "2025-08-01T17:11:17.000Z",
            "content_html": "<h1 id=\"使用docker编译openwrt\"><a class=\"anchor\" href=\"#使用docker编译openwrt\">#</a> 使用Docker编译OpenWrt</h1>\n<p>介绍如何利用 Docker 环境编译 OpenWrt 固件，以实现编译环境的隔离和一致性。</p>\n<h2 id=\"前提条件\"><a class=\"anchor\" href=\"#前提条件\">#</a> 前提条件</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类别</th>\n<th style=\"text-align:left\">要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>网络环境</strong></td>\n<td style=\"text-align:left\">良好的科学上网环境，确保可以顺畅访问 GitHub、OpenWrt 源码等国外资源。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>软件工具</strong></td>\n<td style=\"text-align:left\">在宿主机上预先安装好 <code>Git</code> 和 <code>Docker</code> (包括 <code>docker-compose</code>)。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>个人能力</strong></td>\n<td style=\"text-align:left\">具备基本的 Linux 命令行操作和解决问题的能力。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"环境搭建\"><a class=\"anchor\" href=\"#环境搭建\">#</a> 环境搭建</h2>\n<h3 id=\"1-dockerfile\"><a class=\"anchor\" href=\"#1-dockerfile\">#</a> 1. Dockerfile</h3>\n<p>创建一个 <code>Dockerfile</code> 文件，用于定义编译环境镜像。该镜像基于 Ubuntu 22.04，安装了所有 OpenWrt 官方推荐的编译依赖，并创建了一个名为 <code>builder</code> 的非 root 用户以增强安全性。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-dockerfile\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用官方推荐的 Ubuntu 22.04 LTS 作为基础镜像</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ubuntu:22.04</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置环境变量，避免在包安装过程中出现交互式提示</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ENV</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DEBIAN_FRONTEND=noninteractive</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 一次性更新软件源并安装 OpenWrt 编译所需的所有依赖包</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RUN</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> apt-get update &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    apt-get install -y --no-install-recommends \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 编译工具链</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    build-essential \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    clang \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    flex \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    bison \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    g++ \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gawk \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gcc-multilib \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    g++-multilib \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 文本和版本控制工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    gettext \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    git \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    subversion \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 核心库和开发头文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    libncurses5-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    libssl-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    zlib1g-dev \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # Python 相关工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-distutils \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-docutils \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-pyelftools \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    python3-setuptools \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 常用辅助工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    rsync \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    swig \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    texinfo \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    unzip \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    wget \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    file \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    time \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 解决 SSL 证书验证问题的关键包</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ca-certificates \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 为非 root 用户提供提权能力的工具</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    sudo \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 清理 apt 缓存，减小最终镜像大小</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    apt-get clean &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    rm -rf /var/lib/apt/lists/*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 创建一个名为 'builder' 的非 root 用户，并赋予其免密 sudo 权限</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 这是为了安全起见，避免在容器中直接使用 root 用户进行编译等操作</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RUN</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> useradd -m -s /bin/bash builder &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    adduser builder sudo &#x26;&#x26; \\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    echo </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">'builder ALL=(ALL) NOPASSWD:ALL'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /etc/sudoers</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 切换到新创建的非 root 用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> builder</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 为 builder 用户设置工作目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WORKDIR</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/builder</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置容器启动时执行的默认命令，即启动一个 bash shell</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CMD</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"/bin/bash\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<h3 id=\"2-docker-composeyml\"><a class=\"anchor\" href=\"#2-docker-composeyml\">#</a> 2. docker-compose.yml</h3>\n<p>创建 <code>docker-compose.yml</code> 文件来管理容器的构建和运行。该配置会自动构建镜像，并设置一个关键的卷挂载，将宿主机的 <code>./openwrt</code> 目录映射到容器内，使得源码和编译产物能够持久化保存在宿主机上。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yaml\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">3.8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">services</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  openwrt-builder</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 使用当前目录下的 Dockerfile 来构建镜像</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    build</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> .</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 给构建出的镜像命名</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    image</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt-builder-image</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 容器的名字</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    container_name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 覆盖 Dockerfile 中的 CMD，确保我们能进入 bash</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /bin/bash</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 保持容器在前台运行，并分配一个伪终端 (等同于 -it)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    stdin_open</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    tty</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 网络模式</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    network_mode</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> host</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 挂载卷</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    volumes</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 将宿主机的 ./openwrt 目录挂载到容器的 /home/builder/openwrt</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./openwrt:/home/builder/openwrt</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 设置工作目录，进入容器后会自动切换到这个目录</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    working_dir</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/builder/openwrt</span></span></code></pre>\n<h3 id=\"3-推荐目录结构\"><a class=\"anchor\" href=\"#3-推荐目录结构\">#</a> 3. 推荐目录结构</h3>\n<p>为了便于管理，建议采用以下目录结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-plaintext\"><span class=\"line\"><span>~/openwrt_dev/</span></span>\n<span class=\"line\"><span>├── Dockerfile</span></span>\n<span class=\"line\"><span>├── docker-compose.yml</span></span>\n<span class=\"line\"><span>└── openwrt/</span></span></code></pre>\n<p>其中 <code>openwrt</code> 目录为 OpenWrt 源码。</p>\n<h2 id=\"编译步骤\"><a class=\"anchor\" href=\"#编译步骤\">#</a> 编译步骤</h2>\n<h3 id=\"1-获取openwrt源码\"><a class=\"anchor\" href=\"#1-获取openwrt源码\">#</a> 1. 获取OpenWrt源码</h3>\n<p>在 <code>~/openwrt_dev/</code> 目录下，克隆 OpenWrt 官方源码。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> https://git.openwrt.org/openwrt/openwrt.git</span></span></code></pre>\n<h3 id=\"2-构建镜像与启动容器\"><a class=\"anchor\" href=\"#2-构建镜像与启动容器\">#</a> 2. 构建镜像与启动容器</h3>\n<p>在 <code>~/openwrt_dev/</code> 目录下执行以下命令，Docker Compose 会自动根据 <code>Dockerfile</code> 构建镜像，并根据 <code>docker-compose.yml</code> 的配置启动容器。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 作者安装的docker比较新，把docker-compose整合到docker工具链中了，使用方式和旧版不太一样</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 旧版 docker-compose</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker-compose</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看容器情况</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ps</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启动或关闭我们的容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span></span></code></pre>\n<p>使用 <code>-d</code> 参数可以在后台启动容器。</p>\n<h3 id=\"3-进入容器\"><a class=\"anchor\" href=\"#3-进入容器\">#</a> 3. 进入容器</h3>\n<p>容器启动后，使用 <code>docker exec</code> 命令进入容器内部的 <code>bash</code> 环境。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> exec</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -it</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openwrt_build_env</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bash</span></span></code></pre>\n<h3 id=\"4-执行编译\"><a class=\"anchor\" href=\"#4-执行编译\">#</a> 4. 执行编译</h3>\n<p>进入容器后，所有操作都在 <code>/home/builder/openwrt</code> 目录下进行。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 更新并安装 Feeds</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">./scripts/feeds</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">./scripts/feeds</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 生成默认配置文件，并进入配置菜单</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#    在这里选择你的目标设备型号、软件包等</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#    本文章的重点不在于此，不再展开</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> menuconfig</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 下载编译所需的依赖包</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> download</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -j</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">nproc</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 开始编译 (使用与CPU核心数相当的线程数以加快速度)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">make</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -j</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">nproc</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> V=s</span></span></code></pre>\n<h2 id=\"编译产物\"><a class=\"anchor\" href=\"#编译产物\">#</a> 编译产物</h2>\n<p>编译成功后，生成的固件及相关文件会位于宿主机的 <code>~/openwrt_dev/openwrt/bin/targets/</code> 目录下，具体路径取决于你在 <code>make menuconfig</code> 中选择的目标平台。例如，<code>mediatek/filogic</code> 平台的产物路径如下：</p>\n<p><strong>路径:</strong> <code>~/openwrt_dev/openwrt/bin/targets/mediatek/filogic/</code></p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250802005325556.png\" alt=\"Snipaste_2025-08-02_00-33-20\" /></p>\n",
            "tags": [
                "OpenWrt"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/31/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AF%BB%E6%89%BE%E4%BE%9D%E8%B5%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%93/",
            "url": "https://haoruanwn.github.io/2025/07/31/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AF%BB%E6%89%BE%E4%BE%9D%E8%B5%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%93/",
            "title": "CMake使用示例：寻找依赖和自定义库",
            "date_published": "2025-07-31T14:09:44.000Z",
            "content_html": "<h2 id=\"一-添加第三方依赖示例\"><a class=\"anchor\" href=\"#一-添加第三方依赖示例\">#</a> 一、添加第三方依赖示例</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 寻找gflags库，REQUIRED表示必须找到，否则报错</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gflags REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gflags_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags found: $&#123;gflags_INCLUDE_DIRS&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags library: $&#123;gflags_LIBRARIES&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 为可执行文件添加头文件目录和库目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">gflags_INCLUDE_DIRS</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">gflags_LIBRARIES</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"gflags not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量名</th>\n<th style=\"text-align:center\">作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>gflags_INCLUDE_DIRS</code></td>\n<td style=\"text-align:center\">GFlags 头文件目录（如 <code>/usr/include/gflags/</code>）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>gflags_LIBRARIES</code></td>\n<td style=\"text-align:center\">GFlags 库文件路径（如 <code>/usr/lib/libgflags.so</code> 或 <code>libgflags.a</code>）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>gflags_FOUND</code></td>\n<td style=\"text-align:center\">布尔值，标记是否找到 GFlags</td>\n</tr>\n</tbody>\n</table>\n<p>这些变量是由<code>find_package(gflags)</code> 命令自动生成的</p>\n<h2 id=\"二-自己编写依赖库\"><a class=\"anchor\" href=\"#二-自己编写依赖库\">#</a> 二、自己编写依赖库</h2>\n<p>两种情况：</p>\n<ol>\n<li>\n<p>非cmake安装的库：</p>\n<p>需要提供<code>Find&lt;lib name&gt;.cmake</code>，如<code>Finddlib.cmake</code></p>\n</li>\n<li>\n<p>使用cmake安装的库：</p>\n<p>使用<code>install</code>安装，生成<code>&lt;lib name&gt;Config.cmake</code>文件，适用于导入自己开发的cmake项目</p>\n</li>\n</ol>\n<h3 id=\"1-非cmake安装的库\"><a class=\"anchor\" href=\"#1-非cmake安装的库\">#</a> 1、非cmake安装的库</h3>\n<p>项目结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Finddlib.cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span></span></code></pre>\n<p><code>CMakeLists.txt</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置CMAKE_MODULE_PATH，添加自定义模块的路径，find_package会从这里查找Findlib.cmake文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_MODULE_PATH</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_LIST_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/cmake</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用find_package查找自定义模块，会从CMAKE_MODULE_PATH中查找</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib found: $&#123;dlib_INCLUDE_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib library: $&#123;dlib_LIBRARY&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib version: $&#123;dlib_VERSION&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib author: $&#123;dlib_AUTHOR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib lib dir: $&#123;dlib_LIBRARY_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置RPATH</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;dlib_LIBRARY_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加头文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_INCLUDE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 链接动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_LIBRARY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><code>./cmake/Finddlib.cmake</code>，顶层<code>CMakeLists.txt</code>通过这个文件来查找依赖库</p>\n<p>因此，需要自己编写，设置对应的库路径和头文件路径</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 找 dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_path</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    NAMES</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    PATHS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/hao/installed/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">test</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 找 libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_LIBRARY</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    NAMES</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    PATHS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> /home/hao/installed/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">test</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/lib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果dlib.h和libdlib.so都找到了，就设置dlib_FOUND为true</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">AND</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib_LIBRARY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 设置dlib的版本和作者信息</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_VERSION </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"1.0.0\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_AUTHOR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"hao\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # lib文件所在的目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    get_filename_component</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_LIBRARY_DIR </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_LIBRARY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DIRECTORY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FALSE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>输出结果：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">❯</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> The</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> identification</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> GNU</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 11.4.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> The</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> identification</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> GNU</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 11.4.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> working</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/cc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> skipped</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ABI</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> working</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compiler:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/c++</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> skipped</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Detecting</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CXX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> compile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> features</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> found:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> library:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/lib/libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> version:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.0.0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> author:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hao</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> lib</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dir:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/installed/test/lib</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Configuring</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Generating</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> done</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> files</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> have</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> been</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> written</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /home/hao/cpp-cmake_learn/cmake_projects/custom_find/find_demo/build</span></span></code></pre>\n<h3 id=\"2-cmake安装的库\"><a class=\"anchor\" href=\"#2-cmake安装的库\">#</a> 2、cmake安装的库</h3>\n<p>项目结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.custom_mod</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cmake</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   │</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlibConfig.cmake.in</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   │</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> src</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">       └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2.find_test</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span></span></code></pre>\n<p><strong>自己的cmake编写和安装的库：</strong></p>\n<p><code>CMakeLists.txt</code>中的</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_PREFIX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"/home/hao/installed/test\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 路径被两次引用，1、编译dlib；2、install export写入config时，所以会报错</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib </span><span style=\"color:#59873A;--shiki-dark:#80A665\">PUBLIC</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># # 使用生成器表达式，解决路径被两次引用的问题</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># target_include_directories(dlib PUBLIC</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#         $&#x3C;BUILD_INTERFACE:$&#123;CMAKE_SOURCE_DIR&#125;/include>  # 生成时的头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#         $&#x3C;INSTALL_INTERFACE:include>                    # 安装时的头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置公共头文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set_target_properties</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib PROPERTIES </span><span style=\"color:#59873A;--shiki-dark:#80A665\">PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> include/dlib.h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加安装</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    EXPORT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dlib      </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 导出目标</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DESTINATION include </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 公共头文件，只有在设置了 PUBLIC_HEADER 时才会安装，或者使用下面一句</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 通过模板生成 &#x3C;Package>Config.cmake，用于 find_package() 寻找包，可以包装一些信息，比如版本号等</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGET_NAME dlib</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">EXPORT dlib</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    FILE</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Target</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMakePackageConfigHelpers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># configure_package_config_file 参数：模板文件，生成文件，安装路径</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">configure_package_config_file</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_SOURCE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/cmake/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake.in</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    INSTALL_DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将生成的 &#x3C;Package>Config.cmake 安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/config 目录下</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># CMAKE_CURRENT_BINARY_DIR 为当前编译目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> FILES</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TARGET_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Config.cmake</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    DESTINATION config</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>安装路径为<code>/home/hao/installed/test</code></p>\n<p><code>dlibConfig.cmake.in</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@PACKAGE_INIT@</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMakeFindDependencyMacro</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"$&#123;CMAKE_CURRENT_LIST_DIR&#125;/dlibTarget.cmake\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">check_required_components</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"@TARGET_NAME@\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">get_target_property</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_INCLUDE_DIR @TARGET_NAME@ </span><span style=\"color:#59873A;--shiki-dark:#80A665\">INTERFACE_INCLUDE_DIRECTORIES</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_LIBRARIES @TARGET_NAME@</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">@TARGET_NAME@_AUTHOR ENPEI</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>引用库的项目</strong></p>\n<p>顶层<code>CMakeLists.txt</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 首先会在CMAKE_MODULE_PATH中查找Finddlib.cmake文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果找不到，会在CMAKE_PREFIX_PATH中查找dlibConfig.cmake配置文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># set(CMAKE_PREFIX_PATH  \"~/Documents/course_lib/config\")</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib REQUIRED</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_FOUND: $&#123;dlib_FOUND&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_INCLUDE_DIR: $&#123;dlib_INCLUDE_DIR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_LIBRARIES: $&#123;dlib_LIBRARIES&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_AUTHOR: $&#123;dlib_AUTHOR&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 获取$&#123;dlib_INCLUDE_DIR&#125;的父目录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    get_filename_component</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib_INCLUDE_DIR_PARENT </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">dlib_INCLUDE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DIRECTORY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib_INCLUDE_DIR_PARENT: $&#123;dlib_INCLUDE_DIR_PARENT&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"dlib not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置RPATH，否则install后，运行时找不到动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;dlib_INCLUDE_DIR_PARENT&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "Programing",
                "CMake"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/31/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE/",
            "url": "https://haoruanwn.github.io/2025/07/31/CMake%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE/",
            "title": "CMake使用示例：安装设置",
            "date_published": "2025-07-31T14:08:33.000Z",
            "content_html": "<h1 id=\"说明\"><a class=\"anchor\" href=\"#说明\">#</a> 说明</h1>\n<p>发布项目时需要指定项目文件的安装路径<br />\n这里的路径是相对于<code>CMAKE_INSTALL_PREFIX</code>的路径，比如可执行文件就会在<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/bin</code>下<br />\n需要指定<code>CMAKE_INSTALL_PREFIX</code>的路径，如果不指定，默认是<code>/usr/local</code></p>\n<p><strong>安装可执行文件和库：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS test_account</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>安装头文件：</strong></p>\n<ol>\n<li>\n<p>单独安装</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DIRECTORY </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/ DESTINATION include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n</li>\n<li>\n<p>和其他文件一起安装</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS test_account</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 动态库</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 静态库</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    PUBLIC_HEADER</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DESTINATION include </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 公共头文件</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n</li>\n</ol>\n<h1 id=\"使用示例\"><a class=\"anchor\" href=\"#使用示例\">#</a> 使用示例</h1>\n<p>项目结构</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CMakeLists.txt</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.cpp</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 入口文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> src</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.cpp</span></span></code></pre>\n<p><code>CMakeLists.txt</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">install_demo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMAKE_CXX_STANDARD 11</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加公共头文件路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_CURRENT_SOURCE_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加静态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">slib STATIC</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    src/slib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/slib.h</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加动态库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_library</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dlib SHARED</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    src/dlib.cpp</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置安装路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_PREFIX</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"/home/hao/installed/test\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;CMAKE_INSTALL_PREFIX&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    main.cpp</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加链接库</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    slib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    dlib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 打印安装路径默认值</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"CMAKE_INSTALL_PREFIX: $&#123;CMAKE_INSTALL_PREFIX&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DIRECTORY </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    include</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/ DESTINATION include</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 安装</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TARGETS </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> slib dlib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    RUNTIME DESTINATION bin</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    LIBRARY DESTINATION lib</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ARCHIVE DESTINATION lib</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"一-安装流程\"><a class=\"anchor\" href=\"#一-安装流程\">#</a> 一、安装流程</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 生成cmake配置文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -DCMAKE_INSTALL_PREFIX=./installed</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 如果不指定安装目录，使用cmake中已经写好的或者默认值</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 编译</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 安装</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span></code></pre>\n<p>安装结果：</p>\n<p><code>\\home\\hao\\installed\\test</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bin</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install_demo</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> include</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dlib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">│</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> slib.h</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> lib</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    ├──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libdlib.so</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libslib.a</span></span></code></pre>\n<h2 id=\"二-设置运行时库搜索路径rpath\"><a class=\"anchor\" href=\"#二-设置运行时库搜索路径rpath\">#</a> 二、设置运行时库搜索路径(RPATH)</h2>\n<p>设置可执行文件运行时搜索动态库的路径</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_WITH_INSTALL_RPATH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TRUE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_INSTALL_RPATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;CMAKE_INSTALL_PREFIX&#125;/lib\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>默认情况下，CMake在构建时会使用构建目录下的库路径（如 <code>build/lib/</code>），但安装后会切换到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code>。此设置强制让构建阶段和安装阶段的 RPATH 一致，避免运行时因路径切换找不到库。</p>\n<p>**注意：**需要放在<code>add_executable</code>前面</p>\n",
            "tags": [
                "Programing",
                "CMake"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/Programing/Rust/Rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/",
            "url": "https://haoruanwn.github.io/2025/07/28/Programing/Rust/Rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/",
            "title": "rust基本语法",
            "date_published": "2025-07-28T13:49:13.000Z",
            "content_html": "<h1 id=\"rust-基本语法\"><a class=\"anchor\" href=\"#rust-基本语法\">#</a> rust 基本语法</h1>\n<h2 id=\"1-变量与可变性\"><a class=\"anchor\" href=\"#1-变量与可变性\">#</a> 1. 变量与可变性</h2>\n<p>rust 中的变量默认是 <strong>不可变</strong> 的。可以使用 <code>mut</code> 关键字使变量变为 <strong>可变</strong> 的。</p>\n<h3 id=\"11-可变变量\"><a class=\"anchor\" href=\"#11-可变变量\">#</a> 1.1 可变变量</h3>\n<p>通过 <code>mut</code> 关键字，可以声明一个可变变量，其值在后续可以被修改。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 可变变量</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"12-常量\"><a class=\"anchor\" href=\"#12-常量\">#</a> 1.2 常量</h3>\n<p>常量在绑定值后任何时候都不能更改。</p>\n<ul>\n<li><strong>声明</strong>: 使用 <code>const</code> 关键字，且必须显式标注值的类型。</li>\n<li><strong>命名</strong>: rust 常量的命名约定是使用全大写字母，并用下划线分隔单词。</li>\n<li><strong>赋值</strong>: 只能被设置为常量表达式，不能是函数调用的结果或任何其他在运行时才能确定的值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>// 常量 不可用mut，必须标注类型，仅可以用常量表达式赋值</span></span>\n<span class=\"line\"><span>const SPECAL_NUMBER: i32 = 3;</span></span>\n<span class=\"line\"><span>println!(\"The value of SPECAL_NUMBER is: &#123;&#125;\", SPECAL_NUMBER);</span></span></code></pre>\n<h3 id=\"13-变量遮蔽-shadowing\"><a class=\"anchor\" href=\"#13-变量遮蔽-shadowing\">#</a> 1.3 变量遮蔽 (Shadowing)</h3>\n<p>rust 允许声明一个与之前变量同名的新变量，这个过程称为遮蔽 (Shadowing)。新变量会“遮蔽”掉旧的变量。</p>\n<ul>\n<li>它通过再次使用 <code>let</code> 关键字来创建了一个全新的变量。</li>\n<li>这允许我们改变值的类型，同时保持名称不变。</li>\n<li>在离开作用域后，被遮蔽的变量会恢复。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 变量遮蔽</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这里的my_number是一个新的变量，遮蔽了原来的 5</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 在这个内部作用域，my_number又被一次遮蔽</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of my_number in the inner scope is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 12</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of my_number is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_number</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 输出 6</span></span></code></pre>\n<h2 id=\"2-数据类型\"><a class=\"anchor\" href=\"#2-数据类型\">#</a> 2. 数据类型</h2>\n<p>rust 是一种静态类型语言，它在编译时就必须知道所有变量的类型。数据类型可以分为两大类：<strong>标量类型</strong>和<strong>复合类型</strong>。</p>\n<h3 id=\"21-标量类型-scalar-types\"><a class=\"anchor\" href=\"#21-标量类型-scalar-types\">#</a> 2.1 标量类型 (Scalar Types)</h3>\n<p>标量类型表示一个单一的值。rust 有四种主要的标量类型：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>整数</strong></td>\n<td>有符号 (<code>i8</code> 到 <code>i128</code>, <code>isize</code>) 和无符号 (<code>u8</code> 到 <code>u128</code>, <code>usize</code>)</td>\n<td><code>let int1 = 98_222;</code></td>\n</tr>\n<tr>\n<td><strong>浮点数</strong></td>\n<td><code>f32</code> (单精度) 和 <code>f64</code> (双精度)</td>\n<td><code>const PI: f64 = 3.14159;</code></td>\n</tr>\n<tr>\n<td><strong>布尔值</strong></td>\n<td><code>bool</code>，值为 <code>true</code> 或 <code>false</code></td>\n<td><code>let is_rust_fun = true;</code></td>\n</tr>\n<tr>\n<td><strong>字符</strong></td>\n<td><code>char</code>，表示一个 Unicode 标量值，用单引号括起来</td>\n<td><code>let char1 = 'z';</code> <code>let char2 = '😻';</code></td>\n</tr>\n</tbody>\n</table>\n<p><strong>整数的字面量表示:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int1</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 98_222</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       // 十进制，下划线可用于提高可读性</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int2</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0xff</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 十六进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int3</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0o77</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 八进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int4</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0b1111_0000</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 二进制</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> int5</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A</span><span style=\"color:#999999;--shiki-dark:#666666\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         // 字节 (u8)</span></span></code></pre>\n<h3 id=\"22-复合类型-compound-types\"><a class=\"anchor\" href=\"#22-复合类型-compound-types\">#</a> 2.2 复合类型 (Compound Types)</h3>\n<p>复合类型可以将多个值组合成一个类型。rust 有两种原生的复合类型：</p>\n<h4 id=\"元组-tuple\"><a class=\"anchor\" href=\"#元组-tuple\">#</a> 元组 (Tuple)</h4>\n<ul>\n<li>将多个不同类型的值组合进一个复合类型中。</li>\n<li>长度固定：一旦声明，其大小不能伸缩。</li>\n<li>可以通过模式匹配进行 <strong>解构 (Destructuring)</strong>，或使用点号 <code>.</code> 加索引来访问元素。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 元组 不同数据类型的组合</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> f64</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> u8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 解构元组</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> z</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 通过索引访问</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> five_hundred</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> my_tuple</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The first value is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> five_hundred</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h4 id=\"数组-array\"><a class=\"anchor\" href=\"#数组-array\">#</a> 数组 (Array)</h4>\n<ul>\n<li>将多个 <strong>相同类型</strong> 的值组合在一起。</li>\n<li>长度固定。</li>\n<li>数据存储在栈上。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> first</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 访问数组元素</span></span></code></pre>\n<h2 id=\"3-函数\"><a class=\"anchor\" href=\"#3-函数\">#</a> 3. 函数</h2>\n<p>使用 <code>fn</code> 关键字定义函数。rust 代码使用蛇形命名法 (snake case) 作为函数和变量名称的规范。</p>\n<h3 id=\"31-函数参数\"><a class=\"anchor\" href=\"#31-函数参数\">#</a> 3.1 函数参数</h3>\n<p>必须为每个参数声明其类型。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> another_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> String</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of x is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"32-语句和表达式\"><a class=\"anchor\" href=\"#32-语句和表达式\">#</a> 3.2 语句和表达式</h3>\n<ul>\n<li><strong>语句 (Statements)</strong>: 执行某些操作但不返回值的指令。例如 <code>let x = 6;</code>。</li>\n<li><strong>表达式 (Expressions)</strong>: 会计算并产生一个值。例如 <code>5 + 6</code>。</li>\n<li>函数体由一系列语句和一个可选的结尾表达式构成。</li>\n<li>在 rust 中，代码块 <code>&#123;&#125;</code> 是一个表达式，它会返回块中最后一个表达式的值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 这个块表达式的返回值是 6，注意末尾没有分号</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">println!</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // y 的值为 6</span></span></code></pre>\n<h3 id=\"33-函数返回值\"><a class=\"anchor\" href=\"#33-函数返回值\">#</a> 3.3 函数返回值</h3>\n<ul>\n<li>在箭头 <code>-&gt;</code> 之后声明返回值的类型。</li>\n<li>函数的返回值是其函数体中最后一个表达式的值。</li>\n<li>可以使用 <code>return</code> 关键字提前从函数中返回。</li>\n<li>没有显式返回值的函数，其返回类型是 <code>()</code>，称为单元类型 (unit type)。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 含返回值的函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> five</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">    5</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 这是一个表达式，其值将作为函数返回值</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> plus_one</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 也可以使用 return 显式返回</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"4-控制流\"><a class=\"anchor\" href=\"#4-控制流\">#</a> 4. 控制流</h2>\n<h3 id=\"41-if-表达式\"><a class=\"anchor\" href=\"#41-if-表达式\">#</a> 4.1 <code>if</code> 表达式</h3>\n<ul>\n<li><code>if</code> 表达式的条件必须是 <code>bool</code> 类型。</li>\n<li>因为 <code>if</code> 是一个表达式，所以可以将其用在 <code>let</code> 语句的右侧来赋值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> if_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is less than 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is equal to 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x is greater than 5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // if表达式可以返回值</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value of y is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"42-循环\"><a class=\"anchor\" href=\"#42-循环\">#</a> 4.2 循环</h3>\n<p>rust 提供了三种循环：<code>loop</code>、<code>while</code> 和 <code>for</code>。</p>\n<h4 id=\"loop\"><a class=\"anchor\" href=\"#loop\">#</a> <code>loop</code></h4>\n<ul>\n<li><code>loop</code> 关键字告诉 rust 无限次地执行一块代码，直到你显式地告诉它停止。</li>\n<li>可以使用 <code>break</code> 关键字退出循环，<code>break</code> 后面可以跟一个表达式，作为 <code>loop</code> 循环的返回值。</li>\n<li>可以使用 <code>continue</code> 跳过当前迭代，进入下一次迭代。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> loop_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> i32</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        counter</span><span style=\"color:#999999;--shiki-dark:#666666\"> +=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            break</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> counter</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出循环并返回 20</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"循环标签-loop-labels\"><a class=\"anchor\" href=\"#循环标签-loop-labels\">#</a> 循环标签 (Loop Labels)</h4>\n<p>对于嵌套循环，可以使用循环标签来指定 <code>break</code> 或 <code>continue</code> 要作用于哪个循环。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> labeled_loop</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> count</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    '</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">counting_up</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        loop</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            println!</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">remaining = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> remaining</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                break</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出内层循环</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> count</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                break</span><span style=\"color:#999999;--shiki-dark:#666666\"> '</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">counting_up</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 退出名为 'counting_up 的外层循环</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">            remaining</span><span style=\"color:#999999;--shiki-dark:#666666\"> -=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        count</span><span style=\"color:#999999;--shiki-dark:#666666\"> +=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">End count = </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">count</span><span style=\"color:#999999;--shiki-dark:#666666\">&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"while-循环\"><a class=\"anchor\" href=\"#while-循环\">#</a> <code>while</code> 循环</h4>\n<p>当条件为真时，循环就会继续。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> while_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> mut</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    while</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        number</span><span style=\"color:#999999;--shiki-dark:#666666\"> -=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">LIFTOFF!!!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"for-循环\"><a class=\"anchor\" href=\"#for-循环\">#</a> <code>for</code> 循环</h4>\n<p>用于遍历集合中的每个元素，如数组。<code>for</code> 循环是更安全、更简洁的选择，因为它避免了 <code>while</code> 循环中可能出现的索引越界等错误。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-rust\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fn</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> for_function</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    let</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 使用 .iter() 方法遍历集合</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> element</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">iter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">The value is: </span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> element</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 遍历一个范围 (Range)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // .rev() 方法用于反转范围</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">..</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rev</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        println!</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&#123;&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    println!</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">LIFTOFF!!!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "Programing",
                "Rust"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/%E8%AE%BE%E7%BD%AEvim%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E4%B8%BAutf-8/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/%E8%AE%BE%E7%BD%AEvim%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E4%B8%BAutf-8/",
            "title": "设置vim编码格式为utf-8",
            "date_published": "2025-07-28T13:47:38.000Z",
            "content_html": "<h4 id=\"配置-vim-实现永久解决\"><a class=\"anchor\" href=\"#配置-vim-实现永久解决\">#</a> 配置 Vim 实现永久解决</h4>\n<p>为了让 Vim 以后新建或打开文件时都默认使用 UTF-8，需要配置 Vim 的启动文件 <code>.vimrc</code>。</p>\n<ol>\n<li>\n<p><strong>回到您的终端</strong> (如果还在Vim里，先输入 <code>:q</code> 退出)。</p>\n</li>\n<li>\n<p><strong>编辑 Vim 配置文件</strong>。这个文件位于您的用户主目录下，名为 <code>.vimrc</code>。如果不存在，这个命令会自动创建它。</p>\n<p>Bash</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>vim ~/.vimrc</span></span></code></pre>\n</li>\n<li>\n<p><strong>在文件中加入以下配置</strong>：</p>\n<p>Vim Script</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>\" 设置Vim内部使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set encoding=utf-8</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>\" 设置Vim保存文件时使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set fileencoding=utf-8</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>\" 设置Vim与终端通信时使用的编码为UTF-8</span></span>\n<span class=\"line\"><span>set termencoding=utf-8</span></span></code></pre>\n<ul>\n<li><strong>提示</strong>：在 Vim 配置文件中，<code>&quot;</code> 开头的行是注释。</li>\n</ul>\n</li>\n<li>\n<p><strong>保存并退出</strong>。</p>\n<ul>\n<li>在 <code>nano</code> 中，按 <code>Ctrl+X</code>，然后按 <code>Y</code>，再按 <code>Enter</code>。</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "VIM"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/%E4%BD%BF%E7%94%A8chroot%E5%92%8CQEMU%E8%B0%83%E8%AF%95%E5%BC%80%E5%8F%91%E6%9D%BF%E7%B3%BB%E7%BB%9F/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/%E4%BD%BF%E7%94%A8chroot%E5%92%8CQEMU%E8%B0%83%E8%AF%95%E5%BC%80%E5%8F%91%E6%9D%BF%E7%B3%BB%E7%BB%9F/",
            "title": "使用chroot和QEMU调试开发板系统",
            "date_published": "2025-07-28T13:46:47.000Z",
            "content_html": "<h1 id=\"使用-chroot-和-qemu-调试开发板系统\"><a class=\"anchor\" href=\"#使用-chroot-和-qemu-调试开发板系统\">#</a> 使用 <code>chroot</code> 和 QEMU 调试开发板系统</h1>\n<h2 id=\"一-chroot-与-qemu-简介\"><a class=\"anchor\" href=\"#一-chroot-与-qemu-简介\">#</a> 一、<code>chroot</code> 与 QEMU 简介</h2>\n<h3 id=\"chroot-change-root\"><a class=\"anchor\" href=\"#chroot-change-root\">#</a> <code>chroot</code> (Change Root)</h3>\n<p><code>chroot</code> 是 Linux 系统中的一个命令及系统调用，用于将一个进程及其子进程的根目录切换到文件系统中的一个新位置。这使得该进程无法访问或命名新根目录之外的文件。</p>\n<p><strong>主要用途：</strong></p>\n<ul>\n<li><strong>系统修复</strong>：当系统无法启动时，可以使用 Live CD 启动，然后 <code>chroot</code> 到损坏的系统中进行修复。</li>\n<li><strong>安全隔离</strong>：限制特定进程的文件系统访问权限，创建一个简易的沙箱环境。</li>\n<li><strong>交叉编译</strong>：在 x86 主机上为 ARM 等不同架构的设备构建和测试软件。</li>\n<li><strong>环境测试</strong>：在当前系统中模拟另一个 Linux 发行版环境，例如在 Ubuntu 中运行 Debian 环境。</li>\n</ul>\n<h3 id=\"qemu-user-static\"><a class=\"anchor\" href=\"#qemu-user-static\">#</a> <code>qemu-user-static</code></h3>\n<p>当在 x86 架构的主机上 <code>chroot</code> 到一个为 ARM 等异构平台构建的根文件系统时，会因为 CPU 指令集不兼容而导致无法执行任何程序。<code>qemu-user-static</code> 通过 <code>binfmt_misc</code> 机制解决了这个问题，它能够透明地解释和执行异构架构的二进制文件，从而在主机上模拟目标硬件环境。</p>\n<h2 id=\"二-操作流程\"><a class=\"anchor\" href=\"#二-操作流程\">#</a> 二、操作流程</h2>\n<h3 id=\"1-安装-qemu-user-static\"><a class=\"anchor\" href=\"#1-安装-qemu-user-static\">#</a> 1. 安装 <code>qemu-user-static</code></h3>\n<p>首先，在主机系统中安装 <code>qemu-user-static</code> 软件包。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> qemu-user-static</span></span></code></pre>\n<p>安装完成后，将对应目标架构的 QEMU 静态二进制文件复制到开发板根文件系统的 <code>usr/bin</code> 目录下。例如，对于 ARM 架构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 假设 \"ubuntu/\" 是开发板根文件系统的挂载点</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/qemu-arm-static</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ubuntu/usr/bin/</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/bin/qemu-aarch64-static</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ubuntu/usr/bin/</span></span></code></pre>\n<p>为了确保 QEMU 能够自动处理异构架构的二进制文件，需要检查 <code>binfmt_misc</code> 的配置是否已启用。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ls</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -l</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /proc/sys/fs/binfmt_misc/</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 检查对应的 qemu-aarch64 解释器是否启用</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cat</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /proc/sys/fs/binfmt_misc/qemu-aarch64</span></span></code></pre>\n<p>理想情况下，<code>cat</code> 命令的输出应显示 <code>enabled</code>。</p>\n<p>手动注册qemu</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># rsicv64</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">echo \":qemu-riscv64:M::\\x7fELF\\x02\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\xf3\\x00:\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xfe\\xff\\xff\\xff:/usr/bin/qemu-riscv64-static:F\" > /proc/sys/fs/binfmt_misc/register</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># aarch64</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">echo \":qemu-aarch64:M::\\x7fELF\\x02\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\xb7\\x00:\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xfe\\xff\\xff\\xff:/usr/bin/qemu-aarch64-static:F\" > /proc/sys/fs/binfmt_misc/register</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span></code></pre>\n<h3 id=\"2-挂载根文件系统-rootfs\"><a class=\"anchor\" href=\"#2-挂载根文件系统-rootfs\">#</a> 2. 挂载根文件系统 (rootfs)</h3>\n<p>为了方便地挂载和卸载 <code>chroot</code> 环境所需的虚拟文件系统，可以创建一个脚本。</p>\n<p><strong>创建 <code>mount.sh</code> 脚本：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># mount.sh - Mounts/unmounts essential filesystems for chroot</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> mnt</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">MOUNTING...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -t</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> proc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /proc</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">proc</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -t</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sysfs</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /sys</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sys</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bind</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bind</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /dev/pts</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev/pts</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Entering chroot environment...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> chroot</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> umnt</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UNMOUNTING...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> umount</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">proc</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> umount</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sys</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> umount</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev/pts</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> umount</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> &#x26;&#x26;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> then</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    mnt</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $1</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $2</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">elif</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-u</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> &#x26;&#x26;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> then</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    umnt</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $1</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $2</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Usage: $0 [-m|-u] &#x3C;rootfs_path></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  -m: Mount and chroot into the rootfs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  -u: Unmount the rootfs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Example: $0 -m /path/to/rootfs/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fi</span></span></code></pre>\n<p><strong>赋予脚本执行权限：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">chmod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount.sh</span></span></code></pre>\n<p>python脚本</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#!/usr/bin/env python3</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># -*- coding: utf-8 -*-</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sys</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> subprocess</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> shutil</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># --- 用户配置 ---</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># !!! 请在这里修改为您要挂载的根文件系统的绝对路径 !!!</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/home/hao/k230_sdk/output/k230_canmv_lckfb_defconfig/images/debian13</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># !!! (可选) 如果您需要跨架构 chroot (例如在 x86 电脑上 chroot ARM 系统),</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 请指定 QEMU 静态二进制文件的路径。如果不需要，请留空 \"\"。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 通常在 /usr/bin/ 目录下, 例如 qemu-aarch64-static, qemu-arm-static 等。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">QEMU_STATIC_BINARY</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/usr/bin/qemu-riscv64-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># --- 配置结束 ---</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run_command</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> check=True</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"执行一个 shell 命令并处理可能发生的错误\"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"🚀 执行: &#123;' '.join(command)&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    try:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        subprocess.run</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">command,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> check=check</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    except</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> FileNotFoundError:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 命令未找到: &#123;command[0]&#125;。请确保该程序已安装并在 PATH 环境变量中。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        sys.exit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    except</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> subprocess.CalledProcessError</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> e:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 命令执行失败: &#123;' '.join(e.cmd)&#125; (返回码: &#123;e.returncode&#125;)\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> check:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">             print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   (警告: 此命令失败，但程序将继续执行)\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        else:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            sys.exit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> unmount_filesystems</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    按正确顺序卸载所有 chroot 文件系统。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    该函数设计得非常健壮，会检查每个挂载点是否存在且已挂载。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"\\n🧹 开始安全卸载程序...\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    mount_points</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev/pts</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sys</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">proc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mp</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount_points:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        target_path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mp</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> os.path.exists</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">target_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> and os.path.ismount</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">target_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            run_command</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sudo'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">umount</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-l</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> target_path],</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> check=False</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用 -l (lazy) 更安全</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> QEMU_STATIC_BINARY:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        qemu_dest_path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">usr</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bin</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.basename</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">QEMU_STATIC_BINARY</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> os.path.exists</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">qemu_dest_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   清理 QEMU 模拟器: &#123;qemu_dest_path&#125;\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            run_command</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sudo'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rm</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> qemu_dest_path]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"✅ 清理完成。\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mount_and_chroot</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    挂载所需的文件系统并进入 chroot 环境。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    使用 try...finally 确保无论 chroot 内部发生什么，都会执行卸载。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    try:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"🛠️  开始挂载 chroot 所需的文件系统...\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        mounts</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'proc'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">proc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">proc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> None</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sysfs'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sys</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sysfs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> None</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'/dev'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> None,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bind</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'/dev/pts'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dev/pts</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> None,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bind</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> source, dest_subdir, fstype, options in mounts:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            target_path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dest_subdir</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.exists</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">target_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   创建缺失的目录: &#123;target_path&#125;\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                run_command</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sudo'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mkdir</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-p</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> target_path]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            command</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sudo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mount</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fstype:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> command.extend</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-t</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, fstype</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> options</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bind</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> command.extend</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-o</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bind</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            command</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">.extend</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">[</span><span style=\"color:#998418;--shiki-dark:#B8A965\">source</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> target_path]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            run_command</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">command</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> QEMU_STATIC_BINARY:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.exists</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">QEMU_STATIC_BINARY</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 错误: QEMU 模拟器 '&#123;QEMU_STATIC_BINARY&#125;' 未在您的主机上找到。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   如果您正在进行跨架构 chroot，请安装它 (例如: 'sudo apt install qemu-user-static')。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                return</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            ### --- 新增功能：检查 binfmt_misc 是否启用 --- ###</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            # 从 QEMU 二进制文件名推断出 binfmt_misc 的处理器名</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            # 例如 \"qemu-aarch64-static\" -> \"qemu-aarch64\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            handler_name</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.basename</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">QEMU_STATIC_BINARY</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">.removesuffix</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'-static'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            binfmt_path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> f</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/proc/sys/fs/binfmt_misc/&#123;handler_name&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   检查 QEMU binfmt_misc 处理器: &#123;binfmt_path&#125;\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.exists</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">binfmt_path</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 错误: QEMU binfmt_misc 处理器未启用 (&#123;binfmt_path&#125; 不存在)。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   这意味着您的主机内核可能无法直接运行目标架构的二进制文件。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   请尝试通过重启服务来注册处理器，例如运行:\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"     sudo systemctl restart systemd-binfmt.service\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   或者:\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">                print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"     sudo update-binfmts --enable\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">                return</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 提前中止，finally 块会负责清理</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   ✅ QEMU binfmt_misc 处理器已启用。\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            ### --- 新增功能结束 --- ###</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            qemu_dest_path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">usr</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">bin</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.basename</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">QEMU_STATIC_BINARY</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">            print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   复制 QEMU 模拟器到 chroot 环境: &#123;qemu_dest_path&#125;\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            run_command</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sudo'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> QEMU_STATIC_BINARY,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> qemu_dest_path]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"\\n✅ 挂载完成。即将进入 chroot 环境...\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   在 chroot 环境中，您可以执行所需命令。\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"   完成后，请键入 'exit' 以退出 chroot 并自动卸载所有文件系统。\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        run_command</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'sudo'</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">chroot</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ROOTFS_PATH]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    except</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Exception</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> e:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"\\n❌ 在挂载或 chroot 过程中发生意外错误: &#123;e&#125;\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    finally:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"\\n🚪 已退出 chroot 环境或发生错误。\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        unmount_filesystems</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"脚本主入口\"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> os.geteuid</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 错误: 此脚本需要 root 权限。请使用 'sudo' 运行。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        sys.exit</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> os.path.isdir</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ROOTFS_PATH</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"❌ 错误: 配置的根文件系统路径 '&#123;ROOTFS_PATH&#125;' 不是一个有效的目录。\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> file=sys.stderr</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        sys.exit</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> len</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">sys.argv</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> or</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sys.argv[1]</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> not</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-u</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">]:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">f</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"用法: sudo &#123;sys.argv[0]&#125; [-m|-u]\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"  -m: 挂载文件系统并进入 chroot 环境\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"  -u: 仅卸载文件系统 (用于手动清理)\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        sys.exit</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    action</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sys.argv[1]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> action</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        mount_and_chroot</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    elif</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> action</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-u</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        unmount_filesystems</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> __name__</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">__main__</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    main</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span></span></code></pre>\n<p>使用方式</p>\n<ol>\n<li>\n<p><strong>配置</strong>：打开 <code>manage_chroot.py</code> 文件，修改顶部的 <code>ROOTFS_PATH</code> 变量，使其指向你的根文件系统目录（例如 <code>/home/user/my_project/rootfs</code>）。如果需要，同时配置 <code>QEMU_STATIC_BINARY</code>。</p>\n</li>\n<li>\n<p><strong>挂载并进入 Chroot</strong>： 在终端中运行以下命令。脚本将挂载所有必要的文件系统，然后自动带你进入 <code>chroot</code> 环境。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> python3</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> manage_chroot.py</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span></span></code></pre>\n<p>当你完成在 <code>chroot</code> 环境中的工作后，只需输入 <code>exit</code> 并按回车。脚本会自动检测到退出，并执行所有卸载和清理操作。</p>\n</li>\n<li>\n<p><strong>仅执行卸载</strong>： 如果在某些异常情况下，你需要手动执行清理，可以运行以下命令。它会安全地卸载所有相关的挂载点。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> python3</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> manage_chroot.py</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span></span></code></pre>\n</li>\n</ol>\n<h3 id=\"3-进入-chroot-环境并进行系统配置\"><a class=\"anchor\" href=\"#3-进入-chroot-环境并进行系统配置\">#</a> 3. 进入 <code>chroot</code> 环境并进行系统配置</h3>\n<p>使用上一步创建的脚本挂载并进入开发板的根文件系统。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 假设开发板根文件系统位于当前目录下的 \"ubuntu/\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./mount.sh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ubuntu/</span></span></code></pre>\n<p>成功进入后，你将处于开发板的模拟环境中，可以执行系统配置任务。</p>\n<h4 id=\"a-更新软件源及安装必要软件\"><a class=\"anchor\" href=\"#a-更新软件源及安装必要软件\">#</a> a. 更新软件源及安装必要软件</h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 某些系统可能需要赋予/tmp目录写权限</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">chmod</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 777</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /tmp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> udev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> net-tools</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ethtool</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> udhcpc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> netplan.io</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               language-pack-en-base</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> iputils-ping</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> openssh-sftp-server</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               ntp</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> usbutils</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> alsa-utils</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libmtp9</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> language-pack-zh-han</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               bluetooth</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bluez</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> blueman</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wireless-tools</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> network-manager</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dialog</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 清理不需要的软件包</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">apt-get</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> remove</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --purge</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> libreoffice</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">apt-get</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> autoremove</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span></span></code></pre>\n<h4 id=\"b-添加用户及配置权限\"><a class=\"anchor\" href=\"#b-添加用户及配置权限\">#</a> b. 添加用户及配置权限</h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 添加一个新用户（例如 tspi）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">adduser</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> tspi</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 将新用户添加到 sudo 组以赋予管理员权限</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">adduser</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> tspi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sudo</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 修改 root 用户的密码</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">passwd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span></span></code></pre>\n<h4 id=\"c-优化开机网络等待时间\"><a class=\"anchor\" href=\"#c-优化开机网络等待时间\">#</a> c. 优化开机网络等待时间</h4>\n<p>默认情况下，系统启动时可能会等待网络配置长达5分钟。通过修改 systemd 服务，可以缩短或禁用此等待时间。</p>\n<p><strong>编辑服务文件：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">vim</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/network-online.target.wants/systemd-networkd-wait-online.service</span></span></code></pre>\n<p><strong>修改 <code>ExecStart</code> 行：</strong><br />\n将 <code>timeout</code> 参数改为一个较小的值（如 5 秒）或 <code>0</code>（禁用）。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Service</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ExecStart</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/usr/bin/nm-online -s -q --</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">timeout</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">5</span></span></code></pre>\n<h4 id=\"d-添加分区自动扩容服务重要\"><a class=\"anchor\" href=\"#d-添加分区自动扩容服务重要\">#</a> d. 添加分区自动扩容服务（重要）</h4>\n<p>为了让烧录到 SD 卡或 eMMC 的文件系统在首次启动时自动扩展以使用整个分区空间，可以创建一个系统服务。</p>\n<p><strong>(1) 创建 <code>resize2fs.sh</code> 脚本：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">vim</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /etc/init.d/resize2fs.sh</span></span></code></pre>\n<p><strong>添加以下内容：</strong><br />\n该脚本会检查一个标志文件，如果不存在，则执行分区扩容并创建该标志文件，确保扩容只执行一次。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#!/bin/bash -e</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Resize the root filesystem partition, e.g., /dev/mmcblk0p6</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">PARTITION_TO_RESIZE</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/dev/mmcblk0p6</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">FLAG_FILE</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/usr/local/boot_flag</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -e</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$FLAG_FILE</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> ;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> then</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Resizing $PARTITION_TO_RESIZE...</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  resize2fs</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> $PARTITION_TO_RESIZE</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  touch</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$FLAG_FILE</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Resize complete.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">fi</span></span></code></pre>\n<p><strong>(2) 赋予脚本执行权限：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">chmod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /etc/init.d/resize2fs.sh</span></span></code></pre>\n<p><strong>(3) 创建 systemd 服务来执行此脚本：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">vim</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /lib/systemd/system/resize2fs.service</span></span></code></pre>\n<p><strong>添加服务定义：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Unit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Description</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Resize root filesystem on first boot</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DefaultDependencies</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">no</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">After</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">systemd-remount-fs.service</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Before</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">local-fs.target</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Service</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">oneshot</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ExecStart</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/etc/init.d/resize2fs.sh</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">StandardOutput</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">journal</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RemainAfterExit</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">yes</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WantedBy</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">multi-user.target</span></span></code></pre>\n<p><strong>(4) 启用该服务：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> resize2fs.service</span></span></code></pre>\n<h3 id=\"4-退出并卸载根文件系统\"><a class=\"anchor\" href=\"#4-退出并卸载根文件系统\">#</a> 4. 退出并卸载根文件系统</h3>\n<p>完成所有配置后，退出 <code>chroot</code> 环境。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">exit</span></span></code></pre>\n<p>返回到主机系统后，使用脚本卸载之前挂载的虚拟文件系统。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./mount.sh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ubuntu/</span></span></code></pre>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "rootfs"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/NTP%E4%B8%8E%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E8%AE%BE%E7%BD%AE/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/NTP%E4%B8%8E%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E8%AE%BE%E7%BD%AE/",
            "title": "NTP与系统时间设置",
            "date_published": "2025-07-28T13:45:22.000Z",
            "content_html": "<h2 id=\"一-安装基础服务\"><a class=\"anchor\" href=\"#一-安装基础服务\">#</a> 一、安装基础服务</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemd-timesyncd</span></span></code></pre>\n<h4 id=\"如果因为系统时间问题导致apt源不可用\"><a class=\"anchor\" href=\"#如果因为系统时间问题导致apt源不可用\">#</a> 如果因为系统时间问题导致apt源不可用</h4>\n<p>手动设置时间</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> date</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">2025-06-26 00:26:00</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 设置为当前时间</span></span></code></pre>\n<h2 id=\"二-修改ntp服务器地址\"><a class=\"anchor\" href=\"#二-修改ntp服务器地址\">#</a> 二、修改NTP服务器地址</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/timesyncd.conf</span></span></code></pre>\n<p>添加NTP服务器</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Time</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">NTP</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ntp.aliyun.com ntp1.aliyun.com ntp2.aliyun.com</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#FallbackNTP=ntp.ubuntu.com</span></span></code></pre>\n<p>重启服务</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> restart</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemd-timesyncd</span></span></code></pre>\n<p>检查状态</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">timedatectl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> status</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 理想输出</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">tspi@localhost:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> timedatectl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> status</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">               Local</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> time:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Thu</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2025-06-26</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 00:29:05</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CST</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">           Universal</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> time:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Wed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2025-06-25</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 16:29:05</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> UTC</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                 RTC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> time:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Wed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2025-06-25</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 16:29:06</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                Time</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> zone:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Asia/Shanghai</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CST, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">+0800</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">System</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clock</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> synchronized:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">              NTP</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> service:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> active</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">          RTC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> local</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> TZ:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">tspi@localhost:~$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span></span></code></pre>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "系统配置"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/systemd%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/systemd%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/",
            "title": "systemd设置开机自启",
            "date_published": "2025-07-28T13:43:52.000Z",
            "content_html": "<h3 id=\"ubuntudebian-使用-systemd-设置开机自启服务快速指南\"><a class=\"anchor\" href=\"#ubuntudebian-使用-systemd-设置开机自启服务快速指南\">#</a> <strong>Ubuntu/Debian 使用 <code>systemd</code> 设置开机自启服务快速指南</strong></h3>\n<p>本文档提供了在基于 <code>systemd</code> 的现代 Linux 系统（如 Ubuntu, Debian 等）上创建和管理开机自启服务的标准流程。</p>\n<h4 id=\"第1步准备您的脚本\"><a class=\"anchor\" href=\"#第1步准备您的脚本\">#</a> <strong>第1步：准备您的脚本</strong></h4>\n<p>确保您的脚本可以被系统直接执行。</p>\n<ol>\n<li>\n<p>指定解释器 (Shebang)</p>\n<p>在脚本文件的第一行，指明用于执行它的程序。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#!/usr/bin/env python3 </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 或者 #!/bin/bash</span></span></code></pre>\n</li>\n<li>\n<p>放置在标准位置</p>\n<p>将脚本移动到系统的可执行路径下，推荐使用 /usr/local/bin。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> your_script.py</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/local/bin/</span></span></code></pre>\n</li>\n<li>\n<p>赋予执行权限</p>\n<p>使脚本文件变为可执行。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> chmod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /usr/local/bin/your_script.py</span></span></code></pre>\n</li>\n</ol>\n<hr />\n<h4 id=\"第2步创建-systemd-服务文件\"><a class=\"anchor\" href=\"#第2步创建-systemd-服务文件\">#</a> <strong>第2步：创建 <code>systemd</code> 服务文件</strong></h4>\n<p>创建一个服务单元文件来告诉 <code>systemd</code> 如何管理您的脚本。</p>\n<ol>\n<li>\n<p>创建 .service 文件</p>\n<p>在 /etc/systemd/system/ 目录下创建一个以 .service 结尾的新文件。文件名将作为您的服务名。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nano</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/myservice.service</span></span></code></pre>\n</li>\n<li>\n<p>填入模板内容</p>\n<p>将以下模板粘贴到文件中，并根据您的需求修改 Description 和 ExecStart 字段。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Unit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 对服务的简短描述</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Description</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">My Custom Startup Service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 指定服务在网络准备好之后启动</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">After</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">network.target</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Service</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 指定要执行的脚本的完整路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ExecStart</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/usr/local/bin/your_script.py</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义服务失败后总是自动重启</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">Restart</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">always</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Install</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 指定服务在多用户模式下启用</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WantedBy</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">multi-user.target</span></span></code></pre>\n</li>\n</ol>\n<hr />\n<h4 id=\"第3步管理服务\"><a class=\"anchor\" href=\"#第3步管理服务\">#</a> <strong>第3步：管理服务</strong></h4>\n<p>使用 <code>systemctl</code> 命令来控制您的新服务。</p>\n<ol>\n<li>\n<p>重新加载配置</p>\n<p>在创建或修改服务文件后，必须运行此命令来让 systemd 读取新的配置。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span></code></pre>\n</li>\n<li>\n<p>启用服务</p>\n<p>将服务设置为开机自启。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> myservice.service</span></span></code></pre>\n</li>\n<li>\n<p>立即启动服务</p>\n<p>无需重启，立即运行您的服务以进行测试。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> myservice.service</span></span></code></pre>\n</li>\n<li>\n<p>检查服务状态</p>\n<p>查看服务是否正在运行，以及查看最新的日志输出，这是调试的关键。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> myservice.service</span></span></code></pre>\n</li>\n</ol>\n<hr />\n<h3 id=\"常用命令备忘\"><a class=\"anchor\" href=\"#常用命令备忘\">#</a> <strong>常用命令备忘</strong></h3>\n<ul>\n<li><strong>启用开机自启</strong>： <code>sudo systemctl enable myservice.service</code></li>\n<li><strong>禁止开机自启</strong>： <code>sudo systemctl disable myservice.service</code></li>\n<li><strong>启动服务</strong>： <code>sudo systemctl start myservice.service</code></li>\n<li><strong>停止服务</strong>： <code>sudo systemctl stop myservice.service</code></li>\n<li><strong>重启服务</strong>： <code>sudo systemctl restart myservice.service</code></li>\n<li><strong>查看状态和日志</strong>：<code>sudo systemctl status myservice.service</code></li>\n<li><strong>查看完整日志</strong>： <code>sudo journalctl -u myservice.service</code></li>\n</ul>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "系统配置"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/SBC/%E5%BC%80%E5%8F%91%E6%9D%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/",
            "url": "https://haoruanwn.github.io/2025/07/28/SBC/%E5%BC%80%E5%8F%91%E6%9D%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/",
            "title": "开发板网络配置",
            "date_published": "2025-07-28T13:43:22.000Z",
            "content_html": "<h1 id=\"使用-nmcli-管理网络连接\"><a class=\"anchor\" href=\"#使用-nmcli-管理网络连接\">#</a> 使用 <code>nmcli</code> 管理网络连接</h1>\n<p><code>nmcli</code> 是 NetworkManager 的命令行客户端，是在现代 Linux 发行版（如 Debian、Ubuntu、CentOS）中管理网络连接的强大工具。</p>\n<h2 id=\"一-wifi-配置\"><a class=\"anchor\" href=\"#一-wifi-配置\">#</a> 一、WiFi 配置</h2>\n<h3 id=\"1-查看网络设备\"><a class=\"anchor\" href=\"#1-查看网络设备\">#</a> 1. 查看网络设备</h3>\n<p>首先，使用 <code>nmcli device status</code> 查看系统中所有网络设备及其状态，以确定无线网卡的名称（通常为 <code>wlan0</code>）。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> status</span></span></code></pre>\n<h3 id=\"2-扫描-wifi-网络\"><a class=\"anchor\" href=\"#2-扫描-wifi-网络\">#</a> 2. 扫描 WiFi 网络</h3>\n<p>使用以下命令扫描并列出周围可用的 WiFi 网络。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wifi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span></span></code></pre>\n<h3 id=\"3-连接-断开与删除-wifi\"><a class=\"anchor\" href=\"#3-连接-断开与删除-wifi\">#</a> 3. 连接、断开与删除 WiFi</h3>\n<h4 id=\"连接到-wifi\"><a class=\"anchor\" href=\"#连接到-wifi\">#</a> 连接到 WiFi</h4>\n<p>使用 <code>connect</code> 命令连接到指定的 WiFi 网络 (SSID)。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 格式: sudo nmcli device wifi connect &#x3C;SSID> password &#x3C;密码></span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wifi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 503</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> password</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 503503503</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wifi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connect</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 虚空终端</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> password</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 503503503</span></span></code></pre>\n<p>连接成功后，NetworkManager 会自动创建一个连接配置文件。</p>\n<p>设置为开机自动连接</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 503</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection.autoconnect</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yes</span></span></code></pre>\n<h4 id=\"管理连接配置\"><a class=\"anchor\" href=\"#管理连接配置\">#</a> 管理连接配置</h4>\n<p>可以查看、修改、断开或删除已保存的连接配置。</p>\n<table>\n<thead>\n<tr>\n<th><strong>操作</strong></th>\n<th><strong>命令</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>查看所有配置</strong></td>\n<td><code>nmcli connection show</code></td>\n<td>列出所有已保存的网络连接配置。</td>\n</tr>\n<tr>\n<td><strong>设置自动连接</strong></td>\n<td><code>sudo nmcli connection modify &lt;名称&gt; connection.autoconnect yes</code></td>\n<td>将指定连接设置为开机自动连接。</td>\n</tr>\n<tr>\n<td><strong>断开连接</strong></td>\n<td><code>nmcli device disconnect &lt;网卡名称&gt;</code></td>\n<td>临时断开指定网卡的当前连接。</td>\n</tr>\n<tr>\n<td><strong>删除配置</strong></td>\n<td><code>sudo nmcli connection delete &lt;名称&gt;</code></td>\n<td>永久删除指定名称的连接配置文件。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>示例：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看所有连接配置，找到要操作的连接名称</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> show</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置名为 \"503\" 的 WiFi 连接开机自启</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 503</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection.autoconnect</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 断开 wlan0 网卡的连接</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> disconnect</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wlan0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除名为 \"虚空终端\" 的 WiFi 配置</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> delete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 虚空终端</span></span></code></pre>\n<h2 id=\"二-设置静态-ip-地址\"><a class=\"anchor\" href=\"#二-设置静态-ip-地址\">#</a> 二、设置静态 IP 地址</h2>\n<p>在某些场景下（如将设备用作服务器或通过旁路由上网），需要将动态 IP (DHCP) 修改为静态 IP。</p>\n<h3 id=\"1-确定要修改的连接\"><a class=\"anchor\" href=\"#1-确定要修改的连接\">#</a> 1. 确定要修改的连接</h3>\n<p>首先，使用 <code>nmcli connection show</code> 找到需要修改的连接配置的名称 (<code>NAME</code>)。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> show</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 示例输出</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># NAME                UUID                                  TYPE      DEVICE </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 503                 82cbca27-7035-420a-96c0-f54aef5c5f83  wifi      wlan0  </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Wired connection 1  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  ethernet  eth0</span></span></code></pre>\n<h3 id=\"2-修改连接为静态-ip\"><a class=\"anchor\" href=\"#2-修改连接为静态-ip\">#</a> 2. 修改连接为静态 IP</h3>\n<p>使用 <code>nmcli connection modify</code> 命令修改指定连接的网络参数。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 语法示例</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">&#x3C;连接名称></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.method</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> manual</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.addresses</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">IP地</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">址</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">子网掩码前</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">缀</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.gateway</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">网关地</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">址</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.dns</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">&#x3C;DNS服务器1>,&#x3C;DNS服务器2></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 实际示例：将名为 \"503\" 的连接修改为静态IP</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">503</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.method</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> manual</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.addresses</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 192.168.31.152/24</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.gateway</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 192.168.31.141</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    ipv4.dns</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">223.5.5.5,114.114.114.114</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ipv4.method</code></td>\n<td><code>manual</code> 表示静态 IP，<code>auto</code> 表示 DHCP。</td>\n</tr>\n<tr>\n<td><code>ipv4.addresses</code></td>\n<td>设置静态 IP 地址和子网掩码（使用 CIDR 表示法）。</td>\n</tr>\n<tr>\n<td><code>ipv4.gateway</code></td>\n<td>设置默认网关地址。</td>\n</tr>\n<tr>\n<td><code>ipv4.dns</code></td>\n<td>设置 DNS 服务器，多个服务器用逗号分隔。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-应用更改\"><a class=\"anchor\" href=\"#3-应用更改\">#</a> 3. 应用更改</h3>\n<p>修改配置后，需要重新激活连接以使设置生效。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>sudo nmcli connection down \"503\" &#x26;&#x26; sudo nmcli connection up \"503\"</span></span></code></pre>\n<h3 id=\"4-恢复为-dhcp\"><a class=\"anchor\" href=\"#4-恢复为-dhcp\">#</a> 4. 恢复为 DHCP</h3>\n<p>如果需要从静态 IP 切换回动态 IP (DHCP)，只需将 <code>ipv4.method</code> 修改为 <code>auto</code> 并重连即可。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">503</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ipv4.method</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> auto</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 清空静态配置（可选但推荐）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> modify</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">503</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ipv4.addresses</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ipv4.gateway</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ipv4.dns</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 重启连接</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nmcli</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> connection</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">503</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h2 id=\"三-无线网络测试\"><a class=\"anchor\" href=\"#三-无线网络测试\">#</a> 三、无线网络测试</h2>\n<p>配置完成后，可以使用以下工具测试网络连通性。</p>\n<table>\n<thead>\n<tr>\n<th><strong>命令</strong></th>\n<th><strong>用途</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ping</code></td>\n<td>测试与目标主机（IP或域名）的基本连通性和延迟。 <code>ping 8.8.8.8</code></td>\n</tr>\n<tr>\n<td><code>ip addr</code></td>\n<td>查看网络接口的 IP 地址、MAC 地址等详细信息。</td>\n</tr>\n<tr>\n<td><code>iwconfig</code></td>\n<td>（旧工具）查看无线网卡的连接状态，如 SSID、信号强度 (Link Quality)、比特率 (Bit Rate) 等。</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "单板计算机/Linux开发板",
                "网络"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAwindows/",
            "url": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAwindows/",
            "title": "opencv环境搭建windows",
            "date_published": "2025-07-28T13:39:04.000Z",
            "content_html": "<h1 id=\"说明\"><a class=\"anchor\" href=\"#说明\">#</a> 说明</h1>\n<p>Windows平台，使用CMake构建，Clion开发。官网下载的OpenCV是使用MSVC编译的，所以工具链需要配置为MSVC，否则会有ABI不兼容的问题。如果要用MinGW的话需要从源码编译一遍OpenCV。</p>\n<h1 id=\"流程\"><a class=\"anchor\" href=\"#流程\">#</a> 流程</h1>\n<h2 id=\"一-设置环境变量\"><a class=\"anchor\" href=\"#一-设置环境变量\">#</a> 一、设置环境变量</h2>\n<h4 id=\"添加系统变量opencv_dir\"><a class=\"anchor\" href=\"#添加系统变量opencv_dir\">#</a> 添加系统变量<code>OpenCV_DIR</code></h4>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506171515987.png\" alt=\"QQ20250617-151450\" /></p>\n<h4 id=\"添加环境变量\"><a class=\"anchor\" href=\"#添加环境变量\">#</a> 添加环境变量</h4>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506171515202.png\" alt=\"QQ20250617-151514\" /></p>\n<p><strong>配置好后需要重启电脑</strong></p>\n<h2 id=\"二-设置clion工具链和cmake配置\"><a class=\"anchor\" href=\"#二-设置clion工具链和cmake配置\">#</a> 二、设置Clion工具链和CMake配置</h2>\n<h4 id=\"工具链配置\"><a class=\"anchor\" href=\"#工具链配置\">#</a> 工具链配置</h4>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506171517203.png\" alt=\"QQ20250617-151714\" /></p>\n<h4 id=\"cmake配置\"><a class=\"anchor\" href=\"#cmake配置\">#</a> CMake配置</h4>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506171518178.png\" alt=\"QQ20250617-151739\" /></p>\n<h2 id=\"三-cmakeliststxt编写\"><a class=\"anchor\" href=\"#三-cmakeliststxt编写\">#</a> 三、CMakeLists.txt编写</h2>\n<p>参考</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 设置CMake最低版本要求和项目信息</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cmake_minimum_required</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 3.10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义项目名称和版本</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">project</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MyOpenCVProject </span><span style=\"color:#59873A;--shiki-dark:#80A665\">VERSION</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 1.0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 设置C++标准</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 推荐使用C++11或更高版本</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMAKE_CXX_STANDARD 20</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMAKE_CXX_STANDARD_REQUIRED </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 查找OpenCV库</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># REQUIRED 参数表示如果找不到OpenCV，CMake会报错并停止构建</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># COMPONENTS 参数指定你需要使用的OpenCV模块，可以减少最终程序的体积</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 常见的模块有：core, highgui, imgcodecs, imgproc, videoio, objdetect等</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">find_package</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">OpenCV REQUIRED COMPONENTS core highgui imgproc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 检查是否成功找到OpenCV</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">OpenCV_FOUND</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"OpenCV found: $&#123;OpenCV_LIBS&#125;\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">else</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FATAL_ERROR </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"OpenCV not found\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 包含OpenCV的头文件目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 这使得你可以在代码中使用 #include &#x3C;opencv2/core.hpp> 等</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">OpenCV_INCLUDE_DIRS</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 5. 添加源文件并生成可执行文件</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将你的C++源文件（例如 main.cpp）添加到这里</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># $&#123;PROJECT_NAME&#125; 会被替换为上面定义的 \"MyOpenCVProject\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_executable</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> main.cpp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 6. 链接OpenCV库</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将你的可执行文件与找到的OpenCV库链接起来</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># $&#123;OpenCV_LIBS&#125; 是一个由find_package创建的变量，包含了所有需要的库文件路径</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_link_libraries</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">OpenCV_LIBS</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 7. (可选) 为Windows平台设置输出目录</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 这段代码可以让你生成的.exe文件和.dll文件都在同一个目录下，方便运行</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">WIN32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">EXECUTABLE_OUTPUT_PATH</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/bin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">LIBRARY_OUTPUT_PATH</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PROJECT_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/bin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 在Debug模式下，输出调试信息</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_BUILD_TYPE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> STREQUAL</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"Debug\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        message</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STATUS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"Build type: Debug\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">endif</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "OpenCV"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E6%96%87%E4%BB%B6%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/",
            "url": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E6%96%87%E4%BB%B6%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/",
            "title": "opencv文件输入输出",
            "date_published": "2025-07-28T13:38:45.000Z",
            "content_html": "<h2 id=\"一-图像的读取与显示\"><a class=\"anchor\" href=\"#一-图像的读取与显示\">#</a> 一、图像的读取与显示</h2>\n<p>核心功能是使用 <code>cv::imread()</code> 函数读取图像数据，并将其存储在一个 <code>cv::Mat</code> 对象中，然后通过 <code>cv::imshow()</code> 函数将图像显示在窗口中。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 指定图像路径</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 注意：在Windows上，路径分隔符应使用正斜杠 \"/\" 或双反斜杠 \"\\\\\"</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 读取图像到 cv::Mat 对象</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::imread(路径, 读取模式);</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat image </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">IMREAD_COLOR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 检查图像是否成功加载</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Could not open or find the image at: </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image_path </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 4. 显示图像</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::imshow(\"窗口标题\", 图像矩阵);</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Image Display</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 5. 等待按键</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::waitKey(0);</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 等待无限久，直到有按键操作</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 等待3000毫秒（3秒）后自动关闭窗口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"cvimread-函数\"><a class=\"anchor\" href=\"#cvimread-函数\">#</a> <code>cv::imread()</code> 函数</h3>\n<p>用于从指定文件加载图像。</p>\n<ul>\n<li><strong>原型</strong>: <code>cv::Mat cv::imread(const std::string&amp; filename, int flags = IMREAD_COLOR)</code></li>\n<li><strong>参数</strong>:\n<ul>\n<li><code>filename</code>: 图像文件的完整路径。</li>\n<li><code>flags</code>: 读取模式，用于指定加载图像的颜色类型。</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>读取模式 (<code>flags</code>)</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>cv::IMREAD_COLOR</code></td>\n<td>加载彩色图像（BGR顺序），忽略Alpha通道。这是默认值。</td>\n</tr>\n<tr>\n<td><code>cv::IMREAD_GRAYSCALE</code></td>\n<td>以灰度模式加载图像。</td>\n</tr>\n<tr>\n<td><code>cv::IMREAD_UNCHANGED</code></td>\n<td>按原样加载图像，包括Alpha通道（如果存在）。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"二-写入与保存图片\"><a class=\"anchor\" href=\"#二-写入与保存图片\">#</a> 二、写入与保存图片</h2>\n<p>使用 <code>cv::imwrite()</code> 函数可以将 <code>cv::Mat</code> 对象中的图像数据保存为文件。该函数可以根据文件扩展名（如 <code>.jpg</code>, <code>.png</code>）自动选择编码器。</p>\n<h3 id=\"1-常规保存\"><a class=\"anchor\" href=\"#1-常规保存\">#</a> 1. 常规保存</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/your/image.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string output_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/output_image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat image </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">IMREAD_COLOR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Could not read the image.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::imwrite(输出路径, 图像矩阵);</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    bool</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> isSuccess </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imwrite</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">output_path</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">isSuccess</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Image saved successfully to </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> output_path </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Failed to save the image.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"2-保存时设置特定参数\"><a class=\"anchor\" href=\"#2-保存时设置特定参数\">#</a> 2. 保存时设置特定参数</h3>\n<p><code>cv::imwrite()</code> 的第三个参数 <code>params</code> 允许为特定图像格式设置保存选项，例如JPEG的质量或PNG的压缩级别。该参数是一个 <code>std::vector&lt;int&gt;</code> 类型的容器，其中参数成对出现：<code>&#123;参数标识符, 参数值&#125;</code>。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vector</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // ... (加载图像代码同上) ...</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat image </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/your/image.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string output_path_png </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/output_compressed.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 设置PNG压缩级别为9（0-9，9为最高压缩）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> png_params</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    png_params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push_back</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">IMWRITE_PNG_COMPRESSION</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    png_params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push_back</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">9</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 或者直接初始化</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // std::vector&#x3C;int> png_params = &#123;cv::IMWRITE_PNG_COMPRESSION, 9&#125;;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    bool</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> isSuccess </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imwrite</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">output_path_png</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> png_params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">isSuccess</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cout </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">PNG with high compression saved successfully.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Failed to save the compressed PNG.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"imwriteflags-常用参数\"><a class=\"anchor\" href=\"#imwriteflags-常用参数\">#</a> <code>ImwriteFlags</code> 常用参数</h3>\n<table>\n<thead>\n<tr>\n<th>参数标识符</th>\n<th>格式</th>\n<th>值范围</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>IMWRITE_JPEG_QUALITY</code></td>\n<td>JPEG</td>\n<td>0 - 100</td>\n<td>设置JPEG质量，值越高图像质量越好，文件越大。默认值为95。</td>\n</tr>\n<tr>\n<td><code>IMWRITE_PNG_COMPRESSION</code></td>\n<td>PNG</td>\n<td>0 - 9</td>\n<td>设置PNG压缩级别，值越高文件越小，但压缩时间越长。默认值为1（最快速度）。</td>\n</tr>\n<tr>\n<td><code>IMWRITE_PNG_STRATEGY</code></td>\n<td>PNG</td>\n<td>枚举值</td>\n<td>设置PNG压缩策略，如<code>IMWRITE_PNG_STRATEGY_RLE</code>。</td>\n</tr>\n<tr>\n<td><code>IMWRITE_WEBP_QUALITY</code></td>\n<td>WebP</td>\n<td>1 - 100</td>\n<td>设置WebP质量，100为无损。默认值为101（无损）。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"三-创建与管理窗口\"><a class=\"anchor\" href=\"#三-创建与管理窗口\">#</a> 三、创建与管理窗口</h2>\n<p>OpenCV允许自动或手动创建窗口来显示图像。</p>\n<h3 id=\"1-自动创建窗口\"><a class=\"anchor\" href=\"#1-自动创建窗口\">#</a> 1. 自动创建窗口</h3>\n<p>调用 <code>cv::imshow()</code> 时，如果指定名称的窗口不存在，它会自动创建一个。这种窗口的大小会根据显示的图像自动调整，用户无法手动拖拽改变。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Auto Window</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 如果名为 \"Auto Window\" 的窗口不存在，则自动创建</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"2-手动创建窗口\"><a class=\"anchor\" href=\"#2-手动创建窗口\">#</a> 2. 手动创建窗口</h3>\n<p>使用 <code>cv::namedWindow()</code> 可以预先创建一个窗口，并指定其属性（如是否可调整大小）。之后 <code>cv::imshow()</code> 使用相同的窗口名称时，会将图像显示在该已创建的窗口中。</p>\n<ul>\n<li><strong><code>cv::namedWindow()</code></strong>: 创建一个窗口。</li>\n<li><strong><code>cv::resizeWindow()</code></strong>: 调整窗口大小。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1. 手动创建一个可调整大小的窗口</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Manual Window</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2. 在该窗口中显示图像</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Manual Window</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 3. 调整窗口大小</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Manual Window</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 600</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 或者使用 cv::Size 对象</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// cv::Size new_size(800, 600);</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// cv::resizeWindow(\"Manual Window\", new_size);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"windowflags-窗口属性标志\"><a class=\"anchor\" href=\"#windowflags-窗口属性标志\">#</a> <code>WindowFlags</code> 窗口属性标志</h3>\n<table>\n<thead>\n<tr>\n<th>标志 (<code>flags</code>)</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>WINDOW_NORMAL</code></td>\n<td>用户可以手动拖拽调整窗口大小。</td>\n</tr>\n<tr>\n<td><code>WINDOW_AUTOSIZE</code></td>\n<td>窗口大小根据图像自动调整，用户无法更改。这是默认值。</td>\n</tr>\n<tr>\n<td><code>WINDOW_FULLSCREEN</code></td>\n<td>以全屏模式显示窗口。</td>\n</tr>\n<tr>\n<td><code>WINDOW_KEEPRATIO</code></td>\n<td>调整窗口大小时，图像保持原始宽高比。</td>\n</tr>\n<tr>\n<td><code>WINDOW_FREERATIO</code></td>\n<td>调整窗口大小时，图像填充整个窗口，不保持宽高比。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"四-在一个窗口中显示多张图片\"><a class=\"anchor\" href=\"#四-在一个窗口中显示多张图片\">#</a> 四、在一个窗口中显示多张图片</h2>\n<p>要在一个窗口中以网格形式显示多张图片，并且保持每张图片的原始宽高比，核心思路是：</p>\n<ol>\n<li>创建一个足够大的空白画布（<code>cv::Mat</code>）。</li>\n<li>计算网格的行数和列数。</li>\n<li>遍历每张待显示的图片。</li>\n<li>对于每张图片，计算一个缩放比例，使其能完整地放入网格单元格内。</li>\n<li>将图片按此比例缩放。</li>\n<li>计算缩放后图片在单元格内居中的位置。</li>\n<li>将缩放后的图片复制到画布的正确位置上。</li>\n</ol>\n<h3 id=\"逻辑流程图\"><a class=\"anchor\" href=\"#逻辑流程图\">#</a> 逻辑流程图</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-mermaid\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">graph TD</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    subgraph \"处理单张图片\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        A</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">获取图片原始尺寸 W_orig, H_orig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> B</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">获取网格单元尺寸 W_cell, H_cell</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        B --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> C</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">计算缩放比 W_cell/W_orig, H_cell/H_orig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        C --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> D</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">计算缩放后尺寸 W_new, H_new</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        D --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> E</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">缩放图片</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        E --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">计算在单元格内的居中偏移量 offsetX, offsetY</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        F --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> G</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">计算图片在画布上的最终ROI</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        G --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> H</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">将缩放后的图片复制到最终ROI</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    end</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    Start</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">开始</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> A;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    H --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Loop</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">是否还有图片?</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    Loop -- 是 --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> A;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    Loop -- 否 --</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> End</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">显示最终画布</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<h3 id=\"示例代码\"><a class=\"anchor\" href=\"#示例代码\">#</a> 示例代码</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vector</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cmath</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">algorithm</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@brief</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 在一个网格中显示多张图片，并保持每张图片的原始宽高比。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> images</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 待显示的cv::Mat图片向量。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> windowName</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 显示窗口的标题。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 网格中每个单元格的尺寸。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> showImagesInGrid</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">vector</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Mat</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> images</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">                      const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> windowName</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Image Grid</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">                      const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Size</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Size</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 300</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">images</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 计算网格布局</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> imageCount </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> images</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">size</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cols </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ceil</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">sqrt</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">imageCount</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> rows </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ceil</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">imageCount</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cols</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 创建大画布</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat </span><span style=\"color:#59873A;--shiki-dark:#80A665\">canvas</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rows </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cols </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CV_8UC3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> imageCount</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ++</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> originalImage </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> images</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> continue</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 1. 计算保持宽高比的缩放比例</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        double</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scale </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">min</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">            static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">            static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 2. 缩放图片</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Size </span><span style=\"color:#59873A;--shiki-dark:#80A665\">newSize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scale</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scale</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat resizedImage</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">originalImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> resizedImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> newSize</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">INTER_AREA</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 3. 计算图片在画布上的目标位置 (ROI)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_col </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">%</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cols</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_row </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cols</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_X </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_col </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_Y </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_row </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> offsetX </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> offsetY </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cell_size</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Rect </span><span style=\"color:#59873A;--shiki-dark:#80A665\">targetRoi</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cell_X </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> offsetX</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cell_Y </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> offsetY</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 4. 将缩放后的图片复制到画布</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        resizedImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">copyTo</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">canvas</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">targetRoi</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windowName</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> canvas</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 假设已加载多张图片到 std::vector&#x3C;cv::Mat> srcImages;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> imagePaths </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/image1.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/image2.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/image3.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">D:/path/to/image4.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImages</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> auto&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> path </span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> imagePaths</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">path</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">            srcImages</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push_back</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImages</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Error: No images were loaded.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    showImagesInGrid</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImages</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "OpenCV"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E5%9B%BE%E5%BD%A2%E6%96%87%E5%AD%97%E7%BB%98%E5%88%B6/",
            "url": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E5%9B%BE%E5%BD%A2%E6%96%87%E5%AD%97%E7%BB%98%E5%88%B6/",
            "title": "opencv图形文字绘制",
            "date_published": "2025-07-28T13:38:38.000Z",
            "content_html": "<h2 id=\"一-绘制矩形\"><a class=\"anchor\" href=\"#一-绘制矩形\">#</a> 一、绘制矩形</h2>\n<p>使用 <code>cv::rectangle</code> 函数在图像上绘制矩形。该函数有两种常见的重载形式：一种使用 <code>cv::Rect</code> 对象，另一种使用两个 <code>cv::Point</code> 对象（左上角和右下角顶点）。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>rec</code></td>\n<td style=\"text-align:left\"><code>cv::Rect</code> 类型的矩形区域。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>pt1</code></td>\n<td style=\"text-align:left\">矩形的左上角顶点。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>pt2</code></td>\n<td style=\"text-align:left\">矩形的右下角顶点。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">矩形边框的颜色，使用 <code>cv::Scalar</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">边框线的粗细。如果为负值（如-1），则表示填充整个矩形。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>lineType</code></td>\n<td style=\"text-align:left\">线的类型，默认为 <code>cv::LINE_8</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>shift</code></td>\n<td style=\"text-align:left\">坐标点的小数位数。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Drawing Shapes</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        printf</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">could not load image...</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 使用 cv::Rect 定义矩形</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Rect </span><span style=\"color:#59873A;--shiki-dark:#80A665\">rec</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 600</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 绘制空心矩形，线条粗细为 5</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rectangle</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> rec</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 绘制实心矩形 (thickness = -1)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::rectangle(srcImg, rec, cv::Scalar(255, 0, 0), -1);</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 4. 使用两个 cv::Point 定义矩形并绘制</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rectangle</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">610</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 230</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<hr />\n<h2 id=\"二-绘制圆形\"><a class=\"anchor\" href=\"#二-绘制圆形\">#</a> 二、绘制圆形</h2>\n<p>使用 <code>cv::circle</code> 函数在图像上绘制圆形。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>center</code></td>\n<td style=\"text-align:left\">圆心的坐标 <code>cv::Point</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>radius</code></td>\n<td style=\"text-align:left\">圆的半径（以像素为单位）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">圆边框的颜色，使用 <code>cv::Scalar</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">边框线的粗细。如果为负值（如-1），则表示填充整个圆形。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>lineType</code></td>\n<td style=\"text-align:left\">线的类型，默认为 <code>cv::LINE_8</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>shift</code></td>\n<td style=\"text-align:left\">坐标点的小数位数。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Drawing Shapes</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        printf</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">could not load image...</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 在图像上绘制一个半径为100，线条粗细为2的绿色圆形</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">circle</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">300</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 300</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<hr />\n<h2 id=\"三-绘制椭圆形\"><a class=\"anchor\" href=\"#三-绘制椭圆形\">#</a> 三、绘制椭圆形</h2>\n<p>使用 <code>cv::ellipse</code> 函数在图像上绘制椭圆或椭圆弧。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>center</code></td>\n<td style=\"text-align:left\">椭圆中心的坐标 <code>cv::Point</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>axes</code></td>\n<td style=\"text-align:left\">椭圆长轴和短轴的一半长度，用 <code>cv::Size</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>angle</code></td>\n<td style=\"text-align:left\">椭圆的旋转角度（顺时针方向）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>startAngle</code></td>\n<td style=\"text-align:left\">椭圆弧的起始角度。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>endAngle</code></td>\n<td style=\"text-align:left\">椭圆弧的结束角度。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">椭圆的颜色，使用 <code>cv::Scalar</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">边框线的粗细。如果为负值（如-1），则表示填充整个椭圆。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>注意</strong>:</p>\n<ul>\n<li>通过设置不同的 <code>startAngle</code> 和 <code>endAngle</code> 可以绘制椭圆弧。</li>\n<li>将长轴和短轴设置为相等的值，即可绘制出一个（可能旋转了的）圆形或圆弧。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Drawing Shapes</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        printf</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">could not load image...</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 绘制一个完整的绿色椭圆</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ellipse</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 中心点</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Size</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 长轴和短轴长度的一半</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                  // 旋转角度</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                  // 起始角度</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                360</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                // 结束角度</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 颜色</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                 // 粗细</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 绘制一个红色椭圆弧</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ellipse</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Size</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                 // 旋转30度</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                180</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                // 绘制上半部分的弧线</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">                cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">                2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 480</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<hr />\n<h2 id=\"四-绘制线段与多边形\"><a class=\"anchor\" href=\"#四-绘制线段与多边形\">#</a> 四、绘制线段与多边形</h2>\n<h3 id=\"1-绘制线段\"><a class=\"anchor\" href=\"#1-绘制线段\">#</a> 1. 绘制线段</h3>\n<p>使用 <code>cv::line</code> 函数绘制一条直线段。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>pt1</code></td>\n<td style=\"text-align:left\">线段的起点 <code>cv::Point</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>pt2</code></td>\n<td style=\"text-align:left\">线段的终点 <code>cv::Point</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">线的颜色，使用 <code>cv::Scalar</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">线的粗细。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-绘制多边形\"><a class=\"anchor\" href=\"#2-绘制多边形\">#</a> 2. 绘制多边形</h3>\n<ul>\n<li><strong><code>cv::polylines</code></strong>: 绘制多边形的轮廓。</li>\n<li><strong><code>cv::fillPoly</code></strong>: 绘制并填充一个或多个多边形。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">函数</th>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>cv::polylines</code></td>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>pts</code></td>\n<td style=\"text-align:left\"><code>cv::Point</code> 类型的数组或向量的数组。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>isClosed</code></td>\n<td style=\"text-align:left\">布尔值，指示是否闭合多边形。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">颜色。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">线宽。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>cv::fillPoly</code></td>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>pts</code></td>\n<td style=\"text-align:left\"><code>cv::Point</code> 类型的数组或向量的数组。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">颜色。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vector</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Drawing Shapes</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        printf</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">could not load image...</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 绘制线段 (主对角线)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">line</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 准备多边形的顶点</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Point</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> polygon_points </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">100</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">250</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 150</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">300</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 300</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">150</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 250</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 绘制多边形轮廓 (不填充)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::polylines(srcImg, polygon_points, true, cv::Scalar(0, 255, 255), 3);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 4. 绘制填充多边形</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fillPoly</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> polygon_points</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 480</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"五-绘制文字\"><a class=\"anchor\" href=\"#五-绘制文字\">#</a> 五、绘制文字</h2>\n<p>在OpenCV中，使用 <code>cv::putText</code> 函数可以在图像上绘制文字。要精确控制文字的位置（例如居中），则需要借助 <code>cv::getTextSize</code> 来预先获取文本的尺寸。</p>\n<hr />\n<p><strong><code>cv::putText</code> 函数</strong></p>\n<p>该函数用于在图像的指定位置绘制文本字符串。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>img</code></td>\n<td style=\"text-align:left\">目标图像。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>text</code></td>\n<td style=\"text-align:left\">要绘制的文本内容，为 <code>std::string</code> 类型。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>org</code></td>\n<td style=\"text-align:left\">文本框的左下角坐标，为 <code>cv::Point</code> 类型。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>fontFace</code></td>\n<td style=\"text-align:left\">字体类型，如 <code>cv::FONT_HERSHEY_SIMPLEX</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>fontScale</code></td>\n<td style=\"text-align:left\">字体大小的缩放比例。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>color</code></td>\n<td style=\"text-align:left\">文本颜色，使用 <code>cv::Scalar</code> 表示。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">构成文本的线条粗细。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>lineType</code></td>\n<td style=\"text-align:left\">线条类型，默认为 <code>cv::LINE_8</code>。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>基本用法:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 在图像大致中心的位置绘制黑色文字 \"Mahiro\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">putText</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Mahiro</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">150</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 250</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FONT_HERSHEY_SIMPLEX</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4.5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">            cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<blockquote>\n<p><strong>注意</strong>：<code>org</code> 参数指定的是文本基线的左端点，而不是文本框的中心点或左上角。</p>\n</blockquote>\n<hr />\n<p><strong>将文字居中绘制</strong></p>\n<p>为了将文字的<strong>中心</strong>放置在图像的特定坐标 <code>(cx, cy)</code> 上，需要以下步骤：</p>\n<ol>\n<li>使用 <code>cv::getTextSize</code> 函数获取文本在特定字体、大小和粗细下的像素宽度和高度。</li>\n<li>根据获取到的尺寸计算出文本框的中心点。</li>\n<li>通过 <code>(cx, cy)</code> 和文本尺寸，反向计算出 <code>cv::putText</code> 所需的左下角坐标 <code>(x, y)</code>。\n<ul>\n<li><code>x = cx - (文本宽度 / 2)</code></li>\n<li><code>y = cy + (文本高度 / 2)</code></li>\n</ul>\n</li>\n</ol>\n<p><strong><code>cv::getTextSize</code> 函数</strong></p>\n<p>该函数计算并返回刚好能包裹指定文本的矩形框的大小。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>text</code></td>\n<td style=\"text-align:left\">要测量的文本字符串。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>fontFace</code></td>\n<td style=\"text-align:left\">字体类型，必须与 <code>cv::putText</code> 中使用的一致。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>fontScale</code></td>\n<td style=\"text-align:left\">字体大小，必须与 <code>cv::putText</code> 中使用的一致。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>thickness</code></td>\n<td style=\"text-align:left\">线条粗细，必须与 <code>cv::putText</code> 中使用的一致。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>baseline</code></td>\n<td style=\"text-align:left\">一个整型指针，函数会通过它返回基线相对于文本框底部的y坐标。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>完整示例代码</strong></p>\n<p>下面的代码创建一个类，实现计算并在图像中心绘制文本。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">string</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// --- TextDrawer 类 ---</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> TextDrawer</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 构造函数，用于设置默认文本样式</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    TextDrawer</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontFace</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">FONT_HERSHEY_SIMPLEX</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> double</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontScale</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">               const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Scalar</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> thickness </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        :</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> m_fontFace</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fontFace</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> m_fontScale</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fontScale</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> m_color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> m_thickness</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">thickness</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 核心方法：在指定中心点绘制居中文字</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> drawCentered</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> text</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Point</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> centerPoint</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> baseline </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Size textSize </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">getTextSize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontFace</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontScale</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_thickness</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">baseline</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Point </span><span style=\"color:#59873A;--shiki-dark:#80A665\">textOrigin</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">centerPoint</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> textSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">width</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">                             centerPoint</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> textSize</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">height</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">putText</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> text</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> textOrigin</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontFace</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontScale</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_color</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_thickness</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 也可提供一个绘制非居中文字的方法</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> draw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> text</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Point</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> origin</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">putText</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> text</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> origin</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontFace</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontScale</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_color</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_thickness</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 可以提供修改样式的接口</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> setStyle</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newScale</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Scalar</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newColor</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        m_fontScale </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> newScale</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        m_color </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> newColor</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 成员变量，保存文本样式</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontFace</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    double</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_fontScale</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar m_color</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> m_thickness</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // ... 加载图像同上 ...</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">your_image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Class-based Text Drawing</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Mat</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">zeros</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">600</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CV_8UC3</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">        srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">setTo</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // --- 使用 TextDrawer ---</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 创建一个用于绘制大标题的 \"Drawer\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    TextDrawer </span><span style=\"color:#59873A;--shiki-dark:#80A665\">titleDrawer</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FONT_HERSHEY_SIMPLEX</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4.5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 创建一个用于绘制副标题的 \"Drawer\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    TextDrawer </span><span style=\"color:#59873A;--shiki-dark:#80A665\">subtitleDrawer</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FONT_HERSHEY_DUPLEX</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2.0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">100</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 使用它们进行绘制</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Point </span><span style=\"color:#59873A;--shiki-dark:#80A665\">imageCenter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    titleDrawer</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">drawCentered</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Mahiro</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> imageCenter</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    subtitleDrawer</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">drawCentered</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Class-based Style!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">imageCenter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> imageCenter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">y</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // ... 显示图像 ...</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 480</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"六-应用示例提取多边形roi\"><a class=\"anchor\" href=\"#六-应用示例提取多边形roi\">#</a> 六、应用示例：提取多边形ROI</h2>\n<p>在图像处理中，ROI (Region of Interest) 是指图像中我们感兴趣的特定区域。一个常见的任务是根据一个不规则的多边形来定义和提取这个区域。其核心思想是利用掩码（Mask）来标定ROI，然后将掩码应用到原始图像上，从而分离出所需部分。</p>\n<hr />\n<h3 id=\"实现步骤\"><a class=\"anchor\" href=\"#实现步骤\">#</a> 实现步骤</h3>\n<ol>\n<li><strong>定义多边形顶点</strong>: 首先，使用一个点的向量 <code>std::vector&lt;cv::Point&gt;</code> 来定义构成ROI边界的多边形顶点坐标。</li>\n<li><strong>创建与绘制掩码 (Mask)</strong>:\n<ul>\n<li>创建一个与原图像尺寸相同、内容全黑的 <code>cv::Mat</code> 对象作为掩码。</li>\n<li>使用 <code>cv::fillPoly</code> 函数，在全黑的掩码上将上一步定义的多边形区域填充为白色（像素值为255）。这样，掩码上白色区域就精确地对应了我们感兴趣的多边形区域。</li>\n</ul>\n</li>\n<li><strong>应用掩码提取ROI</strong>:\n<ul>\n<li>调用 <code>cv::Mat::copyTo</code> 方法，并传入上一步生成的掩码。</li>\n<li>该方法会遍历掩码，仅将原图像中与掩码白色区域（非零像素）对应的像素复制到目标图像中。掩码黑色区域（零像素）对应的部分则不被复制。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"代码示例\"><a class=\"anchor\" href=\"#代码示例\">#</a> 代码示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vector</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string image_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path/to/your/image.jpg</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string windows_name </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Polygon ROI</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        printf</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">could not load image...</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 定义多边形的顶点</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">vector</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Point</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> points </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cols</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Point</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 创建一个全黑的掩码</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat mask </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Mat</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">zeros</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">size</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">type</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 在掩码上将多边形区域填充为白色</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">fillPoly</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mask</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> points</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Scalar</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 4. 使用 copyTo 和掩码来提取ROI</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat dstImg</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">copyTo</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dstImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> mask</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 该操作只复制掩码中像素值不为0的区域</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dstImg</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 480</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"实现效果\"><a class=\"anchor\" href=\"#实现效果\">#</a> 实现效果</h3>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506202320527.png\" alt=\"QQ20250620-231524\" /></p>\n<ul>\n<li>最终显示的目标图像 <code>dstImg</code> 将会是一张背景为黑色的图片。</li>\n<li>图像中只有被多边形框选的区域会显示原始图像的内容，其他部分（即多边形外部的区域）则为黑色，从而实现了对特定不规则区域的精确提取。</li>\n</ul>\n<h3 id=\"应用场景\"><a class=\"anchor\" href=\"#应用场景\">#</a> 应用场景</h3>\n<ul>\n<li><strong>车道线检测</strong>: 在自动驾驶中，可以提取出图像中的车道区域，以减少后续处理的计算量和干扰。</li>\n<li><strong>物体分割</strong>: 在目标识别任务中，可以用于分割出感兴趣的物体，以便进行后续的特征分析或识别。</li>\n</ul>\n",
            "tags": [
                "OpenCV"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97/",
            "url": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97/",
            "title": "opencv图像处理模块",
            "date_published": "2025-07-28T13:38:28.000Z",
            "content_html": "<h2 id=\"一-颜色空间变换\"><a class=\"anchor\" href=\"#一-颜色空间变换\">#</a> 一、颜色空间变换</h2>\n<p>在数字图像处理中，颜色空间（Color Space）是描述和表示颜色的数学模型。OpenCV默认使用的颜色空间是BGR（蓝-绿-红），但在特定任务中，转换到其他颜色空间会更加有效。</p>\n<h3 id=\"1-cvcvtcolor-函数\"><a class=\"anchor\" href=\"#1-cvcvtcolor-函数\">#</a> 1. <code>cv::cvtColor</code> 函数</h3>\n<p>OpenCV使用 <code>cv::cvtColor</code> 函数来进行颜色空间变换。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 原型</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cvtColor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">InputArray</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> src</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     // 输入图像</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">OutputArray</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dst</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 输出图像</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">               // 颜色空间转换代码</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dstCn</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           // 目标图像的通道数，0表示根据输入和代码自动确定</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"2-常用颜色空间及其转换\"><a class=\"anchor\" href=\"#2-常用颜色空间及其转换\">#</a> 2. 常用颜色空间及其转换</h3>\n<p>不同的颜色空间有不同的应用场景。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">颜色空间</th>\n<th style=\"text-align:left\">转换代码</th>\n<th style=\"text-align:left\">描述与用途</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>Grayscale</strong> (灰度)</td>\n<td style=\"text-align:left\"><code>cv::COLOR_BGR2GRAY</code></td>\n<td style=\"text-align:left\">将彩色图像转换为单通道的灰度图像，只包含亮度信息。常用于简化图像，减少计算量，是许多算法（如边缘检测）的预处理步骤。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>HSV</strong> (色相, 饱和度, 明度)</td>\n<td style=\"text-align:left\"><code>cv::COLOR_BGR2HSV</code></td>\n<td style=\"text-align:left\">一种更符合人类视觉感知的颜色模型。在HSV空间中，颜色（Hue）信息与光照强度（Value）分离，非常适合用于基于颜色的对象分割和跟踪。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>YUV</strong></td>\n<td style=\"text-align:left\"><code>cv::COLOR_BGR2YUV</code></td>\n<td style=\"text-align:left\">将亮度（Y）与色度（U, V）分量分离。广泛应用于视频编码和传输，因为它允许在不显著影响视觉质量的情况下降低色度信息的分辨率。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Lab</strong></td>\n<td style=\"text-align:left\"><code>cv::COLOR_BGR2Lab</code></td>\n<td style=\"text-align:left\">一种感知上均匀的颜色空间，即在空间中两个颜色之间的欧氏距离能更好地对应人眼感知的颜色差异。常用于颜色测量和比较。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-示例颜色分割\"><a class=\"anchor\" href=\"#3-示例颜色分割\">#</a> 3. 示例：颜色分割</h3>\n<p>利用HSV颜色空间可以方便地筛选出特定颜色的区域。<code>cv::inRange</code> 函数可以检查图像中的像素值是否在指定的上下限范围内，并生成一个二值掩码（mask）。</p>\n<ul>\n<li><strong><code>cv::inRange(src, lowerb, upperb, dst)</code></strong>:\n<ul>\n<li><code>src</code>: 输入的HSV图像。</li>\n<li><code>lowerb</code>: 颜色的下限值（如<code>cv::Scalar(h_min, s_min, v_min)</code>）。</li>\n<li><code>upperb</code>: 颜色的上限值（如<code>cv::Scalar(h_max, s_max, v_max)</code>）。</li>\n<li><code>dst</code>: 输出的单通道二值掩码。在范围内的像素点设置为255（白色），否则设置为0（黑色）。</li>\n</ul>\n</li>\n</ul>\n<p>下面的代码演示了将BGR图像转换为灰度图和HSV图，并使用<code>cv::inRange</code>在HSV空间中提取红色部分。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 假设 image_path 已定义</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// const std::string image_path = \"your_image.jpg\";</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 读取原始BGR图像</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImage </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">srcImage</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Could not open or find the image</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 1. 转换为灰度图</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat grayImage</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cvtColor</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> grayImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">COLOR_BGR2GRAY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 2. 转换为HSV图</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat hsvImage</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cvtColor</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> hsvImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">COLOR_BGR2HSV</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 3. 在HSV空间中提取红色区域</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 定义红色的HSV范围，注意OpenCV中H范围为[0, 180]</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar </span><span style=\"color:#59873A;--shiki-dark:#80A665\">red_low</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">156</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 43</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 46</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // H(色相), S(饱和度), V(明度) 下限</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar </span><span style=\"color:#59873A;--shiki-dark:#80A665\">red_up</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">180</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // H, S, V 上限</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat red_mask</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 用于存放红色区域的掩码</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // inRange函数会遍历hsvImage中的每个像素，</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 如果像素值在red_low和red_up之间，则在red_mask对应位置设为255，否则设为0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">inRange</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">hsvImage</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> red_low</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> red_up</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> red_mask</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 显示结果</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Original BGR</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> srcImage</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Grayscale</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> grayImage</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">HSV</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> hsvImage</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Red Part Mask</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> red_mask</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h4 id=\"实现效果\"><a class=\"anchor\" href=\"#实现效果\">#</a> 实现效果</h4>\n<p>下图展示了原始图像、灰度图、HSV图以及提取出的红色区域掩码。</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506192322418.png\" alt=\"QQ20250619-232100\" /></p>\n<h2 id=\"二-scalar像素值容器\"><a class=\"anchor\" href=\"#二-scalar像素值容器\">#</a> 二、Scalar：像素值容器</h2>\n<p><code>cv::Scalar</code> 是一个可以存储1到4个数值的模板类，常用于表示和传递像素值。它本质上是一个包含四个元素的vector，可以灵活地表示单通道（灰度）、三通道（BGR）或四通道（BGRA）的像素。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">通道数</th>\n<th style=\"text-align:left\">用途</th>\n<th style=\"text-align:left\">初始化示例</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>1</strong></td>\n<td style=\"text-align:left\">灰度图像</td>\n<td style=\"text-align:left\"><code>cv::Scalar(128)</code></td>\n<td style=\"text-align:left\">第一个通道设为128，其余通道默认为0。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>3</strong></td>\n<td style=\"text-align:left\">BGR彩色图像</td>\n<td style=\"text-align:left\"><code>cv::Scalar(0, 255, 255)</code></td>\n<td style=\"text-align:left\">按B, G, R顺序分别赋值。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>4</strong></td>\n<td style=\"text-align:left\">BGRA带透明度图像</td>\n<td style=\"text-align:left\"><code>cv::Scalar(0, 255, 255, 255)</code></td>\n<td style=\"text-align:left\">按B, G, R, Alpha顺序分别赋值。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"在cvmat构造函数中的应用\"><a class=\"anchor\" href=\"#在cvmat构造函数中的应用\">#</a> 在<code>cv::Mat</code>构造函数中的应用</h3>\n<p>在使用<code>cv::Mat</code>的构造函数创建图像时，<code>cv::Scalar</code>可以用来初始化图像的所有像素。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">Mat</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> mat</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">rows</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> cols</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> type</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h4 id=\"type参数详解\"><a class=\"anchor\" href=\"#type参数详解\">#</a> <code>type</code>参数详解</h4>\n<p><code>type</code>参数定义了矩阵中每个元素的数据类型和通道数，其格式为 <code>CV_&lt;bit_depth&gt;&lt;S/U/F&gt;C&lt;channels&gt;</code>。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">组成部分</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>bit_depth</strong></td>\n<td style=\"text-align:left\">每个通道的位数，如 <code>8</code>, <code>16</code>, <code>32</code>, <code>64</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>S/U/F</strong></td>\n<td style=\"text-align:left\">数据类型：<code>S</code> (signed-有符号整型), <code>U</code> (unsigned-无符号整型), <code>F</code> (float-浮点型)。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>C&lt;channels&gt;</strong></td>\n<td style=\"text-align:left\">通道数，如 <code>C1</code>, <code>C2</code>, <code>C3</code>, <code>C4</code>。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>示例解析:</strong></p>\n<ul>\n<li><code>CV_8UC1</code>: 8位无符号单通道图像。像素值范围为 [0, 255]。</li>\n<li><code>CV_32FC3</code>: 32位浮点型三通道图像。像素值范围通常为 [0.0, 1.0]。</li>\n</ul>\n<p><strong>注意</strong>: 当进行频繁的图像处理（如滤波、几何变换）时，使用 <code>CV_8U</code> 可能会因其有限的精度（0-255的整数）导致累积误差和图像失真。在这种情况下，推荐使用 <code>CV_32F</code> 或 <code>CV_64F</code> 等浮点数类型以保留更高的精度。</p>\n<h3 id=\"代码示例\"><a class=\"anchor\" href=\"#代码示例\">#</a> 代码示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 示例1: 创建一个灰度图像</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::Scalar(128) -> 单通道，第一个值有效，代表灰度值。0为黑，255为白。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar </span><span style=\"color:#59873A;--shiki-dark:#80A665\">scalar1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">128</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat </span><span style=\"color:#59873A;--shiki-dark:#80A665\">mat1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">120</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 240</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CV_8UC1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scalar1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Grayscale Image</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> mat1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 示例2: 创建一个彩色图像</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // cv::Scalar(0, 255, 255) -> BGR三通道。B=0, G=255, R=255。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 使用32F类型，imshow会自动将[0.0, 1.0]范围映射到[0, 255]进行显示。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar </span><span style=\"color:#59873A;--shiki-dark:#80A665\">scalar2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat </span><span style=\"color:#59873A;--shiki-dark:#80A665\">mat2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">120</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 240</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CV_8UC3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scalar2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Color Image</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> mat2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"三-给图片加边框\"><a class=\"anchor\" href=\"#三-给图片加边框\">#</a> 三、给图片加边框</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat srcImg </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imread</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat dstImg</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 产生随机数的类</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RNG </span><span style=\"color:#59873A;--shiki-dark:#80A665\">rng</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">time</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">NULL</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 使用当前时间作为种子</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 特殊类，cv::RNG,用于产生随机数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    while</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">true</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Scalar </span><span style=\"color:#59873A;--shiki-dark:#80A665\">value</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rng</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">uniform</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rng</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">uniform</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rng</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">uniform</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 黑色边界</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 参数：输入图像，输出图像，上下左右边距，边界类型，边界值</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">copyMakeBorder</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">srcImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dstImg</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">BORDER_CONSTANT</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> value</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 常用的边界类型：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">imshow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dstImg</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 480</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">100</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 27</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            break</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>示例：</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202506242254834.png\" alt=\"QQ20250624-225005\" /></p>\n",
            "tags": [
                "OpenCV"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E4%BA%8B%E4%BB%B6/",
            "url": "https://haoruanwn.github.io/2025/07/28/OpenCV/opencv%E4%BA%8B%E4%BB%B6/",
            "title": "opencv事件",
            "date_published": "2025-07-28T13:38:01.000Z",
            "content_html": "<h2 id=\"一-鼠标事件的响应\"><a class=\"anchor\" href=\"#一-鼠标事件的响应\">#</a> 一、鼠标事件的响应</h2>\n<p>当鼠标在窗口上进行操作（如点击、移动、滚轮滚动）时，会触发一个鼠标事件。OpenCV允许我们通过设置一个回调函数来响应这些事件。</p>\n<h3 id=\"1-常见鼠标事件\"><a class=\"anchor\" href=\"#1-常见鼠标事件\">#</a> 1. 常见鼠标事件</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">事件常量 (event)</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MOUSEMOVE</code></td>\n<td style=\"text-align:left\">鼠标移动</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_LBUTTONDOWN</code></td>\n<td style=\"text-align:left\">左键按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_RBUTTONDOWN</code></td>\n<td style=\"text-align:left\">右键按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MBUTTONDOWN</code></td>\n<td style=\"text-align:left\">中键按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_LBUTTONUP</code></td>\n<td style=\"text-align:left\">左键松开</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_RBUTTONUP</code></td>\n<td style=\"text-align:left\">右键松开</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MBUTTONUP</code></td>\n<td style=\"text-align:left\">中键松开</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_LBUTTONDBLCLK</code></td>\n<td style=\"text-align:left\">左键双击</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_RBUTTONDBLCLK</code></td>\n<td style=\"text-align:left\">右键双击</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MBUTTONDBLCLK</code></td>\n<td style=\"text-align:left\">中键双击</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MOUSEWHEEL</code></td>\n<td style=\"text-align:left\">滚轮向前滚动</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_MOUSEHWHEEL</code></td>\n<td style=\"text-align:left\">滚轮向后滚动</td>\n</tr>\n</tbody>\n</table>\n<p>这些事件通常与标志位（flags）结合使用，以判断组合键状态。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">标志常量 (flags)</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_LBUTTON</code></td>\n<td style=\"text-align:left\">左键被按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_RBUTTON</code></td>\n<td style=\"text-align:left\">右键被按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_MBUTTON</code></td>\n<td style=\"text-align:left\">中键被按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_CTRLKEY</code></td>\n<td style=\"text-align:left\"><code>Ctrl</code> 键被按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_SHIFTKEY</code></td>\n<td style=\"text-align:left\"><code>Shift</code> 键被按下</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>EVENT_FLAG_ALTKEY</code></td>\n<td style=\"text-align:left\"><code>Alt</code> 键被按下</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-设置回调函数\"><a class=\"anchor\" href=\"#2-设置回调函数\">#</a> 2. 设置回调函数</h3>\n<p>通过 <code>cv::setMouseCallback</code> 函数为指定窗口注册一个回调函数。当该窗口发生鼠标事件时，注册的函数将被自动调用。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 注册鼠标事件回调函数</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 第一个参数是窗口名称</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 第二个参数是回调函数的指针</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 第三个参数是传递给回调函数的用户自定义数据指针(void*)，默认为0</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">setMouseCallback</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> on_mouse</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"3-回调函数实现\"><a class=\"anchor\" href=\"#3-回调函数实现\">#</a> 3. 回调函数实现</h3>\n<p>下面是一个回调函数的示例，它实现在图像上响应鼠标拖拽并画出红色的线条。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@brief</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 鼠标事件回调函数，event和flags共同决定了鼠标具体是什么操作。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> event</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 鼠标事件类型 (如 EVENT_LBUTTONDOWN)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 鼠标在窗口中的x坐标</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 鼠标在窗口中的y坐标</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> flags</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 鼠标事件标志 (如 EVENT_FLAG_CTRLKEY)</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">@param</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> userdata</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> 用户自定义数据指针</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> on_mouse</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> event</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> flags</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">userdata</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    using</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Point per_point</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Point cur_point</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 将void*类型的userdata转换为cv::Mat类型的引用</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *static_cast</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">userdata</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">event </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> EVENT_LBUTTONDOWN</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 左键被按下</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        per_point </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> y</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 记录按下时的坐标</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">event </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> EVENT_MOUSEMOVE </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> flags </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> EVENT_FLAG_LBUTTON</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 鼠标移动且左键被按下（拖拽）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        cur_point </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> y</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 在图像上画线</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // Scalar(0, 0, 255) 代表 BGR 红色; thickness 表示线的粗细</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        line</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> per_point</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cur_point</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Scalar</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 255</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 刷新显示</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        imshow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">windows_name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> img</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 更新上一个点的位置为当前点</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        per_point </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> cur_point</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"二-键盘事件的响应\"><a class=\"anchor\" href=\"#二-键盘事件的响应\">#</a> 二、键盘事件的响应</h2>\n<p>键盘事件主要通过 <code>cv::waitKey()</code> 函数捕获。该函数在指定的毫秒数内等待按键事件。</p>\n<ul>\n<li><strong><code>cv::waitKey(delay)</code></strong>:\n<ul>\n<li><code>delay &gt; 0</code>: 等待 <code>delay</code> 毫秒。如果在等待期间有按键按下，函数返回该按键的ASCII码，否则返回 -1。</li>\n<li><code>delay &lt;= 0</code>: 无限期等待，直到有按键按下，然后返回按键的ASCII码。</li>\n</ul>\n</li>\n</ul>\n<p>下面的代码实现了播放视频的功能，当按下 <code>ESC</code> 键时视频暂停（循环结束），再按任意键则程序终止。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">opencv2/opencv.hpp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 假设视频路径已定义</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">string video_path </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">your_video_file.mp4</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">VideoCapture </span><span style=\"color:#59873A;--shiki-dark:#80A665\">cap</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">video_path</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">cap</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">isOpened</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cerr </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Error: Could not open video file.</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">endl</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">namedWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">show video</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">WINDOW_NORMAL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">resizeWindow</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">show video</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 800</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 600</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Mat frame</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 视频帧</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    while</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">true</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        cap </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> frame</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">frame</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">empty</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 如果视频播放完毕，退出循环</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            break</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">        imshow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">show video</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> frame</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 等待16ms，如果期间有按键，则捕获其ASCII码</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // 27 是 ESC 键对应的ASCII码</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">16</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 27</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">            break</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 如果按下ESC键，退出循环，视频暂停</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 循环结束后，无限期等待下一次按键，然后程序结束</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    cv</span><span style=\"color:#999999;--shiki-dark:#666666\">::</span><span style=\"color:#59873A;--shiki-dark:#80A665\">waitKey</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n",
            "tags": [
                "OpenCV"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/28/MCU/%E4%BD%BF%E7%94%A8%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%E9%93%BE%E5%BC%80%E5%8F%91STM32/",
            "url": "https://haoruanwn.github.io/2025/07/28/MCU/%E4%BD%BF%E7%94%A8%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%E9%93%BE%E5%BC%80%E5%8F%91STM32/",
            "title": "使用开源工具链开发STM32",
            "date_published": "2025-07-28T13:34:59.000Z",
            "content_html": "<h2 id=\"使用的工具\"><a class=\"anchor\" href=\"#使用的工具\">#</a> 使用的工具</h2>\n<ul>\n<li>vscode \t\t\t      编辑器</li>\n<li>cmake  \t \t            工程构建工具</li>\n<li>ninja     \t\t             工程编译工具</li>\n<li>openOCD  \t\t\t烧录工具</li>\n<li>arm-gnu-toolchain          交叉编译器</li>\n<li>clangd                               代码提示</li>\n</ul>\n<h1 id=\"一-安装需要的工具链\"><a class=\"anchor\" href=\"#一-安装需要的工具链\">#</a> 一、安装需要的工具链</h1>\n<h2 id=\"1-下载\"><a class=\"anchor\" href=\"#1-下载\">#</a> 1、下载</h2>\n<h2 id=\"2-添加到系统环境变量\"><a class=\"anchor\" href=\"#2-添加到系统环境变量\">#</a> 2、添加到系统环境变量</h2>\n<p>系统环境变量path</p>\n<ul>\n<li>D:\\toochain\\ninja</li>\n<li>D:\\toochain\\arm-gnu-toolchain-14.2\\bin</li>\n<li>D:\\toochain\\clang+llvm-19.1.7\\bin</li>\n<li>D:\\toochain\\OpenOCD-20240916\\bin</li>\n</ul>\n<p>新建系统环境变量OPENOCD_SCRIPTS</p>\n<ul>\n<li>D:\\toochain\\OpenOCD-20240916\\share\\openocd\\scripts</li>\n</ul>\n<h1 id=\"二-构建工程\"><a class=\"anchor\" href=\"#二-构建工程\">#</a> 二、构建工程</h1>\n<h2 id=\"1-直接用命令行\"><a class=\"anchor\" href=\"#1-直接用命令行\">#</a> 1、直接用命令行</h2>\n<p>在工程根目录</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -G</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Ninja</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -B</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span></code></pre>\n<p>指定Ninja为构建工具，生成到build文件夹中</p>\n<p>编译</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">cmake</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --build</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> all</span></span></code></pre>\n<p>或者进入到build目录下，执行</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ninja</span></span></code></pre>\n<h2 id=\"2-设置task\"><a class=\"anchor\" href=\"#2-设置task\">#</a> 2、设置task</h2>\n<p>创建<code>.vscode/tasks.json</code>文件</p>\n<p>创建三个任务：</p>\n<ul>\n<li>CMake configure：用cmake生成ninja、compile_commands.json等文件</li>\n<li>Build：编译</li>\n<li>Clean：删除build和.cache文件夹</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">2.0.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tasks</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">CMake configure</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">shell</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cmake</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">args</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-G</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Ninja</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-B</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">group</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">kind</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">isDefault</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">problemMatcher</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$gcc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">detail</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Generated task for CMake configure</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">shell</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cmake</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">args</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--target</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">group</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">kind</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">isDefault</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> false</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">problemMatcher</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$gcc</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">detail</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Generated task for building the project</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Clean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">shell</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cmd</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">args</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rmdir /s /q build &#x26;&#x26; rmdir /s /q .cache</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">group</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">kind</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">isDefault</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> false</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">problemMatcher</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">detail</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Generated task for cleaning the build and cache directories</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>如果是Linux系统，Clean任务需要修改为：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\t\t</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Clean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">shell</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sh</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">args</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">rm -rf build .cache</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">group</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">kind</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">                \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">isDefault</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> false</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">problemMatcher</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">detail</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Generated task for cleaning the build and cache directories</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"3-设置快捷按钮\"><a class=\"anchor\" href=\"#3-设置快捷按钮\">#</a> 3、设置快捷按钮</h2>\n<p>使用vscode插件<strong>Task Buttons</strong></p>\n<p>在<code>.vscode/settings.json</code>中自定义按钮</p>\n<p>对应tasks.json中定义的三个任务</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">clangd.arguments</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--compile-commands-dir=$&#123;workspaceFolder&#125;/build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">VsCodeTaskButtons.showCounter</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">VsCodeTaskButtons.tasks</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$(wrench) Configure</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">task</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">CMake configure</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tooltip</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Configure the project with CMake</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$(tools) Build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">task</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tooltip</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Build the project</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$(trash) Clean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">task</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Clean</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tooltip</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Build the project</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h1 id=\"三-修改芯片ram-flash-堆栈\"><a class=\"anchor\" href=\"#三-修改芯片ram-flash-堆栈\">#</a> 三、修改芯片ram、flash、堆栈</h1>\n<p>在工程根目录中的<code>STM32H750XBHx_FLASH.ld</code>链接脚本中进行修改</p>\n<h3 id=\"1-ram-flash大小修改\"><a class=\"anchor\" href=\"#1-ram-flash大小修改\">#</a> 1、ram、flash大小修改</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/* Specify the memory areas */</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MEMORY</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DTCMRAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x20000000, LENGTH = 128K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x24000000, LENGTH = 512K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM_D2 </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x30000000, LENGTH = 288K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM_D3 </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x38000000, LENGTH = 64K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ITCMRAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x00000000, LENGTH = 64K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FLASH </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x8000000, LENGTH = 128K</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>比如我要用外部存储w25q256，修改flash的地址和长度</p>\n<p>根据图中的配置来修改：</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/202505092247882.png\" alt=\"flash_1\" /></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/* Specify the memory areas */</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">MEMORY</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DTCMRAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x20000000, LENGTH = 128K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x24000000, LENGTH = 512K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM_D2 </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x30000000, LENGTH = 288K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">RAM_D3 </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x38000000, LENGTH = 64K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ITCMRAM </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xrw</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x00000000, LENGTH = 64K</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FLASH </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      : ORIGIN = 0x90000000, LENGTH = 32M</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"2-修改堆栈大小\"><a class=\"anchor\" href=\"#2-修改堆栈大小\">#</a> 2、修改堆栈大小</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-c\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/* Generate a link error if heap and stack don't fit into RAM */</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">_Min_Heap_Size </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      \t/* required amount of heap  */</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">_Min_Stack_Size </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> \t\t/* required amount of stack */</span></span></code></pre>\n<h1 id=\"四-烧录\"><a class=\"anchor\" href=\"#四-烧录\">#</a> 四、烧录</h1>\n<h2 id=\"1-使用stm32cubeprogrammer烧录\"><a class=\"anchor\" href=\"#1-使用stm32cubeprogrammer烧录\">#</a> 1、使用STM32CubeProgrammer烧录</h2>\n<p>参考网上的使用指南，比如<a href=\"https://www.armbbs.cn/forum.php?mod=viewthread&amp;tid=100658\">安富莱外部下载算法</a></p>\n<h2 id=\"2-使用openocd进行烧录\"><a class=\"anchor\" href=\"#2-使用openocd进行烧录\">#</a> 2、使用openOCD进行烧录</h2>\n<p>参考<a href=\"../../%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE&amp;%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E7%94%A8openocd%E8%BF%9B%E8%A1%8C%E7%83%A7%E5%BD%95%E5%92%8C%E8%B0%83%E8%AF%95.md\">用openocd进行烧录和调试</a></p>\n<h1 id=\"五-其他配置\"><a class=\"anchor\" href=\"#五-其他配置\">#</a> 五、其他配置</h1>\n<h3 id=\"1-添加ninja输出高亮\"><a class=\"anchor\" href=\"#1-添加ninja输出高亮\">#</a> 1、添加ninja输出高亮</h3>\n<p>在顶层CMakeLists中添加</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启用 Ninja 颜色支持</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> add_compile_options</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">-fdiagnostics-color=always</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"2-设置编译出的文件为hex文件\"><a class=\"anchor\" href=\"#2-设置编译出的文件为hex文件\">#</a> 2、设置编译出的文件为hex文件</h3>\n<p>在顶层cmakelists文件末尾添加：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加生成 hex 文件的步骤</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">add_custom_command</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">TARGET</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> POST_BUILD</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    COMMAND</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_OBJCOPY</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> -O ihex </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.elf </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_BINARY_DIR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.hex</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    COMMENT</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"Generating hex file from elf\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"3-设置为从外部flash中启动\"><a class=\"anchor\" href=\"#3-设置为从外部flash中启动\">#</a> 3、<strong>设置为从外部flash中启动</strong></h3>\n<p>修改中断向量表偏移地址</p>\n<p>在<code>./Core/Src/system_stm32h7xx.c</code>的SystemInit函数末尾添加</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-c\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> SystemInit</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">......</span></span>\n<span class=\"line\"><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">#endif</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /* USER_VECT_TAB_ADDRESS */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">#endif</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> /*DUAL_CORE &#x26;&#x26; CORE_CM4*/</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  /*偏移中断向量表*/</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  SCB</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">VTOR </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> 0x</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">90000000</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h3 id=\"4-设置格式化工具\"><a class=\"anchor\" href=\"#4-设置格式化工具\">#</a> 4、<strong>设置格式化工具</strong></h3>\n<p>在工程根目录中创建<code>.clang-format</code>文件</p>\n<p>将格式化代码的形式设置为微软的格式：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yaml\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">BasedOnStyle</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Microsoft</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">AccessModifierOffset</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> -4</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">AlignConsecutiveMacros</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">AlignTrailingComments</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">AllowShortFunctionsOnASingleLine</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Inline</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">AllowShortIfStatementsOnASingleLine</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> false</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">BreakBeforeBraces</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Allman</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">ColumnLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span></code></pre>\n<h3 id=\"5-clangd无法识别标准c库\"><a class=\"anchor\" href=\"#5-clangd无法识别标准c库\">#</a> 5、<strong>clangd无法识别标准c库</strong></h3>\n<h3 id=\"6-启用微库microlib\"><a class=\"anchor\" href=\"#6-启用微库microlib\">#</a> 6、<strong>启用微库microLIB</strong></h3>\n<p>比如重定向<code>printf()</code>标准输出函数到串口</p>\n<p>在顶层CMakeLists中添加</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启用microLIB</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CMAKE_C_FLAGS </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"$&#123;CMAKE_C_FLAGS&#125; -specs=nosys.specs\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">CMAKE_CXX_FLAGS</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"$&#123;CMAKE_CXX_FLAGS&#125; -specs=nosys.specs\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"7-重定向printf函数\"><a class=\"anchor\" href=\"#7-重定向printf函数\">#</a> 7、<strong>重定向printf函数</strong></h3>\n<p>前提：启用微库microLIB</p>\n<p>在usart.c中添加</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-c\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">......</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/* 包含头文件 */</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">stdarg.h</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">#</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">stdio.h</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/* 用户函数 */</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/* USER CODE BEGIN 1 */</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">__IO </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> _write</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> char</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ptr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> len</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">void</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">file</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    HAL_UART_Transmit</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">huart1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">uint8_t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ptr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">len</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        //串口发送字符数组（字符串）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> len</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/* USER CODE END 1 */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">......</span></span></code></pre>\n<p>将这两个头文件放在<code>main.h</code>中，这样所有文件都可以用<code>printf()</code>函数</p>\n<p><strong>注意</strong>：不同交叉编译器使用的microLIB不一样，重定向printf的方法不一样，上述方法适用于使用<code>arm-none-eabi-gcc</code>的工程，比如cmake或者stm32cubeide</p>\n<h3 id=\"8-添加自定义的源文件和头文件路径\"><a class=\"anchor\" href=\"#8-添加自定义的源文件和头文件路径\">#</a> 8、<strong>添加自定义的源文件和头文件路径</strong></h3>\n<p>示例：</p>\n<p>用户源文件在<code>./Drivers/user/Src</code>中，遍历该路径下所有源文件</p>\n<p>用户头文件在<code>./Drivers/user/Inc</code>中，添加该头文件路径</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cmake\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">......</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Link directories setup</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">target_link_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # Add user defined library search paths</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 从./Drivers/user/Src遍历的添加源文件，添加到USER_SOURCES变量中</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">file</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">GLOB USER_SOURCES ./Drivers/user/Src/*.c</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Add sources to executable</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_sources</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # Add user sources here</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    $</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">USER_SOURCES</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加头文件路径</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Add include paths</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">target_include_directories</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">$</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">CMAKE_PROJECT_NAME</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> PRIVATE</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # Add user defined include paths</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    ./Drivers/user/Inc</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">......</span></span></code></pre>\n<ol>\n<li>\n<p>先用<code>file</code>命令遍历式的把指定文件夹中的所有源文件都添加到USER_SOURCE变量中，再用已有的<code>target_sources</code>添加到可执行文件</p>\n</li>\n<li>\n<p>使用已有的<code>target_include_directories</code>添加头文件路径</p>\n</li>\n</ol>\n",
            "tags": [
                "MCU/单片机/微控制器",
                "STM32"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/USBIPD%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "url": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/USBIPD%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "title": "USBIPD的使用",
            "date_published": "2025-07-27T14:49:22.000Z",
            "content_html": "<h3 id=\"使用usbipd将usb设备共享给wsl2\"><a class=\"anchor\" href=\"#使用usbipd将usb设备共享给wsl2\">#</a> 使用USBIPD将USB设备共享给WSL2</h3>\n<ol>\n<li>\n<p>在windows的powershell中安装<strong>USBIPD</strong>，安装后重启powershell</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">winget</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> //开代理，要从GitHub上下载</span></span></code></pre>\n</li>\n<li>\n<p>找到esp32对应的设备，记住BUSID，如：6-4</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> //列出当前usb设备</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">6-4</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">    1a86:7522</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">  USB-SERIAL</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> CH340K</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">COM3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">                                      Not shared</span></span></code></pre>\n</li>\n<li>\n<p>绑定BUSID，运行它被共享到WSL2</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bind</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">BUSI</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">D</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如：</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bind</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 6-4</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 取消共享</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> unbind</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 6-4</span></span></code></pre>\n</li>\n<li>\n<p>将USB设备附加到WSL2</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> attach</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --wsl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">BUSI</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">D</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">如：</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> attach</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --wsl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 6-4</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 取消附加到wsl2上（根据guid）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> unbind</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --guid</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 58e8d17f-29ee-41ba-96b0-10cba8173253</span></span></code></pre>\n</li>\n<li>\n<p>运行结果：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">PS</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C:</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\U</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sers</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">054</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> usbipd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> attach</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --wsl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --busid</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 6-4</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Using</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WSL</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> distribution</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Ubuntu</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> attach</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> the</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> will</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> be</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> available</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WSL</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> distributions.</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">usbipd:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> info:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Using</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> IP</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> address</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> reach</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> host.</span></span></code></pre>\n</li>\n<li>\n<p>在Ubuntu上运行<code>lsusb</code>，可以看到多出一个沁恒（ch343）<code>QinHeng</code>的设备</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0003</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 002:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1a86:7522</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> QinHeng</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Electronics</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> USB</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Serial</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bus</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Device</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 001:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1d6b:0002</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Linux</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Foundation</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> hub</span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"图形化软件\"><a class=\"anchor\" href=\"#图形化软件\">#</a> 图形化软件</h2>\n<p><a href=\"https://github.com/nickbeth/wsl-usb-manager\">wsl-usb-manager</a></p>\n",
            "tags": [
                "环境配置&工具使用",
                "USB"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/27/MCU/%E4%BD%BF%E7%94%A8pyocd%E7%83%A7%E5%BD%95%E5%92%8C%E8%B0%83%E8%AF%95MCU/",
            "url": "https://haoruanwn.github.io/2025/07/27/MCU/%E4%BD%BF%E7%94%A8pyocd%E7%83%A7%E5%BD%95%E5%92%8C%E8%B0%83%E8%AF%95MCU/",
            "title": "使用pyocd烧录和调试MCU",
            "date_published": "2025-07-27T13:45:49.000Z",
            "content_html": "<h1 id=\"简介\"><a class=\"anchor\" href=\"#简介\">#</a> 简介</h1>\n<p>pyOCD 是一个开源 Python 软件包，用于多种受支持的硬件调试器（DAP-Link、J-Link、ST-Link,CMSIS-DAP v1(HID)、CMSIS-DAP v2(WinUSB)、SEGGER J-Link、ST-LINK v2和ST-LINK v3）下编程和调试Arm Cortex-M微控制器。它是完全跨平台的，并支持Linux，macOS和Windows。它内置支持多达70种流行的MCU。通过使用CMSIS-Pack，几乎支持市场上的所有Cortex-M设备。pyOCD还可以作为GDB Service配合GDB调试芯片。</p>\n<p>使用环境：Ubuntu22.04</p>\n<h2 id=\"一-安装pyocd\"><a class=\"anchor\" href=\"#一-安装pyocd\">#</a> 一、安装pyocd</h2>\n<p>利用pip进行安装，确保当前环境中python版本大于3.6</p>\n<p>安装pip</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> python3-pip</span></span></code></pre>\n<p>更新pip</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">python3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --upgrade</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --force</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pip</span></span></code></pre>\n<p>安装pyocd</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">python3</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -U</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pyocd</span></span></code></pre>\n<p>安装成功后重启Ubuntu，查看是否安装成功</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -V</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 注意是大写V</span></span></code></pre>\n<h2 id=\"二-连接烧录设备\"><a class=\"anchor\" href=\"#二-连接烧录设备\">#</a> 二、连接烧录设备</h2>\n<p>列出当前连接上的烧录设备</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#   Probe/Board    Unique ID                  Target  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--------------------------------------------------------</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   STM32</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> STLink</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   00380043320000054E575359</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   n/a</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span></code></pre>\n<h2 id=\"三-添加对mcu的支持\"><a class=\"anchor\" href=\"#三-添加对mcu的支持\">#</a> 三、添加对MCU的支持</h2>\n<p>列出当前支持的所有mcu：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -t</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Name</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                      Vendor</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Part</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Number</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                  Families</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   Source</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">------------------------------------------------------------------------------------------------------</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                    AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                                  builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air32f103xb</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air32F103xB</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                             builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air32f103xc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air32F103xC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                             builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air32f103xe</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air32F103xE</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                             builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air32f103xg</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air32F103xG</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                             builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  air32f103xp</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               AirM2M</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                   Air32F103xP</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                             builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  cc3220sf</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                  Texas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Instruments</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">        CC3220SF</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                                builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">......</span></span></code></pre>\n<p>查询对指定型号的支持：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> |</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> grep</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">stm32f051</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                 STMicroelectronics</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">       STM32F051</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">     builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">stm32f103rc</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">               STMicroelectronics</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">       STM32F103RC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   builtin</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">......</span></span></code></pre>\n<h3 id=\"1-查询并添加对某款mcu的支持\"><a class=\"anchor\" href=\"#1-查询并添加对某款mcu的支持\">#</a> 1、查询并添加对某款MCU的支持</h3>\n<p>更新包索引</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pack</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> update</span></span></code></pre>\n<p>查找mspm0g3507</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pack</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mspm0g3507</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Part</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">         Vendor</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">              Pack</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">                          Version</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   Installed</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">--------------------------------------------------------------------------------------</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  MSPM0G3507</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   Texas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Instruments</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   TexasInstruments.MSPM0G_DFP</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">   1.2.1</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">     False</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">     </span></span></code></pre>\n<p>如果查询到了就可以直接安装</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pack</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mspm0g3507</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Downloading</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> packs</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">press </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Control-C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cancel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    TexasInstruments.MSPM0G_DFP.1.2.1</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Downloading</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> descriptors</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">001/001</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>此时再执行<code>pyocd pack -f mspm0g3507</code>，<code>Installed </code>就会变成True，说明已经支持</p>\n<h3 id=\"2-手动添加对某款mcu的支持\"><a class=\"anchor\" href=\"#2-手动添加对某款mcu的支持\">#</a> 2、手动添加对某款MCU的支持</h3>\n<p>有时候pyocd没有初始支持对某款mcu，查询也查询不到，可以手动下载对应的pack包并进行安装</p>\n<p>比如默认就找不到stm32f407zgt6：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pack</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32f407zgt6</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">0000550</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> W</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> No</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> matching</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> devices.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Please</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sure</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pack</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> index</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> date.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pack_cmd</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Downloading</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> packs</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">press </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Control-C</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> cancel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span></code></pre>\n<p>可以从Keil官网下载对应的DFP包，在对目标mcu进行操作的时候作为参数来添加进去</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> list</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -t</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --pack</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./Keil.STM32F4xx_DFP.3.0.0.pack</span></span></code></pre>\n<p>这样就可以列出包中支持的mcu</p>\n<p><strong>可以把需要的pack放置到指定目录，在对需要的单片机进行操作时，加入<code>--pack</code>参数</strong></p>\n<h2 id=\"三-擦除和烧录mcu\"><a class=\"anchor\" href=\"#三-擦除和烧录mcu\">#</a> 三、擦除和烧录MCU</h2>\n<h3 id=\"烧录\"><a class=\"anchor\" href=\"#烧录\">#</a> 烧录</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> stm32f407zgtx</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./build/demo.hex</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --pack</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/Keil.STM32F4xx_DFP.3.0.0.pack</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pyocd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --target</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mspm0g3507</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ./build/empty.hex</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>如果需要操作的mcu已有支持，不需要加<code>--pack</code>参数</p>\n<p>**注意：**烧录的单片机是stm32f407zgt6，但是下载的pack中对应的型号是stm32f407zgtx，可以通过<code>pyocd list -t</code>来查看。</p>\n<h3 id=\"vscode快捷任务\"><a class=\"anchor\" href=\"#vscode快捷任务\">#</a> VScode快捷任务</h3>\n<p><code>.vscode/tasks.json</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">2.0.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tasks</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">label</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Flash</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">process</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">command</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pyocd</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">args</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">flash</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--target</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">stm32f407zgtx</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--pack</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">~/Keil.STM32F4xx_DFP.3.0.0.pack</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">              \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./build/demo.hex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">problemMatcher</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">group</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">              \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">kind</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">              \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">isDefault</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">presentation</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">              \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">reveal</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">always</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">              \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">panel</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dedicated</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">              \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">clear</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">            </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">detail</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Flash demo.hex to STM32 via ST-Link (pyocd)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">          </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<h2 id=\"四-调试mcu\"><a class=\"anchor\" href=\"#四-调试mcu\">#</a> 四、调试MCU</h2>\n<p>**注意：**可执行文件使用<code>.elf</code></p>\n<p>调试的时候需要下载VScode插件<strong>Cortex Debug</strong></p>\n<p><code>.vscode/launch.json</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0.2.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">configurations</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">name</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Cortex Debug</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">cwd</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$&#123;workspaceFolder&#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">executable</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./build/demo.elf</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">request</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">launch</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cortex-debug</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">runToEntryPoint</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">main</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">servertype</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pyocd</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">targetId</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">stm32f407zgtx</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">            \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">cmsisPack</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">~/Keil.STM32F4xx_DFP.3.0.0.pack</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>调试结束后，确定gdb进程关闭，否则下次进入调试会报错</p>\n",
            "tags": [
                "MCU/单片机/微控制器",
                "pyocd/openocd"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/python%E8%84%9A%E6%9C%AC%E4%BB%8E%E5%98%89%E7%AB%8B%E5%88%9B%E5%AF%BC%E5%85%A5%E5%85%83%E5%99%A8%E4%BB%B6%E5%88%B0kicad/",
            "url": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/python%E8%84%9A%E6%9C%AC%E4%BB%8E%E5%98%89%E7%AB%8B%E5%88%9B%E5%AF%BC%E5%85%A5%E5%85%83%E5%99%A8%E4%BB%B6%E5%88%B0kicad/",
            "title": "python脚本从嘉立创导入元器件到kicad",
            "date_published": "2025-07-27T13:43:55.000Z",
            "content_html": "<h2 id=\"一-windows中miniconda的安装与使用\"><a class=\"anchor\" href=\"#一-windows中miniconda的安装与使用\">#</a> 一、Windows中miniconda的安装与使用</h2>\n<p><strong>安装</strong></p>\n<p><a href=\"https://www.anaconda.com/docs/getting-started/miniconda/install#windows-powershell\">官方安装指南</a>，以此执行一下三条指令</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">wget </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-x86_64.exe</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">outfile </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">.\\miniconda.exe</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Start-Process</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">FilePath </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">.\\miniconda.exe</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ArgumentList </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/S</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Wait</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">del .\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">miniconda.exe</span></span></code></pre>\n<p><strong>常用命令</strong></p>\n<p>列出当前已有虚拟环境 <code>conda env list</code></p>\n<p><strong>创建虚拟环境</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">conda create </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">n easyeda python</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3.10</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 创建名为easyeda的虚拟环境，指定python版本</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 激活对应虚拟环境</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">conda activate easyeda</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 离开当前虚拟环境</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">conda deactivate</span></span></code></pre>\n<h2 id=\"二-easyeda2kicad脚本的安装与使用\"><a class=\"anchor\" href=\"#二-easyeda2kicad脚本的安装与使用\">#</a> 二、easyeda2kicad脚本的安装与使用</h2>\n<p><a href=\"https://github.com/uPesy/easyeda2kicad.py\">easyeda2kicad仓库</a></p>\n<p>在对应虚拟环境中执行<code>pip install easyeda2kicad</code>即可安装</p>\n<p><strong>基于元器件客编号来导入元器件</strong></p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1202507142248226.png\" alt=\"Snipaste_2025-07-14_22-47-54\" /></p>\n<p>找到立创商城里需要的元件的编号，在虚拟环境中把它导入到名为<code>easyeda2kicad</code>的元件库中</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">easyeda2kicad </span><span style=\"color:#999999;--shiki-dark:#666666\">--</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">full </span><span style=\"color:#999999;--shiki-dark:#666666\">--</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lcsc_id</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">C32710423</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 显示创建的元件名与库的地址</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INFO</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Created Kicad symbol </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ID : C32710423</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       Symbol name : LCKFB</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LSPI</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SKYSTAR</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STM32F407VGT6</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">PRO</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       Library path : C:\\Users\\hao\\Documents\\Kicad\\easyeda2kicad</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">easyeda2kicad.kicad_sym</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INFO</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Created Kicad footprint </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ID: C32710423</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       Footprint name: COMM</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TH_LCKFB</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LSPI</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SKYSTAR</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STM32F407VGT6</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">PRO</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       Footprint path: C:\\Users\\hao\\Documents\\Kicad\\easyeda2kicad</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">easyeda2kicad.pretty\\COMM</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">TH_LCKFB</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LSPI</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SKYSTAR</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">STM32F407VGT6</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">PRO.kicad_mod</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">WARNING</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> No </span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3D</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> model available </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> this component</span></span></code></pre>\n<p><strong>导入easyeda对应的符号库和封装库</strong></p>\n<p>在kicad开始界面的设置中的符号库与封装库中，分别导入对应文件和路径</p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1202507142254049.png\" alt=\"Snipaste_2025-07-14_22-51-38\" /></p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1202507142254068.png\" alt=\"Snipaste_2025-07-14_22-52-04\" /></p>\n<p><strong>在kicad中找到导入的元件</strong></p>\n<p><img loading=\"lazy\" src=\"https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1202507142255980.png\" alt=\"Snipaste_2025-07-14_22-54-57\" /></p>\n",
            "tags": [
                "环境配置&工具使用",
                "KICAD"
            ]
        },
        {
            "id": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/Git%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/",
            "url": "https://haoruanwn.github.io/2025/07/27/ENV_CONFIG/Git%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/",
            "title": "Git 常用命令总结",
            "date_published": "2025-07-27T09:16:35.000Z",
            "content_html": "<h1 id=\"git-常用命令笔记\"><a class=\"anchor\" href=\"#git-常用命令笔记\">#</a> Git 常用命令笔记</h1>\n<p>本笔记旨在整理 Git 的基础配置、本地与远程仓库管理、分支操作及一些实用技巧。</p>\n<hr />\n<h2 id=\"一-基础配置\"><a class=\"anchor\" href=\"#一-基础配置\">#</a> 一、基础配置</h2>\n<h3 id=\"1-查看与设置用户信息\"><a class=\"anchor\" href=\"#1-查看与设置用户信息\">#</a> 1. 查看与设置用户信息</h3>\n<p>在首次使用 Git 前，需要配置全局的用户名和邮箱。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git config --list</code></td>\n<td style=\"text-align:left\">查看当前的 Git 配置信息。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git config --global user.name &quot;Your Name&quot;</code></td>\n<td style=\"text-align:left\">设置全局用户名。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git config --global user.email &quot;your.email@example.com&quot;</code></td>\n<td style=\"text-align:left\">设置全局用户邮箱。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看所有配置</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> config</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --list</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置全局用户名和邮箱</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> config</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --global</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> user.name</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Your Name</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> config</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --global</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> user.email</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">your.email@example.com</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h3 id=\"2-配置-ssh-密钥\"><a class=\"anchor\" href=\"#2-配置-ssh-密钥\">#</a> 2. 配置 SSH 密钥</h3>\n<p>为了免密与 GitHub 等远程仓库进行通信，推荐使用 SSH 协议。</p>\n<ol>\n<li>生成 SSH 密钥对。</li>\n<li>将公钥（通常是 <code>~/.ssh/id_rsa.pub</code>）的内容添加到 GitHub 账户的 SSH keys 设置中。</li>\n</ol>\n<p>配置完成后，可通过以下命令验证连接是否成功，出现欢迎信息即表示配置正确。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -T</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com</span></span></code></pre>\n<hr />\n<h2 id=\"二-本地仓库管理\"><a class=\"anchor\" href=\"#二-本地仓库管理\">#</a> 二、本地仓库管理</h2>\n<h3 id=\"1-初始化仓库-git-init\"><a class=\"anchor\" href=\"#1-初始化仓库-git-init\">#</a> 1. 初始化仓库 (<code>git init</code>)</h3>\n<p>在项目根目录中执行此命令，将会创建一个 <code>.git</code> 文件夹，用于存储版本库的所有信息。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span></span></code></pre>\n<p><strong>设置默认分支名</strong>:<br />\n新版 Git 推荐使用 <code>main</code> 作为默认主分支名，可以通过以下命令进行全局配置，避免每次 <code>git init</code> 时都出现提示。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> config</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --global</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init.defaultBranch</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main</span></span></code></pre>\n<p><strong>删除本地仓库</strong>:<br />\n直接删除项目根目录下的 <code>.git</code> 文件夹即可。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 在 Linux / macOS / Git Bash 中</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">rm</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -rf</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .git</span></span></code></pre>\n<h3 id=\"2-提交代码-git-add-git-commit\"><a class=\"anchor\" href=\"#2-提交代码-git-add-git-commit\">#</a> 2. 提交代码 (<code>git add</code> &amp; <code>git commit</code>)</h3>\n<p>代码提交分为两步：首先使用 <code>git add</code> 将文件更改添加到暂存区，然后使用 <code>git commit</code> 将暂存区的内内容永久保存到本地仓库。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git add &lt;file&gt;</code></td>\n<td style=\"text-align:left\">将指定文件的更改添加到暂存区。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git add .</code></td>\n<td style=\"text-align:left\">将当前目录下所有文件的更改添加到暂存区。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git commit -m &quot;commit message&quot;</code></td>\n<td style=\"text-align:left\">将暂存区内容提交到仓库，并附上提交信息。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git commit -am &quot;commit message&quot;</code></td>\n<td style=\"text-align:left\">将所有已跟踪文件的更改直接暂存并提交（跳过<code>git add</code>）。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-查看提交历史-git-log\"><a class=\"anchor\" href=\"#3-查看提交历史-git-log\">#</a> 3. 查看提交历史 (<code>git log</code>)</h3>\n<p><code>git log</code> 命令用于查看从近到远的提交历史。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git log</code></td>\n<td style=\"text-align:left\">显示详细的提交历史（Commit ID, 作者, 日期, 提交信息）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git log --stat</code></td>\n<td style=\"text-align:left\">在 <code>git log</code> 的基础上，显示每次提交所修改的文件列表。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git log --oneline</code></td>\n<td style=\"text-align:left\">以简洁的单行格式显示提交历史。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git show &lt;commit_id&gt;</code></td>\n<td style=\"text-align:left\">显示某次特定提交的详细变更内容（代码差异）。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看简略历史</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> log</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --oneline</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 查看某次提交的具体修改</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> show</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 9b568e99</span></span></code></pre>\n<h3 id=\"4-版本回退-git-reset\"><a class=\"anchor\" href=\"#4-版本回退-git-reset\">#</a> 4. 版本回退 (<code>git reset</code>)</h3>\n<p><code>git reset</code> 可以将当前分支的 <code>HEAD</code> 指针移动到指定的提交记录，常用于撤销提交。</p>\n<blockquote>\n<p><strong>警告</strong>: <code>--hard</code> 参数会丢弃工作区和暂存区中自指定提交以来的所有更改，操作具有破坏性，请谨慎使用。</p>\n</blockquote>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 回退到指定的 commit，并丢弃之后的所有修改</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> reset</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --hard</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">commit_i</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 示例：回退到 9b568e99 这个提交</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> reset</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --hard</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 9b568e99</span></span></code></pre>\n<hr />\n<h2 id=\"三-分支管理\"><a class=\"anchor\" href=\"#三-分支管理\">#</a> 三、分支管理</h2>\n<h3 id=\"1-查看与状态检查\"><a class=\"anchor\" href=\"#1-查看与状态检查\">#</a> 1. 查看与状态检查</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git branch</code></td>\n<td style=\"text-align:left\">列出所有本地分支，并用 <code>*</code> 标记当前所在分支。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git status</code></td>\n<td style=\"text-align:left\">显示当前分支的状态，包括已修改、已暂存和未跟踪的文件。</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-创建与切换分支\"><a class=\"anchor\" href=\"#2-创建与切换分支\">#</a> 2. 创建与切换分支</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git branch &lt;branch_name&gt;</code></td>\n<td style=\"text-align:left\">创建一个新分支，但仍停留在当前分支。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git checkout &lt;branch_name&gt;</code></td>\n<td style=\"text-align:left\">切换到已存在的分支。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git checkout -b &lt;branch_name&gt;</code></td>\n<td style=\"text-align:left\">创建一个新分支，并立即切换到该分支。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 创建一个名为 \"develop\" 的分支并切换过去</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> checkout</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -b</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> develop</span></span></code></pre>\n<h3 id=\"3-合并分支-git-merge\"><a class=\"anchor\" href=\"#3-合并分支-git-merge\">#</a> 3. 合并分支 (<code>git merge</code>)</h3>\n<p>将其他分支的更改合并到当前所在的分支。</p>\n<p><strong>流程示例：</strong> 将 <code>develop</code> 分支合并到 <code>main</code> 分支。</p>\n<ol>\n<li>首先，切换到接收更改的目标分支 <code>main</code>。<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> checkout</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main</span></span></code></pre>\n</li>\n<li>然后，执行 <code>merge</code> 命令。<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> merge</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> develop</span></span></code></pre>\n</li>\n</ol>\n<h3 id=\"4-删除分支-git-branch-d\"><a class=\"anchor\" href=\"#4-删除分支-git-branch-d\">#</a> 4. 删除分支 (<code>git branch -d</code>)</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git branch -d &lt;branch_name&gt;</code></td>\n<td style=\"text-align:left\">删除已合并的分支。如果分支包含未合并的更改，会提示失败。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git branch -D &lt;branch_name&gt;</code></td>\n<td style=\"text-align:left\">强制删除一个分支，无论其是否已合并。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除已合并的 develop 分支</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> develop</span></span></code></pre>\n<hr />\n<h2 id=\"四-远程仓库协作\"><a class=\"anchor\" href=\"#四-远程仓库协作\">#</a> 四、远程仓库协作</h2>\n<h3 id=\"1-关联远程仓库-git-remote\"><a class=\"anchor\" href=\"#1-关联远程仓库-git-remote\">#</a> 1. 关联远程仓库 (<code>git remote</code>)</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">命令</th>\n<th style=\"text-align:left\">功能说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>git remote -v</code></td>\n<td style=\"text-align:left\">查看当前配置的所有远程仓库。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git remote add &lt;name&gt; &lt;url&gt;</code></td>\n<td style=\"text-align:left\">添加一个新的远程仓库，通常命名为 <code>origin</code>。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>git remote set-url &lt;name&gt; &lt;new_url&gt;</code></td>\n<td style=\"text-align:left\">更新一个已存在的远程仓库地址。</td>\n</tr>\n</tbody>\n</table>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 关联一个新的远程仓库，命名为 origin</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> remote</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com:user/repo.git</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果需要修改地址</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> remote</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> set-url</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com:user/new-repo.git</span></span></code></pre>\n<h3 id=\"2-推送至远程仓库-git-push\"><a class=\"anchor\" href=\"#2-推送至远程仓库-git-push\">#</a> 2. 推送至远程仓库 (<code>git push</code>)</h3>\n<p>将本地分支的提交推送到远程仓库。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 首次推送 master 分支，并设置上游跟踪关系</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> master</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 后续推送</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 推送其他分支，如 test 分支</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> test</span></span></code></pre>\n<blockquote>\n<p><strong>认证</strong>: 使用 <code>https</code> 协议推送时，通常需要输入个人访问令牌（Personal Access Token）；使用 <code>ssh</code> 协议则通过 SSH 密钥对自动认证。</p>\n</blockquote>\n<h3 id=\"3-克隆远程仓库-git-clone\"><a class=\"anchor\" href=\"#3-克隆远程仓库-git-clone\">#</a> 3. 克隆远程仓库 (<code>git clone</code>)</h3>\n<p>从远程仓库下载一个完整的项目副本到本地。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 克隆默认主分支</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com:user/repo.git</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 克隆时指定特定分支</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -b</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> release/v8.2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> https://github.com/lvgl/lvgl.git</span></span></code></pre>\n<hr />\n<h2 id=\"五-git-实用技巧\"><a class=\"anchor\" href=\"#五-git-实用技巧\">#</a> 五、Git 实用技巧</h2>\n<h3 id=\"1-忽略文件-gitignore\"><a class=\"anchor\" href=\"#1-忽略文件-gitignore\">#</a> 1. 忽略文件 (<code>.gitignore</code>)</h3>\n<p>通过在项目根目录创建 <code>.gitignore</code> 文件，可以指定不需要被 Git 跟踪的文件或目录（如编译产物、日志文件等）。</p>\n<p><strong>规则示例:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yml\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 忽略所有 .a 文件</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">*</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">.a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 但不忽略 lib.a</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!lib.a</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 忽略 build/ 目录下的所有内容</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">build/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 忽略 doc/notes.txt 文件</span></span>\n<span class=\"line\"><span style=\"color:#B56959;--shiki-dark:#C98A7D\">doc/notes.txt</span></span></code></pre>\n<p><strong>清理已跟踪文件</strong>: 如果某个文件在添加到 <code>.gitignore</code> 之前已经被提交，需要先从 Git 的索引中移除它，然后再次提交。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 从索引中移除 build 目录，但保留本地文件</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rm</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --cached</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 提交 .gitignore 和移除操作</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> commit</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Update .gitignore and untrack build directory</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h3 id=\"2-重命名分支\"><a class=\"anchor\" href=\"#2-重命名分支\">#</a> 2. 重命名分支</h3>\n<h4 id=\"场景一分支未推送到远程\"><a class=\"anchor\" href=\"#场景一分支未推送到远程\">#</a> 场景一：分支未推送到远程</h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 将 oldName 分支重命名为 newName</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> oldName</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> newName</span></span></code></pre>\n<h4 id=\"场景二分支已推送到远程\"><a class=\"anchor\" href=\"#场景二分支已推送到远程\">#</a> 场景二：分支已推送到远程</h4>\n<p>需要分步操作：</p>\n<ol>\n<li><strong>重命名本地分支</strong><pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> oldName</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> newName</span></span></code></pre>\n</li>\n<li><strong>删除远程的旧分支</strong><pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --delete</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> oldName</span></span></code></pre>\n</li>\n<li><strong>推送新分支并建立跟踪关系</strong><pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> newName</span></span></code></pre>\n</li>\n</ol>\n",
            "tags": [
                "环境配置&工具使用",
                "Git/Github"
            ]
        }
    ]
}